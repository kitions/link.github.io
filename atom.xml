<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Filip</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://kitions.github.io/"/>
  <updated>2021-04-01T07:48:41.459Z</updated>
  <id>https://kitions.github.io/</id>
  
  <author>
    <name>link</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ESLintç›¸å…³ +  prettier</title>
    <link href="https://kitions.github.io/2021/04/01/ESLint%E7%9B%B8%E5%85%B3/"/>
    <id>https://kitions.github.io/2021/04/01/ESLintç›¸å…³/</id>
    <published>2021-04-01T07:45:55.000Z</published>
    <updated>2021-04-01T07:48:41.459Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ESLintç›¸å…³"><a href="#ESLintç›¸å…³" class="headerlink" title="ESLintç›¸å…³"></a>ESLintç›¸å…³</h1><p>ç»§æ‰¿çš„ä¸»è¦æ˜¯çˆ±å½¼è¿ã€eslintæ¨èã€typescript-eslintæ¨èã€reactæ¨èè§„åˆ™ï¼Œè‡ªå·±æ”¹äº†ç‚¹å°è§„åˆ™ã€‚.eslintrcå…·ä½“ç»†åˆ™è¿˜ä¸æ˜¯ç‰¹åˆ«å®Œå–„ã€‚å„ä½å¤§ä½¬ä½¿ç”¨ä¸­å‘ç°é—®é¢˜çš„è¯ï¼Œæ±‚è½»å–·ã€‚å¸Œæœ›å¤§å®¶ä¸€èµ·å®Œå–„ã€‚</p><p>ç›®å‰eslintæé†’ä¸»è¦æ˜¯errorï¼Œwarningï¼Œerrorçº¢è‰²ï¼Œç¼–è¯‘ä¸é€šè¿‡ï¼Œwaringé»„è‰²è­¦å‘Šï¼Œä¸å½±å“é¡¹ç›®ç¼–è¯‘ã€‚æœ‰å¼ºè¿«ç—‡çš„äººä¼°è®¡ä¸€å®šä¼šæ”¹æ‰ã€‚</p><h3 id="1-package-jsonå¼•å…¥"><a href="#1-package-jsonå¼•å…¥" class="headerlink" title="1 package.jsonå¼•å…¥"></a>1 package.jsonå¼•å…¥</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">"@typescript-eslint/eslint-plugin": "^4.16.1",</span><br><span class="line">"@typescript-eslint/parser": "^4.16.1",</span><br><span class="line">"eslint": "^7.21.0",</span><br><span class="line">"eslint-config-airbnb": "^18.2.1",</span><br><span class="line">"eslint-config-prettier": "^8.1.0",</span><br><span class="line">"eslint-plugin-import": "^2.22.1",</span><br><span class="line">"eslint-plugin-jsx-a11y": "^6.4.1",</span><br><span class="line">"eslint-plugin-react": "^7.22.0",</span><br><span class="line">"husky": "^5.1.3",</span><br><span class="line">"prettier": "^2.2.1"</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// è§„åˆ™è§é™„</span><br><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">&quot;lint&quot;: &quot;eslint --ignore-path .eslintignore . --fix&quot;,</span><br><span class="line">&quot;lint_quiet&quot;: &quot;eslint --quiet  --ignore-path .eslintignore . --fix&quot;,</span><br><span class="line">&quot;fix&quot;: &quot;npx prettier --write .&quot;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-eslintrc-js"><a href="#2-eslintrc-js" class="headerlink" title="2 .eslintrc.js"></a>2 .eslintrc.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">env: &#123;</span><br><span class="line">browser: <span class="literal">true</span>,</span><br><span class="line">es2021: <span class="literal">true</span>,</span><br><span class="line">node: <span class="literal">true</span>,</span><br><span class="line">&#125;,</span><br><span class="line">extends: [</span><br><span class="line"><span class="string">"prettier"</span>,</span><br><span class="line"><span class="string">"airbnb"</span>,</span><br><span class="line"><span class="string">"eslint:recommended"</span>,</span><br><span class="line"><span class="string">"plugin:react/recommended"</span>,</span><br><span class="line"><span class="string">"plugin:@typescript-eslint/recommended"</span>,</span><br><span class="line">],</span><br><span class="line">settings: &#123;</span><br><span class="line"><span class="string">"import/extensions"</span>: [</span><br><span class="line"><span class="string">"2"</span>,</span><br><span class="line"><span class="string">"ignorePackages"</span>,</span><br><span class="line">&#123;</span><br><span class="line">ts: <span class="string">"never"</span>,</span><br><span class="line">tsx: <span class="string">"never"</span>,</span><br><span class="line">json: <span class="string">"never"</span>,</span><br><span class="line">js: <span class="string">"never"</span>,</span><br><span class="line">&#125;,</span><br><span class="line">],</span><br><span class="line">&#125;,</span><br><span class="line">parser: <span class="string">"@typescript-eslint/parser"</span>,</span><br><span class="line">parserOptions: &#123;</span><br><span class="line">ecmaFeatures: &#123;</span><br><span class="line">jsx: <span class="literal">true</span>,</span><br><span class="line">&#125;,</span><br><span class="line">ecmaVersion: <span class="number">2018</span>,</span><br><span class="line">&#125;,</span><br><span class="line">plugins: [</span><br><span class="line"><span class="string">"react"</span>,</span><br><span class="line"><span class="string">"@typescript-eslint"</span>,</span><br><span class="line">],</span><br><span class="line">rules: &#123;</span><br><span class="line">indent: [<span class="string">"error"</span>, <span class="string">"tab"</span>], <span class="comment">// todo</span></span><br><span class="line"><span class="string">"no-tabs"</span>: <span class="number">0</span>,</span><br><span class="line"><span class="string">"quote-props"</span>: <span class="number">0</span>,</span><br><span class="line">semi: <span class="number">0</span>,</span><br><span class="line">quotes: <span class="number">0</span>,</span><br><span class="line"><span class="string">"comma-dangle"</span>: [<span class="string">"error"</span>, <span class="string">"never"</span>],</span><br><span class="line"><span class="string">"arrow-parens"</span>: <span class="number">0</span>,</span><br><span class="line"><span class="string">"react/react-in-jsx-scope"</span>: <span class="number">0</span>,</span><br><span class="line"><span class="string">"react/jsx-indent"</span>: <span class="number">0</span>,</span><br><span class="line"><span class="string">"react/jsx-indent-props"</span>: [<span class="number">2</span>, <span class="string">"tab"</span>],</span><br><span class="line"><span class="string">"react/jsx-filename-extension"</span>: <span class="number">0</span>,</span><br><span class="line"><span class="string">"react/jsx-props-no-spreading"</span>: <span class="number">0</span>,</span><br><span class="line"><span class="string">"react/jsx-no-target-blank"</span>: <span class="number">0</span>,</span><br><span class="line"><span class="string">"import/no-unresolved"</span>: <span class="number">0</span>,</span><br><span class="line"><span class="string">"import/extensions"</span>: <span class="number">0</span>,</span><br><span class="line"><span class="string">"@typescript-eslint/no-var-requires"</span>: <span class="number">0</span>,</span><br><span class="line"><span class="string">"global-require"</span>: <span class="number">0</span>,</span><br><span class="line"><span class="string">"no-nested-ternary"</span>: <span class="number">0</span>,</span><br><span class="line"><span class="string">"max-classes-per-file"</span>: <span class="number">0</span>, <span class="comment">// ä¸€ä¸ªé¡µé¢æœ€å¤šä¸€ä¸ªclass</span></span><br><span class="line"><span class="string">"no-plusplus"</span>: <span class="number">0</span>, <span class="comment">// å…è®¸ä½¿ç”¨++ --</span></span><br><span class="line"><span class="string">"no-new"</span>: <span class="number">0</span>,</span><br><span class="line"><span class="string">"no-useless-constructor"</span>: <span class="number">0</span>, <span class="comment">// constructorå…è®¸&#123;&#125;</span></span><br><span class="line"><span class="string">"no-use-before-define"</span>: <span class="number">1</span>,</span><br><span class="line"><span class="string">"no-underscore-dangle"</span>: <span class="number">0</span>, <span class="comment">// _</span></span><br><span class="line"><span class="string">"no-param-reassign"</span>: <span class="number">1</span>, <span class="comment">// å½¢å‚èµ‹å€¼</span></span><br><span class="line"><span class="string">"import/prefer-default-export"</span>: <span class="number">0</span>, <span class="comment">// å•ä¸ªæ–¹æ³•ã€ç±»æ˜¯å¦é»˜è®¤å¯¼å‡º</span></span><br><span class="line">camelcase: <span class="number">1</span>, <span class="comment">// todo æ˜¯å¦é©¼å³°</span></span><br><span class="line"><span class="string">"no-restricted-syntax"</span>: <span class="number">0</span>, <span class="comment">// ä¸å—é™åˆ¶çš„è¯­æ³•</span></span><br><span class="line"><span class="string">"guard-for-in"</span>: <span class="number">1</span>, <span class="comment">// åˆ¤æ–­Object.prototype.hasOwnProperty.call(foo, key)</span></span><br><span class="line"><span class="string">"max-len"</span>: [<span class="number">1</span>, &#123; <span class="attr">code</span>: <span class="number">200</span> &#125;],</span><br><span class="line"><span class="string">"no-return-await"</span>: <span class="number">0</span>,</span><br><span class="line"><span class="string">"new-cap"</span>: <span class="number">1</span>,</span><br><span class="line"><span class="string">"jsx-a11y/label-has-associated-control"</span>: <span class="number">0</span>,</span><br><span class="line"><span class="string">"jsx-a11y/anchor-is-valid"</span>: <span class="number">0</span>,</span><br><span class="line"><span class="string">"jsx-a11y/click-events-have-key-events"</span>: <span class="number">0</span>, <span class="comment">// å…³çˆ±æ®‹éšœäººå£«æ ‡ç­¾ å¼ºåˆ¶æ‰§è¡ŒonClickæ˜¯ä¼´éšç€ä»¥ä¸‹çš„è‡³å°‘ä¸€ä¸ªï¼šonKeyUpï¼ŒonKeyDownï¼ŒonKeyPress</span></span><br><span class="line"><span class="string">"jsx-a11y/no-static-element-interactions"</span>: <span class="number">0</span>, <span class="comment">// å…³çˆ±æ®‹éšœäººå£«æ ‡ç­¾ span divç­‰ åŠ role</span></span><br><span class="line"><span class="string">"jsx-a11y/no-noninteractive-element-interactions"</span>: <span class="number">0</span>, <span class="comment">// å…³çˆ±æ®‹éšœäººå£«æ ‡ç­¾ éäº¤äº’å…ƒä»¶</span></span><br><span class="line"><span class="string">"no-script-url"</span>: <span class="number">1</span>, <span class="comment">// javascript:;</span></span><br><span class="line"><span class="string">"class-methods-use-this"</span>: <span class="number">0</span>,</span><br><span class="line">eqeqeq: <span class="number">1</span>, <span class="comment">// todo ===</span></span><br><span class="line"><span class="string">"@typescript-eslint/ban-types"</span>: <span class="number">1</span>, <span class="comment">// Object &#123;&#125;ç­‰</span></span><br><span class="line"><span class="string">"react/display-name"</span>: <span class="number">0</span>, <span class="comment">// display-name</span></span><br><span class="line"><span class="string">"react/prop-types"</span>: <span class="number">0</span>, <span class="comment">// .propTypes</span></span><br><span class="line"><span class="string">"react/destructuring-assignment"</span>: <span class="number">1</span>, <span class="comment">// todo props stateè§£æ„</span></span><br><span class="line"><span class="string">"react/no-array-index-key"</span>: <span class="number">1</span>,</span><br><span class="line"><span class="string">"no-unused-expressions"</span>: [<span class="string">"error"</span>, &#123; <span class="attr">allowShortCircuit</span>: <span class="literal">true</span> &#125;],</span><br><span class="line"><span class="string">"consistent-return"</span>: <span class="number">1</span>,</span><br><span class="line"><span class="string">"no-prototype-builtins"</span>: <span class="number">1</span>, <span class="comment">//  bad: foo.hasOwnProperty("bar") good:Object.prototype.hasOwnProperty.call(foo, "bar");</span></span><br><span class="line"><span class="string">"no-shadow"</span>: <span class="number">1</span>,</span><br><span class="line"><span class="string">"@typescript-eslint/no-empty-function"</span>: <span class="number">1</span>,</span><br><span class="line"><span class="string">"no-async-promise-executor"</span>: <span class="number">0</span>, <span class="comment">// ç¦æ­¢å°†å¼‚æ­¥åŠŸèƒ½ç”¨ä½œPromiseæ‰§è¡Œå™¨</span></span><br><span class="line"><span class="string">"@typescript-eslint/no-empty-interface"</span>: <span class="number">0</span>,</span><br><span class="line"><span class="string">"@typescript-eslint/no-this-alias"</span>: <span class="number">1</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="3-eslintignore-å’Œ-prettierignore"><a href="#3-eslintignore-å’Œ-prettierignore" class="headerlink" title="3 .eslintignore å’Œ .prettierignore"></a>3 .eslintignore å’Œ .prettierignore</h3><p>çœ‹è¯¸ä½é¡¹ç›®</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/node_modules/</span><br><span class="line">/src/_next/</span><br><span class="line">/src/dist/</span><br><span class="line">/src/<span class="keyword">static</span>/</span><br><span class="line">  </span><br><span class="line">  or</span><br><span class="line"></span><br><span class="line">/node_modules/</span><br><span class="line">/src/_next/</span><br><span class="line">/src/dist/</span><br><span class="line">/src/<span class="keyword">static</span>/</span><br><span class="line">/src/server/proto</span><br></pre></td></tr></table></figure><h3 id="4-prettier-config-js"><a href="#4-prettier-config-js" class="headerlink" title="4 prettier.config.js"></a>4 prettier.config.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line"><span class="string">"printWidth"</span>: <span class="number">80</span>,</span><br><span class="line"><span class="string">"tabWidth"</span>: <span class="number">4</span>,</span><br><span class="line"><span class="string">"singleQuote"</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="string">"semi"</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="string">"trailingComma"</span>: <span class="string">"none"</span>,</span><br><span class="line"><span class="string">"bracketSpacing"</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="string">"arrowParens"</span>: <span class="string">"avoid"</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-editorconfig"><a href="#5-editorconfig" class="headerlink" title="5 .editorconfig"></a>5 .editorconfig</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># http://editorconfig.org</span><br><span class="line"></span><br><span class="line">root = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[*]</span><br><span class="line">charset = utf<span class="number">-8</span></span><br><span class="line">indent_style = tab</span><br><span class="line">insert_final_newline = <span class="literal">true</span></span><br><span class="line">trim_trailing_whitespace = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[*.md]</span><br><span class="line">max_line_length = off</span><br></pre></td></tr></table></figure><h3 id="6-Vscodeæ’ä»¶"><a href="#6-Vscodeæ’ä»¶" class="headerlink" title="6. Vscodeæ’ä»¶"></a>6. Vscodeæ’ä»¶</h3><p><code>Prettier Eslint</code> è§„åˆ™ä¼šä½¿ç”¨eslintä¸­çš„è§„åˆ™ï¼Œæ­¤æ’ä»¶ä»…åœ¨eslinté¡¹ç›®ä¸‹æ ¼å¼åŒ–æœ‰æ•ˆã€‚</p><p><code>Prettier - Code formatter</code> ä¼šä½¿ç”¨prettier.config.jsçš„è§„åˆ™</p><p>ä¾æ®ä¸ªäººéœ€æ±‚ï¼Œé€‰æ‹©æ˜¯å¦ä¿å­˜å¹¶æ ¼å¼åŒ–</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gomwg68xzpj30ay03l0tc.jpg" alt="image-20210317144545343"></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gomwgmfjo7j30ai01vaa5.jpg" alt="image-20210317144611017"></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEly1gosszl3ze5j30cv03ddg5.jpg" alt="image-20210322171921452"></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gomwh86scbj30n0096tb3.jpg" alt="image-20210317144645630"></p><h3 id="7-npm-run-fix-amp-amp-npm-run-lint"><a href="#7-npm-run-fix-amp-amp-npm-run-lint" class="headerlink" title="7. npm run fix &amp;&amp; npm run lint"></a>7. npm run fix &amp;&amp; npm run lint</h3><p>ç¬¬ä¸€æ¬¡å¼•å…¥é¡¹ç›®å…ˆæ‰§è¡Œnpm run fixï¼Œç›®çš„æ˜¯ç»Ÿä¸€é¡¹ç›®ä¸­æ‰€æœ‰å•åŒå¼•å·ï¼Œç¼©è¿›ï¼Œæ ¼å¼ã€‚åæ‰§è¡Œnpm run lint ã€‚npm run lint(eslint â€“fix)å¯¹ä¸€äº›ç¼©è¿›æ ¼å¼ä¸æ˜¯ç‰¹åˆ«æ•æ„Ÿï¼Œæ‰€ä»¥å…ˆæ‰§è¡Œä¸€éfixï¼Œå†æ‰§è¡Œlintã€‚ ä»¥åé¡¹ç›®å¯ä¸å†æ‰§è¡Œnpm run fixï¼Œç¼–è¾‘æäº¤æ—¶åªæ‰§è¡Œnpm run lintã€‚</p><p>npm run fix åœ¨ä½ å¼•å…¥åˆ°ç°æœ‰é¡¹ç›®åæ‰§è¡Œï¼Œå¸®ä½ æŠŠä»£ç æ ¼å¼åŒ–åˆ°prettierçš„é…ç½®</p><p>npm run lint  å¸¦äº†<code>--fix</code>ï¼Œå®ƒä¼šæ ¼å¼åŒ–ä»£ç ï¼Œä¼šä¿®å¤ä¸€äº›è§„åˆ™ã€‚</p><p>å¼•å…¥è€é¡¹ç›®åã€‚å‘ç°æœ‰ç‚¹å¥”æºƒğŸ˜¿</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gomwjnrwyoj304002zdfu.jpg" alt="image-20210317144905929"></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gomwxinde9j307w0pedhf.jpg" alt="image-20210317150225545"></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gomwx1h4tnj30ov0hn45i.jpg" alt="image-20210317150157795"></p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gomwhtbic7j30m70idjv6.jpg" alt="image-20210317144719347"></p><p>ç»è¿‡ä¿®å¤å</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gp409inu2kj30kb088myp.jpg" alt="image-20210401095218422"></p><h3 id="8-husky"><a href="#8-husky" class="headerlink" title="8 husky"></a>8 husky</h3><p><a href="https://github.com/typicode/husky" target="_blank" rel="noopener">husky</a>ä¸€ä¸ªGit Hook å·¥å…·ï¼Œ<a href="https://typicode.github.io/husky/#/" target="_blank" rel="noopener">æ–‡æ¡£</a> å°†å…¶å®‰è£…åˆ°æ‰€åœ¨ä»“åº“çš„è¿‡ç¨‹ä¸­å®ƒä¼šè‡ªåŠ¨åœ¨ .git/ ç›®å½•ä¸‹å¢åŠ ç›¸åº”çš„é’©å­å®ç°åœ¨ pre-commit é˜¶æ®µå°±æ‰§è¡Œä¸€ç³»åˆ—æµç¨‹ä¿è¯æ¯ä¸€ä¸ª commit çš„æ­£ç¡®æ€§ã€‚</p><p><code>npm install husky --save-dev &amp;&amp; npx husky init</code></p><p>or</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">npm install husky --save-dev  ||  yarn add husky --save-dev</span><br><span class="line"></span><br><span class="line">npx husky install || yarn husky install</span><br><span class="line">  æˆ–è€…ä¹Ÿå¯ä»¥åœ¨é¡¹ç›®å†…å®¹install</span><br><span class="line">  // package.json</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;scripts&quot;: &#123;</span><br><span class="line">      &quot;prepare&quot;: &quot;husky install&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><img src="/Users/linkai/Library/Application Support/typora-user-images/image-20210317150442297.png" alt="image-20210317150442297"></p><p>æ·»åŠ é’©å­</p><p><code>npx husky add .husky/pre-commit &quot;npm run lint&quot;</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">. <span class="string">"<span class="variable">$(dirname "$0")</span>/_/husky.sh"</span></span><br><span class="line"></span><br><span class="line">    npm run lint</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gomwtcpi8hj306t02fwef.jpg" alt="image-20210317145824823"></p><h3 id="9-æ”¹ä»£ç "><a href="#9-æ”¹ä»£ç " class="headerlink" title="9 æ”¹ä»£ç "></a>9 æ”¹ä»£ç </h3><p>come onï¼</p><h2 id="é™„"><a href="#é™„" class="headerlink" title="é™„"></a>é™„</h2><h3 id="1-Eslintå¸¸ç”¨é…ç½®é¡¹"><a href="#1-Eslintå¸¸ç”¨é…ç½®é¡¹" class="headerlink" title="1. Eslintå¸¸ç”¨é…ç½®é¡¹"></a>1. Eslintå¸¸ç”¨é…ç½®é¡¹</h3><p>åŠ å…¥script ã€‚å…·ä½“å†…éƒ¨é…ç½®è¯¸ä½é…Œæƒ…ä½¿ç”¨ï¼Œä¸å¸¸ç”¨çš„è§<a href="https://eslint.bootcss.com/docs/user-guide/command-line-interface" target="_blank" rel="noopener">æ–‡æ¡£</a></p><ul><li><code>.</code>ä»£è¡¨çš„æ˜¯æ‰€æœ‰æ–‡ä»¶ã€‚ä¹Ÿå¯ä»¥å†™å…·ä½“çš„ç›®å½•ï¼Œæ¯”å¦‚<code>pages</code>ï¼Œ<code>utils</code>ç­‰</li><li><code>--fix</code>ä¿®å¤æ–‡ä»¶ï¼Œå‰©ä¸‹çš„æœªä¿®å¤çš„é—®é¢˜æ‰ä¼šè¾“å‡ºåˆ°å‘½ä»¤è¡Œ</li><li><code>--fix-dry-run</code>ï¼šè¯¥é€‰é¡¹ä¸ <code>--fix</code> æœ‰ç›¸åŒçš„æ•ˆæœï¼Œå”¯ä¸€ä¸€ç‚¹ä¸åŒæ˜¯ï¼Œä¿®å¤ä¸ä¼šä¿å­˜åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚</li><li><code>--ext</code>ï¼šå¯ä»¥æŒ‡å®šåœ¨æŒ‡å®šç›®å½•ä¸­æœç´¢JavaScriptæ–‡ä»¶æ—¶ï¼ŒESLintå°†ä½¿ç”¨å“ªäº›æ–‡ä»¶æ‰©å±•åã€‚é»˜è®¤æ‰©å±•åä¸º<code>.js</code>ã€‚</li><li><code>--global</code>ï¼šç”¨äºå®šä¹‰å…¨å±€å˜é‡ã€‚ä»»ä½•æŒ‡å®šçš„å…¨å±€å˜é‡é»˜è®¤æ˜¯åªè¯»çš„ï¼Œåœ¨å˜é‡åå­—ååŠ ä¸Š <code>:true</code> åä¼šä½¿å®ƒå˜ä¸ºå¯å†™ã€‚è¦æŒ‡å®šå¤šä¸ªå˜é‡ï¼Œä½¿ç”¨é€—å·åˆ†éš”å®ƒä»¬ï¼Œæˆ–å¤šæ¬¡ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚</li><li><code>--quiet</code>åªä¼šæŠ¥å‘Šé”™è¯¯error</li><li><code>--max-warnings</code>æŒ‡å®šä¸€ä¸ªè­¦å‘Šçš„é˜ˆå€¼,å½“ä½ çš„é¡¹ç›®ä¸­æœ‰å¤ªå¤šè¿åè§„åˆ™çš„è­¦å‘Šæ—¶ï¼Œè¿™ä¸ªé˜ˆå€¼è¢«ç”¨æ¥å¼ºåˆ¶ ESLint ä»¥é”™è¯¯çŠ¶æ€é€€å‡º  ç¤ºä¾‹:<code>eslint --max-warnings 10 file.js</code></li><li><code>-o</code>å°†æŠ¥å‘Šå†™åˆ°ä¸€ä¸ªæ–‡ä»¶ã€‚ç¤ºä¾‹ :<code>eslint -o ./test/test.html</code></li><li><code>--cache</code>ç¼“å­˜é»˜è®¤è¢«å­˜å‚¨åœ¨ <code>.eslintcache</code>å¯ç”¨è¿™ä¸ªé€‰é¡¹å¯ä»¥æ˜¾è‘—æ”¹å–„ ESLint çš„è¿è¡Œæ—¶é—´ï¼Œç¡®ä¿åªå¯¹æœ‰æ”¹å˜çš„æ–‡ä»¶è¿›è¡Œæ£€æµ‹ã€‚<br><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gomw6os2fmj30x80g87a8.jpg"></li></ul><h3 id="2-Exit-codes"><a href="#2-Exit-codes" class="headerlink" title="2. Exit codes"></a>2. Exit codes</h3><p> å½“æ£€æµ‹å®Œæ¯•åï¼Œeslintä¼šæœ‰çŠ¶æ€ç æé†’</p><ul><li><code>0</code>: æ£€æµ‹æˆåŠŸï¼Œæ²¡æœ‰é”™è¯¯ã€‚å¦‚æœ <code>--max-warnings</code> æ ‡å¿—è¢«è®¾ç½®ä¸º <code>n</code>ï¼Œé‚£ä¹ˆè­¦å‘Šæ•°é‡æœ€å¤šä¸º<code>n</code>ã€‚</li><li><code>1</code>: æ£€æµ‹æˆåŠŸï¼Œå¹¶ä¸”è‡³å°‘æœ‰ä¸€ä¸ªé”™è¯¯ï¼Œæˆ–è€…è­¦å‘Šå¤šäº <code>--max-warnings</code> é€‰é¡¹æ‰€å…è®¸çš„è­¦å‘Šã€‚</li><li><code>2</code>: ç”±äºé…ç½®é—®é¢˜æˆ–å†…éƒ¨é”™è¯¯ï¼Œæ£€æµ‹æœªèƒ½æˆåŠŸã€‚</li></ul><h3 id="3-å¿½ç•¥ç›¸å…³"><a href="#3-å¿½ç•¥ç›¸å…³" class="headerlink" title="3. å¿½ç•¥ç›¸å…³"></a>3. å¿½ç•¥ç›¸å…³</h3><ol><li>åœ¨æ–‡ä»¶å¤´éƒ¨æ·»åŠ è§„åˆ™ï¼Œæ•´ä¸ªæ–‡ä»¶å¿½ç•¥</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* eslint-disable */</span></span><br><span class="line"><span class="comment">// ä»£ç å¼€å§‹ä½ç½®</span></span><br></pre></td></tr></table></figure><ol start="2"><li>ä¸´æ—¶ç¦æ­¢</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* eslint-disable */</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'hello'</span>);</span><br><span class="line"><span class="comment">/* eslint-enable */</span></span><br></pre></td></tr></table></figure><ol start="3"><li>å¯¹æŒ‡å®šè§„åˆ™å¿½ç•¥</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* eslint-disable no-alert, no-console */</span></span><br><span class="line">alert(<span class="string">'foo'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'bar'</span>);</span><br><span class="line"><span class="comment">/* eslint-enable no-alert, no-console */</span></span><br></pre></td></tr></table></figure><ol start="4"><li>æŒ‡å®šè¡Œå¿½ç•¥</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alert(<span class="string">'foo'</span>); <span class="comment">// eslint-disable-line</span></span><br><span class="line"><span class="comment">// eslint-disable-next-line</span></span><br><span class="line">alert(<span class="string">'foo'</span>);</span><br></pre></td></tr></table></figure><ol start="5"><li>æŒ‡å®šè¡Œç¦ç”¨æŸä¸ªè§„åˆ™</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alert(<span class="string">'foo'</span>); <span class="comment">// eslint-disable-line no-alert</span></span><br><span class="line"><span class="comment">// eslint-disable-next-line no-alert</span></span><br><span class="line">alert(<span class="string">'foo'</span>);</span><br></pre></td></tr></table></figure><ol start="6"><li>æŒ‡å®šè¡Œç¦ç”¨å¤šä¸ªè§„åˆ™</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">alert(<span class="string">'foo'</span>); <span class="comment">// eslint-disable-line no-alert, quotes, semi</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// eslint-disable-next-line no-alert, quotes, semi</span></span><br><span class="line">alert(<span class="string">'foo'</span>);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      ESLintç›¸å…³ï¼Œç»§æ‰¿çš„ä¸»è¦æ˜¯çˆ±å½¼è¿ã€eslintæ¨èã€typescript-eslintæ¨èã€Reactæ¨èè§„Rï¼Œå‚»ç“œå¼æ“ä½œæ­¥éª¤ï¼Œä¸ªäººå®è·µï¼Œå¯èƒ½è¿˜å­˜åœ¨é—®é¢˜ï¼Œæœ›å¤šå¤šæŒ‡æ•™
    
    </summary>
    
      <category term="é»˜è®¤åˆ†ç±»" scheme="https://kitions.github.io/categories/%E9%BB%98%E8%AE%A4%E5%88%86%E7%B1%BB/"/>
    
    
      <category term="ESLint" scheme="https://kitions.github.io/tags/ESLint/"/>
    
  </entry>
  
  <entry>
    <title>React  0 -&gt; Hooks</title>
    <link href="https://kitions.github.io/2021/01/04/0%20-%20hooks/"/>
    <id>https://kitions.github.io/2021/01/04/0 - hooks/</id>
    <published>2021-01-04T10:29:32.000Z</published>
    <updated>2021-01-06T08:43:11.104Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0-gt-Hooks"><a href="#0-gt-Hooks" class="headerlink" title="0 -&gt; Hooks"></a>0 -&gt; Hooks</h1><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">funcition App ()&#123;</span><br><span class="line">  <span class="keyword">const</span> [num, setNum] = useState(<span class="number">0</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    onClick ()&#123;</span><br><span class="line">      setNum(<span class="function"><span class="params">num</span> =&gt;</span> num + <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>React è¿è¡Œç¯å¢ƒ</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> isMount = <span class="literal">true</span>  <span class="comment">// didMount or didUpdate</span></span><br><span class="line"><span class="keyword">let</span> workInProgressHook = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fiber = &#123;</span><br><span class="line">  stateNode: App,</span><br><span class="line">  memoizedState: <span class="literal">null</span>,  <span class="comment">// é“¾è¡¨</span></span><br><span class="line">  queue:&#123;    <span class="comment">// é˜Ÿåˆ—</span></span><br><span class="line">    pending: <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">schedule</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  workInProgressHook = fiber.memoizedState;</span><br><span class="line">  <span class="keyword">const</span> app = fiber.stateNode();</span><br><span class="line">  isMount = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">return</span> app</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.app = schedule()</span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useState</span>(<span class="params">initState</span>)</span>&#123;</span><br><span class="line">  <span class="comment">// å½“å‰hook</span></span><br><span class="line">  <span class="keyword">let</span> hook;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span>(isMount)&#123;</span><br><span class="line">    hook = &#123;  <span class="comment">// å•å‘é“¾è¡¨</span></span><br><span class="line">      memoizedState: initState,</span><br><span class="line">      next: <span class="literal">null</span> <span class="comment">// æŒ‡é’ˆ ä¸‹ä¸€ä¸ª</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!fiber.memoizedSate)&#123;</span><br><span class="line">      fiber.memoizedState = hook;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      workInProgressHook.next  = hook</span><br><span class="line">    &#125;</span><br><span class="line">     workInProgressHook  = hook</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    hook = workInProgressHook;</span><br><span class="line">    workInProgressHook = workInProgressHook.next</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å–åˆ°äº†å½“å‰useStateçš„æ•°æ®</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// todo</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dispathAction</span>(<span class="params">queue, action</span>)</span>&#123;</span><br><span class="line"><span class="keyword">const</span> update =&#123; <span class="comment">// ç¯çŠ¶é“¾è¡¨</span></span><br><span class="line">    action,</span><br><span class="line">    next</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span>(queue.pending === <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// u0 -&gt; u0 -&gt; u0</span></span><br><span class="line">    update.next = update</span><br><span class="line">    </span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">// u0 -&gt; u0</span></span><br><span class="line">   <span class="comment">// u1 -&gt; u0 -&gt; u1</span></span><br><span class="line">    <span class="comment">// queue.pending // æœ€åç¬¬ä¸€ä¸ª</span></span><br><span class="line">    <span class="comment">// queue.pending.next //ç¬¬ä¸€ä¸ª</span></span><br><span class="line">    update.next = queue.pending.next; <span class="comment">// u1 -&gt; u0</span></span><br><span class="line">    queue.pending.next = update; <span class="comment">// u0 -&gt; u1</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  queue.pending = update;</span><br><span class="line">  </span><br><span class="line">  schedule();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useState</span>(<span class="params">initState</span>)</span>&#123;</span><br><span class="line">  <span class="comment">// å½“å‰hook</span></span><br><span class="line">  <span class="keyword">let</span> hook;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span>(isMount)&#123;</span><br><span class="line">    hook = &#123;  <span class="comment">// å•å‘é“¾è¡¨</span></span><br><span class="line">      memoizedState: initState,</span><br><span class="line">      next: <span class="literal">null</span> <span class="comment">// æŒ‡é’ˆ ä¸‹ä¸€ä¸ª</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!fiber.memoizedSate)&#123;</span><br><span class="line">      fiber.memoizedState = hook;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      workInProgressHook.next  = hook</span><br><span class="line">    &#125;</span><br><span class="line">     workInProgressHook  = hook</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    hook = workInProgressHook;</span><br><span class="line">    workInProgressHook = workInProgressHook.next</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å–åˆ°äº†å½“å‰useStateçš„æ•°æ®</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">let</span> baseState = hook.memoizedState;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span>(hook.queue.pending)&#123;</span><br><span class="line">    <span class="keyword">let</span> firstupdate = hook.queue.pending.next;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">do</span>&#123;</span><br><span class="line">      <span class="keyword">const</span> action = firstUpdate.action</span><br><span class="line">      baseState = action(baseState)</span><br><span class="line">      firstUpdate = firstUpdate.next;</span><br><span class="line">    &#125;<span class="keyword">while</span>(firstUpdate !== hook.queue.pending.next)</span><br><span class="line">      </span><br><span class="line">    hook.queue.pending = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  hook.memoizedState = baseState;</span><br><span class="line">  <span class="keyword">return</span> [baseState, disPatchAction.bind(<span class="literal">null</span>, hook.queue)]</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œæ•´ä»£ç </p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> isMount = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">let</span> workInProgressHook = <span class="literal">null</span>   <span class="comment">// å˜é‡  å½“å‰å¤„ç†å“ªä¸€ä¸ªhook</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fiber = &#123;</span><br><span class="line">    stateNode: App,</span><br><span class="line">    memoizedState: <span class="literal">null</span>, <span class="comment">// ä¿å­˜hooksæ•°æ® ä¸€æ¡é“¾è¡¨ æ¯ä¸€ä¸ªhookæ•°æ®</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">schedule</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    workInProgressHook = fiber.memoizedState</span><br><span class="line">    <span class="keyword">const</span> app = fiber.stateNode()</span><br><span class="line">    isMount = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> app</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useState</span>(<span class="params">initState</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> hook;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isMount) &#123;</span><br><span class="line">        hook = &#123;  <span class="comment">// å•å‘é“¾è¡¨</span></span><br><span class="line">            memoizedState: initState,</span><br><span class="line">            next: <span class="literal">null</span>,</span><br><span class="line">            queue: &#123;</span><br><span class="line">                pending: <span class="literal">null</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!fiber.memoizedState) &#123;</span><br><span class="line">            fiber.memoizedState = hook</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            workInProgressHook.next = hook</span><br><span class="line">        &#125;</span><br><span class="line">        workInProgressHook = hook</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//  å·²ç»æœ‰ä¸€æ¡é“¾è¡¨äº†</span></span><br><span class="line">        hook = workInProgressHook; <span class="comment">// å–åˆ°äº†</span></span><br><span class="line">        workInProgressHook = workInProgressHook.next; <span class="comment">// æŒ‡å‘ä¸‹ä¸€ä¸ª</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å–åˆ°äº†å½“å‰useStateå¯¹åº”çš„æ•°æ® ï¼Œthen è®¡ç®—æ–°çŠ¶æ€</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> baseState = hook.memoizedState</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hook.queue.pending) &#123;</span><br><span class="line">        <span class="keyword">let</span> firstUpdate = hook.queue.pending.next <span class="comment">// ç¬¬ä¸€ä¸ªupdate</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> action = firstUpdate.action</span><br><span class="line">            baseState = action(baseState);</span><br><span class="line">            firstUpdate = firstUpdate.next <span class="comment">// æŒ‡å‘ä¸‹ä¸€ä¸ª</span></span><br><span class="line">        &#125; <span class="keyword">while</span> (firstUpdate != hook.queue.pending.next)</span><br><span class="line"></span><br><span class="line">        hook.queue.pending = <span class="literal">null</span> <span class="comment">// è®¡ç®—å®Œ æ¸…ç©º</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    hook.memoizedState = baseState</span><br><span class="line">    <span class="keyword">return</span> [baseState, dispatchAction.bind(<span class="literal">null</span>, hook.queue)]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// setNum - action</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dispatchAction</span>(<span class="params">queue, action</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºæ•°æ®ç»“æ„updateï¼Œæ¯æ¬¡æ›´æ–°æœ‰ä¼˜å…ˆçº§çš„ï¼Œclick &gt; fecth</span></span><br><span class="line">    <span class="keyword">const</span> update = &#123;</span><br><span class="line">        action, <span class="comment">// ç¯è£…é“¾è¡¨</span></span><br><span class="line">        next: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é“¾è¡¨æ“ä½œ</span></span><br><span class="line">    <span class="keyword">if</span> (queue.pending === <span class="literal">null</span>) &#123;</span><br><span class="line">        update.next = update</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// u0 -&gt; u0</span></span><br><span class="line">        <span class="comment">// u1 -&gt; u0 -&gt; u1</span></span><br><span class="line">        <span class="comment">// queue.pending æœ€åä¸€ä¸ªupdate</span></span><br><span class="line">        <span class="comment">// queue.pending.next ç¬¬ä¸€ä¸ªupdate</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"ç¬¬ä¸€ä¸ªupdate"</span>,queue.pending.next)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"æœ€åä¸€ä¸ªupdate"</span>,queue.pending)</span><br><span class="line">        update.next = queue.pending.next; <span class="comment">// u1 =&gt; u0</span></span><br><span class="line">        queue.pending.next = update; <span class="comment">// u0 =&gt; u1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ¯æ¬¡æ‰§è¡Œå°±æ˜¯æœ€åä¸€ä¸ªupdate</span></span><br><span class="line">    queue.pending = update</span><br><span class="line"></span><br><span class="line">    schedule()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// FC ä¿å­˜hooksæ•°æ®</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [num, setNum] = useState(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">const</span> [num1, setNum1] = useState(<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">const</span> [num2, setNum2] = useState(<span class="number">22</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(isMount)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"num"</span>,num)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"num1"</span>,num1)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"num2"</span>,num2)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"----"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        onClick() &#123;</span><br><span class="line">            setNum(<span class="function"><span class="params">num</span> =&gt;</span> num + <span class="number">1</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        set() &#123;</span><br><span class="line">            setNum1(<span class="function"><span class="params">num</span> =&gt;</span> num + <span class="number">10</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        set2() &#123;</span><br><span class="line">            setNum2(<span class="function"><span class="params">num</span> =&gt;</span> num + <span class="number">10</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.app = schedule()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      ä»0 -&gt; Hooks
    
    </summary>
    
      <category term="React" scheme="https://kitions.github.io/categories/React/"/>
    
    
      <category term="React" scheme="https://kitions.github.io/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>wx-open-launch-appæŒ‡å—</title>
    <link href="https://kitions.github.io/2020/10/21/wx-open-launch-app%E9%87%87%E5%9D%91%E6%8C%87%E5%8D%97/"/>
    <id>https://kitions.github.io/2020/10/21/wx-open-launch-appé‡‡å‘æŒ‡å—/</id>
    <published>2020-10-21T08:10:03.000Z</published>
    <updated>2020-10-21T08:13:41.071Z</updated>
    
    <content type="html"><![CDATA[<h1 id="wx-open-launch-appæŒ‡å—"><a href="#wx-open-launch-appæŒ‡å—" class="headerlink" title="wx-open-launch-appæŒ‡å—"></a>wx-open-launch-appæŒ‡å—</h1><p>ä»Šå¹´5æœˆå¾®ä¿¡åˆšå¼€æ”¾çš„APIï¼Œä»¥å¾€åªå¯¹å®ƒæŠ•èµ„çš„å…¬å¸ï¼Œæˆ–è€…å¹²å„¿å­å¼€æ”¾ï¼Œç°åœ¨å¯¹ç»‘å®šæœåŠ¡å·ä¸”è®¤è¯çš„ä¼ä¸šéƒ½å¼€æ”¾äº†ï¼Œæ¥å…¥ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯æ„Ÿè§‰æ–‡æ¡£å¤ªç®€å•ï¼Œè¦†ç›–é¢ä¸è¶³ï¼Œä¸è¿‡éƒ½å¯ä»¥è‡ªå·±é‡‡å‘æ¥è§£å†³ï¼Œå¯ä»¥å»<a href="https://developers.weixin.qq.com/community/" target="_blank" rel="noopener">å¾®ä¿¡å¼€æ”¾ç¤¾åŒº</a>æé—®æˆ–è€…æ‰¾ç›¸åº”åˆ«äººè¸©è¿‡çš„å‘æ‰¾ç­”æ¡ˆã€‚</p><h2 id="ä¸€ã€æ¥å…¥"><a href="#ä¸€ã€æ¥å…¥" class="headerlink" title="ä¸€ã€æ¥å…¥"></a>ä¸€ã€æ¥å…¥</h2><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gjx07td2opj30tw07ut9u.jpg" alt="image-20201021155005245"></p><p>è·å¾—æ­¤è®¾ç½®å…¥å£çš„æƒé™ï¼Œéœ€åŒæ—¶æ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼š</p><ol><li>æœåŠ¡å·å·²è®¤è¯</li><li>å¼€æ”¾å¹³å°è´¦å·å·²è®¤è¯</li><li>æœåŠ¡å·ä¸å¼€æ”¾å¹³å°è´¦å·åŒä¸»ä½“</li></ol><h3 id="ç»‘å®šåŸŸåå’Œç§»åŠ¨åº”ç”¨"><a href="#ç»‘å®šåŸŸåå’Œç§»åŠ¨åº”ç”¨" class="headerlink" title="ç»‘å®šåŸŸåå’Œç§»åŠ¨åº”ç”¨"></a>ç»‘å®šåŸŸåå’Œç§»åŠ¨åº”ç”¨</h3><ol><li>ç»‘å®šåŸŸåçš„è¦æ±‚ï¼š</li></ol><ul><li>åŸŸåé¡»ä¸ºå½“å‰æœåŠ¡å·çš„ JS å®‰å…¨åŸŸåæˆ–å…¶å­åŸŸå</li><li>åŸŸååªèƒ½åŒæ—¶ç»‘å®šä¸€ä¸ªç§»åŠ¨åº”ç”¨ï¼Œå› æ­¤é¡»ç¡®ä¿åŸŸåæœªè¢«å…¶ä»–ç§»åŠ¨åº”ç”¨ç»‘å®š</li></ul><ol start="2"><li>ç»‘å®šç§»åŠ¨åº”ç”¨çš„è¦æ±‚</li></ol><ul><li>åªèƒ½ç»‘å®šåŒä¸€å¾®ä¿¡å¼€æ”¾å¹³å°è´¦å·ä¸‹å®¡æ ¸é€šè¿‡çš„ç§»åŠ¨åº”ç”¨</li></ul><ol start="3"><li>ç»‘å®šæ¬¡æ•°</li></ol><ul><li>æ¯æœˆå¯ä¿®æ”¹ç»‘å®š3æ¬¡</li></ul><hr><p>ä»¥ä¸Šæ˜¯ äº§å“ç»ç†è´Ÿè´£ä¿®æ”¹ï¼Œä½ åªéœ€è¦æ‹¿åˆ°appçš„idï¼Œå°ç¨‹åºçš„idï¼Œç¡®ä¿ç¬¬ä¸€å¼ å›¾çš„å®‰å…¨åŸŸåè·Ÿä½ å¼€å‘çš„ç«™çš„å®Œå…¨ä¸€è‡´ï¼Œä¸æ”¯æŒäºŒçº§åŸŸåå“¦ï¼</p><p>ä»¥ä¸‹ä»£ç æ˜¯åœ¨ä½ é¡µé¢ä¸­å·²ç»æ³¨å…¥è¿‡wx.configçš„æ¡ä»¶ä¸‹,å¹¶ä¸”æ–°å¢</p><p>wx.config { openTagList: [â€˜wx-open-launch-appâ€™, â€˜wx-open-launch-weappâ€™]}</p><h3 id="åœ¨ä½ çš„H5ä¸­æ¥å…¥å¾®ä¿¡å¼€æ”¾æ ‡ç­¾"><a href="#åœ¨ä½ çš„H5ä¸­æ¥å…¥å¾®ä¿¡å¼€æ”¾æ ‡ç­¾" class="headerlink" title="åœ¨ä½ çš„H5ä¸­æ¥å…¥å¾®ä¿¡å¼€æ”¾æ ‡ç­¾"></a>åœ¨ä½ çš„H5ä¸­æ¥å…¥å¾®ä¿¡å¼€æ”¾æ ‡ç­¾</h3><h4 id="1-å¾®ä¿¡å°ç¨‹åº"><a href="#1-å¾®ä¿¡å°ç¨‹åº" class="headerlink" title="1. å¾®ä¿¡å°ç¨‹åº"></a>1. å¾®ä¿¡å°ç¨‹åº</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;wx-open-launch-weapp</span><br><span class="line">                          id=<span class="string">"launch-btn-weapp"</span></span><br><span class="line">                          username=<span class="string">"gh_*****"</span></span><br><span class="line">                          path=<span class="string">"pages/home/home.html"</span></span><br><span class="line">                      &gt;</span><br><span class="line">                          &lt;script type=<span class="string">"text/wxtag-template"</span>&gt;</span><br><span class="line">                              &lt;div className=<span class="string">"btn1"</span> style=&#123;&#123; <span class="attr">width</span>: <span class="string">'170px'</span>, <span class="attr">height</span>: <span class="string">'70px'</span>, <span class="attr">lineHeight</span>: <span class="string">"70px"</span>, <span class="attr">color</span>: <span class="string">"rgba(0,0,0,1)"</span>, <span class="attr">display</span>: <span class="string">"block"</span>, <span class="attr">fontSize</span>: <span class="string">"38px"</span>, <span class="attr">textAlign</span>: <span class="string">"center"</span> &#125;&#125;&gt;æ‰“å¼€å°ç¨‹åº&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">                          &lt;/</span>script&gt;</span><br><span class="line">                          &#123;<span class="comment">/* @ts-ignore */</span>&#125;</span><br><span class="line">                      &lt;<span class="regexp">/wx-open-launch-weapp&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-APP"><a href="#2-APP" class="headerlink" title="2.  APP"></a>2.  APP</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt; wx-open-launch-app</span><br><span class="line">id = <span class="string">"launch-btn-app"</span></span><br><span class="line">appid = <span class="string">""</span></span><br><span class="line">extinfo = &#123;<span class="string">`å¸¦ç»™appçš„ä¿¡æ¯ å¯ä»¥ä½¿ç”¨åè®®ï¼Œè®©appç«¯æ¥å—`</span>&#125;</span><br><span class="line">&gt;</span><br><span class="line">&lt;script type=<span class="string">"text/wxtag-template"</span> &gt;</span><br><span class="line">&lt;div style=&#123;&#123; <span class="attr">width</span>: <span class="string">'170px'</span>, <span class="attr">height</span>: <span class="string">'70px'</span>, <span class="attr">lineHeight</span>: <span class="string">"70px"</span>, <span class="attr">color</span>: <span class="string">"rgba(0,0,0,1)"</span>, <span class="attr">display</span>: <span class="string">"block"</span>, <span class="attr">fontSize</span>: <span class="string">"38px"</span>, <span class="attr">textAlign</span>: <span class="string">"center"</span> &#125;&#125;&gt; æ‰“å¼€App &lt; <span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt; /</span>script&gt;</span><br><span class="line">&#123;<span class="comment">/* @ts-ignore */</span> &#125;</span><br><span class="line">&lt;<span class="regexp">/wx-open-launch-app&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-JSç”ŸæˆDom"><a href="#3-JSç”ŸæˆDom" class="headerlink" title="3. JSç”ŸæˆDom"></a>3. JSç”ŸæˆDom</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">dom.innerHTML = <span class="string">'&lt;wx-open-launch-app style="width:100%; display:block;" id="launch-btn"  extinfo="" appid=""&gt;&lt;template&gt;&lt;div class="wx-btn" style="color:#fff;text-align:center" &gt;JSç”Ÿæˆçš„æŒ‰é’®&lt;/div&gt;&lt;/template&gt;&lt;/wx-open-launch-app&gt;'</span></span><br><span class="line">           <span class="keyword">var</span> launchBtn = <span class="built_in">document</span>.getElementById(<span class="string">'launch-btn'</span>)</span><br><span class="line">           <span class="built_in">console</span>.log(<span class="string">"launchBtn"</span>, launchBtn)</span><br><span class="line">           <span class="keyword">if</span> (!launchBtn) &#123;</span><br><span class="line">               <span class="keyword">return</span></span><br><span class="line">           &#125;</span><br><span class="line">           launchBtn.addEventListener(<span class="string">'launch'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">               <span class="built_in">console</span>.log(<span class="string">'btlaunchBtnn success'</span>)</span><br><span class="line">           &#125;)</span><br><span class="line">           launchBtn.addEventListener(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e: any</span>) </span>&#123;</span><br><span class="line">               <span class="built_in">console</span>.log(<span class="string">'launchBtnfail'</span>, e.detail)</span><br><span class="line">           &#125;)</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸€åˆ‡æ­£å¸¸çš„è¯ï¼Œå°±å¯ä»¥å”¤èµ·ä½ çš„å°ç¨‹åºå’ŒAPPäº†</p><p>æ³¨æ„çš„æ˜¯</p><blockquote><p>å¾®ä¿¡ç‰ˆæœ¬è¦æ±‚ä¸ºï¼š7.0.12åŠä»¥ä¸Šã€‚ ç³»ç»Ÿç‰ˆæœ¬è¦æ±‚ä¸ºï¼šiOS 10.3åŠä»¥ä¸Šã€Android 5.0åŠä»¥ä¸Šï¼Œweixin.js ç‰ˆæœ¬1.6.0ä»¥ä¸Š</p><p><a href="https://res.wx.qq.com/open/js/jweixin-1.6.0.js" target="_blank" rel="noopener">https://res.wx.qq.com/open/js/jweixin-1.6.0.js</a></p></blockquote><h4 id="4-é”™è¯¯è¿”å›"><a href="#4-é”™è¯¯è¿”å›" class="headerlink" title="4.  é”™è¯¯è¿”å›"></a>4.  é”™è¯¯è¿”å›</h4><p><code>error</code>äº‹ä»¶è¿”å›å€¼<code>errMsg</code>è¯´æ˜å¦‚ä¸‹ã€‚</p><table><thead><tr><th style="text-align:left">errMsg</th><th style="text-align:left">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left">â€œlaunch:failâ€</td><td style="text-align:left">è°ƒâ½¤å¤±è´¥ï¼Œæˆ–å®‰å“ä¸Šè¯¥åº”ç”¨æœªå®‰è£…ï¼Œæˆ–iOSä¸Šç”¨æˆ·åœ¨å¼¹çª—ä¸Šç‚¹å‡»ç¡®è®¤ä½†è¯¥åº”â½¤æœªå®‰è£…</td></tr><tr><td style="text-align:left">â€œlaunch:fail_check failâ€</td><td style="text-align:left">æ ¡éªŒAppè·³è½¬æƒé™å¤±è´¥ï¼Œè¯·ç¡®è®¤æ˜¯å¦æ­£ç¡®ç»‘å®šAppID</td></tr></tbody></table><h2 id="äºŒã€å‘-ä¸èƒ½æ˜¯äºŒçº§åŸŸå"><a href="#äºŒã€å‘-ä¸èƒ½æ˜¯äºŒçº§åŸŸå" class="headerlink" title="äºŒã€å‘ - ä¸èƒ½æ˜¯äºŒçº§åŸŸå"></a>äºŒã€å‘ - ä¸èƒ½æ˜¯äºŒçº§åŸŸå</h2><p>ç»æŸ¥è¯ï¼Œåªèƒ½æ˜¯å…·ä½“åŸŸåï¼Œä¸èƒ½æ˜¯äºŒçº§åŸŸå</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gjwzr9w156j30ok0b1zlo.jpg" alt="image-20201021153405769"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gjwzs1cl1cj30oe05t0t6.jpg" alt="image-20201021153455648"></p><h2 id="ä¸‰ã€å‚è€ƒé“¾æ¥"><a href="#ä¸‰ã€å‚è€ƒé“¾æ¥" class="headerlink" title="ä¸‰ã€å‚è€ƒé“¾æ¥"></a>ä¸‰ã€å‚è€ƒé“¾æ¥</h2><ol><li><p><a href="https://developers.weixin.qq.com/doc/oplatform/Mobile_App/WeChat_H5_Launch_APP.html" target="_blank" rel="noopener">å¾®ä¿¡å†…H5è·³è½¬APPæˆ–è€…å°ç¨‹åºæ–‡æ¡£</a></p></li><li><p><a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_Open_Tag.html" target="_blank" rel="noopener">å¾®ä¿¡å¼€æ”¾æ ‡ç­¾è¯´æ˜æ–‡æ¡£</a></p></li><li><a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html#1" target="_blank" rel="noopener">JS-SDKä½¿ç”¨æ­¥éª¤</a></li><li><a href="https://www.cnblogs.com/willian/p/13293030.html" target="_blank" rel="noopener">cnblogså…¶ä»–äººé‡‡å‘</a></li><li><a href="https://blog.csdn.net/WangYC_/article/details/107089709" target="_blank" rel="noopener">csdnå…¶ä»–äººé‡‡å‘</a></li><li><a href="https://developers.weixin.qq.com/community/develop/doc/0000065f1741801069eaec5e55b400?_at=1603177240329" target="_blank" rel="noopener">å®˜æ–¹å›å¤åŸŸåissues</a></li><li><a href="https://developers.weixin.qq.com/community/develop/doc/000082dea443f0d2042b5081156000" target="_blank" rel="noopener">è‡ªå·±æçš„åŸŸåissues</a></li></ol><h2 id="å››ã€å®Œæ•´ä»£ç "><a href="#å››ã€å®Œæ•´ä»£ç " class="headerlink" title="å››ã€å®Œæ•´ä»£ç "></a>å››ã€å®Œæ•´ä»£ç </h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tsx</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>.isAllowWeixinTag(userAgent)</span><br><span class="line">?</span><br><span class="line"><span class="comment">// å¾®ä¿¡ç¯å¢ƒ</span></span><br><span class="line">&lt;&gt;</span><br><span class="line">&#123;<span class="comment">/* @ts-ignore */</span> &#125;</span><br><span class="line">&lt; wx-open-launch-app</span><br><span class="line">id = <span class="string">"launch-btn-app"</span></span><br><span class="line">appid = <span class="string">""</span></span><br><span class="line">extinfo = &#123;<span class="string">`å¸¦ç»™appçš„ä¿¡æ¯ å¯ä»¥ä½¿ç”¨åè®®ï¼Œè®©appç«¯æ¥å—`</span>&#125;</span><br><span class="line">&gt;</span><br><span class="line">&lt;script type=<span class="string">"text/wxtag-template"</span> &gt;</span><br><span class="line">&lt;div style=&#123;&#123; <span class="attr">width</span>: <span class="string">'170px'</span>, <span class="attr">height</span>: <span class="string">'70px'</span>, <span class="attr">lineHeight</span>: <span class="string">"70px"</span>, <span class="attr">color</span>: <span class="string">"rgba(0,0,0,1)"</span>, <span class="attr">display</span>: <span class="string">"block"</span>, <span class="attr">fontSize</span>: <span class="string">"38px"</span>, <span class="attr">textAlign</span>: <span class="string">"center"</span> &#125;&#125;&gt; æ‰“å¼€App &lt; <span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt; /</span>script&gt;</span><br><span class="line">&#123;<span class="comment">/* @ts-ignore */</span> &#125;</span><br><span class="line">&lt;<span class="regexp">/wx-open-launch-app&gt;</span></span><br><span class="line"><span class="regexp">&lt; /</span>&gt;</span><br><span class="line">: <span class="xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">"go_to_app"</span> <span class="attr">onClick</span> = <span class="string">&#123;</span> <span class="attr">this.onApp</span> &#125; &gt;</span> æ‰“å¼€APP <span class="tag">&lt; /<span class="attr">span</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// äº‹ä»¶ç›‘å¬</span></span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">this</span>.isAllowWeixinTag(<span class="keyword">this</span>.props.userAgent)) <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">"launch-btn-app"</span>)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"app"</span>, btn)</span><br><span class="line">            <span class="keyword">if</span>(!btn) <span class="keyword">return</span></span><br><span class="line">            btn.addEventListener(<span class="string">'launch'</span>, (e: any) =&gt; &#123;</span><br><span class="line">                <span class="comment">// åœ¨æ­¤å¤„å¯è®¾ç½®ç²˜è´´æ¿å†…æ•°æ®ï¼Œæ•°æ®æ˜¯ä¼ é€’ç»™ app çš„å‚æ•°è¿›ï¼Œ</span></span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">' app success'</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">            btn.addEventListener(<span class="string">'error'</span>, (e: any) =&gt; &#123;</span><br><span class="line">                <span class="comment">// åœ¨æ­¤å¤„å¯è®¾ç½®ç²˜è´´æ¿å†…æ•°æ®ï¼Œæ•°æ®æ˜¯ä¼ é€’ç»™ app çš„å‚æ•°ï¼Œ</span></span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'app'</span>, e.detail);</span><br><span class="line">                <span class="comment">// å”¤é†’å¤±è´¥çš„æƒ…å†µä¸‹,å¯ä»¥æ‰“å¼€appç­‰</span></span><br><span class="line">                <span class="keyword">this</span>.onApp()</span><br><span class="line">            &#125;);    </span><br><span class="line">    </span><br><span class="line"> </span><br><span class="line"><span class="comment">//function</span></span><br><span class="line">    </span><br><span class="line">isAllowWeixinTag(userAgent: string)&#123;</span><br><span class="line">      &#123;<span class="comment">/* 1.å¾®ä¿¡ç¯å¢ƒ  2.å¾®ä¿¡ç‰ˆæœ¬å¤§äº7.0.12 */</span>&#125;</span><br><span class="line">     <span class="keyword">return</span> UA(userAgent).isWechat &amp;&amp; HandleJudgeWechat(userAgent)</span><br><span class="line">&#125;    </span><br><span class="line"><span class="keyword">const</span> HandleJudgeWechat = <span class="function">(<span class="params">ua: string</span>)=&gt;</span> &#123;</span><br><span class="line"><span class="keyword">let</span> wechat = ua.match(<span class="regexp">/MicroMessenger\/([\d\.]+)/i</span>);</span><br><span class="line"><span class="keyword">let</span> judgewechat = wechat[<span class="number">1</span>].split(<span class="string">'.'</span>)</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">Number</span>(judgewechat[<span class="number">0</span>]) &gt;= <span class="number">7</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">Number</span>(judgewechat[<span class="number">1</span>]) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">Number</span>(judgewechat[<span class="number">2</span>]) &gt;= <span class="number">12</span>) &#123;</span><br><span class="line"><span class="comment">// console.log("å½“å‰å¾®ä¿¡ç‰ˆæœ¬å¤§äº7.0.12 å¯æ‰“å¼€æŒ‡å®šapp")</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äº”ã€-æ€»ç»“"><a href="#äº”ã€-æ€»ç»“" class="headerlink" title="äº”ã€ æ€»ç»“"></a>äº”ã€ æ€»ç»“</h2><p>è¾ƒä¸ºç®€å•çš„æ¥å…¥ã€‚</p><p>åªèƒ½åˆ°å¾®ä¿¡å®‰å…¨åŸŸåä¸‹æµ‹è¯•ï¼Œå®åœ¨æ˜¯éº»çƒ¦ï¼Œå¯¼è‡´ åªèƒ½å‘ç‰ˆæµ‹è¯•ï¼Œè€Œä¸”å”¤é†’ç»‘å®šçš„é‚£ä¸ªåŸŸåæ˜¯æ­£å¼ç¯å¢ƒçš„ï¼Œç•¥éº»çƒ¦ã€‚å¾®ä¿¡å¼€å‘è€…å·¥å…·å¯¹è¿™ä¸ªæ–°æ ‡ç­¾å…¼å®¹æ€§ä¸æ˜¯å¾ˆå¥½ã€‚</p>]]></content>
    
    <summary type="html">
    
      ä»Šå¹´5æœˆå¾®ä¿¡æ–°å¼€æ”¾çš„api ï¼Œ å¾®ä¿¡ç¯å¢ƒH5å”¤èµ·APPå’Œå°ç¨‹åºå®è·µ
    
    </summary>
    
      <category term="é»˜è®¤åˆ†ç±»" scheme="https://kitions.github.io/categories/%E9%BB%98%E8%AE%A4%E5%88%86%E7%B1%BB/"/>
    
    
      <category term="å¾®ä¿¡" scheme="https://kitions.github.io/tags/%E5%BE%AE%E4%BF%A1/"/>
    
  </entry>
  
  <entry>
    <title>ç¾¤æ™–Momentså‘é€æœªçŸ¥é”™è¯¯</title>
    <link href="https://kitions.github.io/2020/10/18/%E7%BE%A4%E8%BE%89Moment/"/>
    <id>https://kitions.github.io/2020/10/18/ç¾¤è¾‰Moment/</id>
    <published>2020-10-18T08:24:19.000Z</published>
    <updated>2020-10-21T08:09:47.458Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç¾¤æ™–Momentså‘é€æœªçŸ¥é”™è¯¯ï¼Œè¯·å†è¯•ä¸€æ¬¡"><a href="#ç¾¤æ™–Momentså‘é€æœªçŸ¥é”™è¯¯ï¼Œè¯·å†è¯•ä¸€æ¬¡" class="headerlink" title="ç¾¤æ™–Momentså‘é€æœªçŸ¥é”™è¯¯ï¼Œè¯·å†è¯•ä¸€æ¬¡"></a>ç¾¤æ™–Momentså‘é€æœªçŸ¥é”™è¯¯ï¼Œè¯·å†è¯•ä¸€æ¬¡</h1><p>æŒ‰ä¸‹é¢å›¾çš„æ­¥éª¤æ¥å°±å¥½äº†ï¼Œå…ˆåˆ ä¸‰ä¸ªå¥—ä»¶ï¼Œé‡å¯ï¼Œå®‰è£…momentsï¼Œæœ€åæ¢å¤ç´¢å¼•ï¼Œå°±å¥½äº†ã€‚ä¸‹é¢çš„å›¾å°±ä¸è§£é‡Šäº†</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gjvsfj1awqj30hb0910sv.jpg" alt="image-20201020143501721"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gjvsg8dc4nj30lc0eoq57.jpg" alt="image-20201020143549313"></p><p>æ—¶é—´æ¯”è¾ƒé•¿ï¼Œç­‰ç­‰</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gjvskxusuhj30oi0fwju3.jpg" alt="image-20201020144021076"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gjvsmi01q4j30k90g7acq.jpg" alt="image-20201020144150773"></p><p>æˆ‘è¿™ä¸ªç¾¤è¾‰ åº”ç”¨ç¨‹åºæœåŠ¡çš„å›¾æ ‡æ˜¯é”™çš„ï¼Œä¸çŸ¥é“ä¸ºå•¥</p><p>æœ€åä¸€æ­¥ é‡å¯NAS</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gjvsnl2j26j30gx09w42m.jpg" alt="image-20201020144253666"></p><p>æœ€æœ€å é‡å¯ï¼Œå®‰è£…momentï¼Œå®ƒä¼šè‡ªåŠ¨ä¸‹è½½ç¾¤è¾‰åº”ç”¨ç¨‹åºå’Œdriveã€‚Node.jsæˆ‘æœ¬æœºæ˜¯å®‰è£…çš„ï¼Œæ‰€ä»¥ä¸ç”¨é‡æ–°ä¸‹äº†</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gjvsse9kjvj30e308g0t8.jpg" alt="image-20201020144731049"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gjvstr8f0aj30kh0duq5p.jpg" alt="image-20201020144848581"></p><p>å› ä¸ºé‡è£…äº†driveï¼Œå®ƒä¼šå»ç´¢å¼•æ–‡ä»¶å¤¹</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gjvsy80htwj30e607pjta.jpg" alt="image-20201020145306329"></p><p>æ‰“å¼€momentï¼Œå¥½äº†</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gjvtpfzcj8j31f00npgp4.jpg" alt="image-20201020151858761"></p><p>æ¥ç€ æˆ‘ä»¬è¦ç‚¹å¼€å·¦ä¸‹è§’çš„è®¾ç½®ï¼Œè¦é‡å»ºç´¢å¼•</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gjvtr12oefj30mu0hgjta.jpg" alt="image-20201020152040110"></p><p>çœ‹åˆ°å›¾ç‰‡ æ…¢æ…¢æœ‰äº†</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gjvttn2c82j31e50mvt9x.jpg" alt="image-20201020152316292"></p>]]></content>
    
    <summary type="html">
    
      æˆ‘çš„ç¾¤æ™–å†…ç½®çš„å­˜å‚¨ç©ºé—´1åäº†ï¼Œæ–°æ¢äº†å—å›ºæ€ï¼Œå¯åŠ¨Momentsé‡åˆ°è¿™ä¸ªé—®é¢˜
    
    </summary>
    
      <category term="é»˜è®¤åˆ†ç±»" scheme="https://kitions.github.io/categories/%E9%BB%98%E8%AE%A4%E5%88%86%E7%B1%BB/"/>
    
    
      <category term="ç¾¤æ™–" scheme="https://kitions.github.io/tags/%E7%BE%A4%E6%99%96/"/>
    
  </entry>
  
  <entry>
    <title>H5å”¤é†’APP ç®€å•hackeræ–¹æ³•</title>
    <link href="https://kitions.github.io/2020/10/15/H5%E5%94%A4%E9%86%92APP%20%E7%AE%80%E5%8D%95hacker%E6%96%B9%E6%B3%95/"/>
    <id>https://kitions.github.io/2020/10/15/H5å”¤é†’APP ç®€å•hackeræ–¹æ³•/</id>
    <published>2020-10-15T03:58:39.000Z</published>
    <updated>2020-10-15T03:59:44.914Z</updated>
    
    <content type="html"><![CDATA[<h2 id="H5å”¤é†’APP-ç®€å•hackeræ–¹æ³•"><a href="#H5å”¤é†’APP-ç®€å•hackeræ–¹æ³•" class="headerlink" title="H5å”¤é†’APP ç®€å•hackeræ–¹æ³•"></a>H5å”¤é†’APP ç®€å•hackeræ–¹æ³•</h2><p>æœ¬è´¨ä¸Šæµè§ˆå™¨æ˜¯é€šè¿‡URLschemeæ‰“å¼€APPï¼Œä¸€ä¸ªAPPå¯ä»¥è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ªæ‰“å¼€è‡ªå·±çš„URL schemeã€‚ç±»ä¼¼äºzhihu://</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> APPRouter = <span class="function">(<span class="params">router: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isWeiXin()) &#123;</span><br><span class="line">        <span class="comment">// alert("è¯·ç‚¹å‡»å³ä¸Šè§’æ‰“å¼€å…¶ä»–æµè§ˆå™¨")</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">window</span>.location.href = router</span><br><span class="line">      </span><br><span class="line">        <span class="keyword">if</span>(isAndroid())&#123;</span><br><span class="line">          <span class="comment">// å®‰å“ </span></span><br><span class="line">            <span class="keyword">var</span> t = <span class="built_in">Date</span>.now()</span><br><span class="line">            setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">Date</span>.now() - t &lt; <span class="number">1200</span>) &#123;</span><br><span class="line">                    <span class="built_in">window</span>.location.href = <span class="string">`ä½ appä¸‹è½½åŸŸå`</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="number">1000</span>)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="comment">// è‹¹æœ</span></span><br><span class="line">            setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">window</span>.location.href = <span class="string">`ä½ appä¸‹è½½åŸŸå`</span></span><br><span class="line">            &#125;, <span class="number">250</span>)</span><br><span class="line">            setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">window</span>.location.reload()</span><br><span class="line">            &#125;, <span class="number">1000</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®‰å“è®¾ç½®çš„åŸç†ï¼š"><a href="#å®‰å“è®¾ç½®çš„åŸç†ï¼š" class="headerlink" title="å®‰å“è®¾ç½®çš„åŸç†ï¼š"></a>å®‰å“è®¾ç½®çš„åŸç†ï¼š</h3><p>å¦‚æœè®¾ç½®æ¯”è¾ƒå°çš„è¿è¡Œé—´éš”ï¼ˆ&lt;30msï¼‰ï¼Œåœ¨æµè§ˆå™¨æˆ–è€…webviewä¸­ï¼Œåº”ç”¨åˆ‡æ¢åˆ°åå°ï¼ŒsetIntervalä¼šè¢«å¾ˆæ˜æ˜¾çš„å»¶è¿Ÿæ‰§è¡Œï¼Œæ¯”å¦‚è®¾ç½®ä¸€ä¸ªè¿è¡Œé—´éš”20msï¼Œæ€»è®¡è¿è¡Œ100æ¬¡çš„å®šæ—¶å™¨ï¼Œå¦‚æœé¡µé¢ä¸€ç›´å¤„äºå‰å°ï¼Œåˆ™100æ¬¡è·‘å®Œï¼Œæ€»è€—æ—¶ä¸100x20=2000msä¸ä¼šæœ‰å¤ªå¤§å·®å¼‚ï¼Œä½†é¡µé¢åœ¨åå°è¿è¡Œæ—¶ï¼Œæ­¤æ—¶é—´ä¼šæ˜æ˜¾è¶…è¿‡2000msã€‚å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ¥å®ç°æ˜¯å¦æˆåŠŸæ‰“å¼€APPæ£€æµ‹åŠå›è°ƒã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> t = <span class="built_in">Date</span>.now()</span><br><span class="line">            setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">Date</span>.now() - t &lt; <span class="number">1200</span>) &#123;</span><br><span class="line">                    <span class="built_in">window</span>.location.href = <span class="string">`ä½ appä¸‹è½½åŸŸå`</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure><h3 id="è‹¹æœè®¾ç½®çš„åŸç†ï¼š"><a href="#è‹¹æœè®¾ç½®çš„åŸç†ï¼š" class="headerlink" title="è‹¹æœè®¾ç½®çš„åŸç†ï¼š"></a>è‹¹æœè®¾ç½®çš„åŸç†ï¼š</h3><p>APPå·²å®‰è£…è¿™æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†å¦‚æœAPPæœªå®‰è£…ï¼Œè·³App Store çš„è¯·æ±‚ä¼šå¤±è´¥ã€‚ è¿™æ—¶å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªå®šæ—¶å™¨</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                   <span class="built_in">window</span>.location.href = <span class="string">`ä½ appä¸‹è½½åŸŸå`</span></span><br><span class="line">           &#125;, <span class="number">250</span>)</span><br><span class="line">           setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                   <span class="built_in">window</span>.location.reload()</span><br><span class="line">           &#125;, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure><h3 id="Iframe"><a href="#Iframe" class="headerlink" title="Iframe"></a>Iframe</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ifm = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>);</span><br><span class="line"></span><br><span class="line">      ifm.setAttribute(<span class="string">'src'</span>, wakeupUrl);</span><br><span class="line">      ifm.setAttribute(<span class="string">'style'</span>, <span class="string">'display:none'</span>);</span><br><span class="line">      <span class="built_in">document</span>.body.appendChild(ifm);</span><br><span class="line">      onBeforeWakeup &amp;&amp; onBeforeWakeup();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> currentTime = <span class="built_in">Date</span>.now();</span><br><span class="line"></span><br><span class="line">      setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> nowTime = <span class="built_in">Date</span>.now();</span><br><span class="line">          <span class="keyword">if</span> (nowTime - currentTime &lt; <span class="number">1050</span>) &#123;</span><br><span class="line">            <span class="comment">// å›è°ƒ</span></span><br><span class="line">              onWakeupFail &amp;&amp; onWakeupFail();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><h3 id="å¼•å¯¼é¡µ"><a href="#å¼•å¯¼é¡µ" class="headerlink" title="å¼•å¯¼é¡µ"></a>å¼•å¯¼é¡µ</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> H5ToApp = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(div);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> template = <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;div class="h5_toweixin" style="z-index: 9999;position: absolute;width: 100%;top: 0px;left: 0;height: 100%;"&gt;</span></span><br><span class="line"><span class="string">        &lt;img src="/images/h5-weixin.png" alt="å¼•å¯¼åˆ°å¾®ä¿¡"/&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;`</span></span><br><span class="line">    <span class="keyword">const</span> bodyScroll = <span class="function">(<span class="params">event: any</span>) =&gt;</span> &#123;</span><br><span class="line">        event.stopPropagation();</span><br><span class="line">        event.preventDefault();</span><br><span class="line">    &#125;</span><br><span class="line">    div.appendChild(parseElement(template))</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">'touchmove'</span>, bodyScroll);</span><br><span class="line">    <span class="built_in">document</span>.body.style.position = <span class="string">'fixed'</span>;</span><br><span class="line">    <span class="built_in">document</span>.addEventListener(<span class="string">"click"</span>, fn)</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (div.parentNode) &#123;</span><br><span class="line">            <span class="built_in">document</span>.body.style.position = <span class="string">'static'</span>;</span><br><span class="line">            <span class="built_in">window</span>.removeEventListener(<span class="string">'touchmove'</span>, bodyScroll);</span><br><span class="line">            <span class="built_in">document</span>.removeEventListener(<span class="string">'click'</span>,fn);</span><br><span class="line">            div.parentNode.removeChild(div);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> parseElement = <span class="function">(<span class="params">htmlString: string</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DOMParser().parseFromString(htmlString, <span class="string">'text/html'</span>).body.childNodes[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;H5ToApp&#125;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å‘å¾ˆå¤šï¼Œé—®é¢˜ä¸»è¦åœ¨å®‰å“ä¸Šï¼Œä¼šæœ‰å„ç§å…¼å®¹é—®é¢˜ï¼Œæœºå‹æµè§ˆå™¨ä¼—å¤šã€‚å½“ç„¶iosä¹Ÿæœ‰ã€‚</p><p>çŸ¥ä¹çš„è§£å†³åŠæ³•æ˜¯ï¼Œæä¾›ä¸¤ä¸ªæŒ‰é’®ï¼Œä¸€ä¸ªä¸‹è½½ï¼Œä¸€ä¸ªæ‰“å¼€APPï¼Œè®©ç”¨æˆ·è‡ªå·±é€‰ã€‚</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p>é“¾æ¥ï¼š<a href="https://www.jianshu.com/p/7645ad94840d" target="_blank" rel="noopener">https://www.jianshu.com/p/7645ad94840d</a></p>]]></content>
    
    <summary type="html">
    
      H5å”¤é†’APP,æœ¬è´¨ä¸Šæµè§ˆå™¨æ˜¯é€šè¿‡URLschemeæ‰“å¼€APPï¼Œå®‰å“å’Œè‹¹æœçš„ä¸¤ä¸ªæ¯”è¾ƒhackçš„æ–¹æ³•å®ç°äº†è·³è½¬åæœ¬é¡µé¢ä¸è·³è½¬åˆ°ä¸‹è½½é¡µ
    
    </summary>
    
      <category term="é»˜è®¤åˆ†ç±»" scheme="https://kitions.github.io/categories/%E9%BB%98%E8%AE%A4%E5%88%86%E7%B1%BB/"/>
    
    
      <category term="H5" scheme="https://kitions.github.io/tags/H5/"/>
    
  </entry>
  
  <entry>
    <title>å‡½æ•°çš„æŸ¯é‡ŒåŒ–ç®€å•äº†è§£</title>
    <link href="https://kitions.github.io/2020/08/25/%E5%87%BD%E6%95%B0%E7%9A%84%E6%9F%AF%E9%87%8C%E5%8C%96/"/>
    <id>https://kitions.github.io/2020/08/25/å‡½æ•°çš„æŸ¯é‡ŒåŒ–/</id>
    <published>2020-08-25T11:41:44.000Z</published>
    <updated>2020-09-23T04:02:34.064Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‡½æ•°çš„æŸ¯é‡ŒåŒ–"><a href="#å‡½æ•°çš„æŸ¯é‡ŒåŒ–" class="headerlink" title="å‡½æ•°çš„æŸ¯é‡ŒåŒ–"></a>å‡½æ•°çš„æŸ¯é‡ŒåŒ–</h1><h2 id="ä¸€ã€æ¦‚å¿µ"><a href="#ä¸€ã€æ¦‚å¿µ" class="headerlink" title="ä¸€ã€æ¦‚å¿µ"></a>ä¸€ã€æ¦‚å¿µ</h2><p>æ¥å—å¤šä¸ªå‚æ•°çš„å‡½æ•°è½¬æ¢æˆæ¥å—å•ä¸€å‚æ•°çš„å‡½æ•°çš„æ“ä½œã€‚é€šä¿—ç†è§£ä¸ºï¼šåªä¼ é€’ç»™å‡½æ•°çš„ä¸€éƒ¨åˆ†å‚æ•°æ¥è°ƒç”¨å®ƒï¼Œè®©å®ƒè¿”å›ä¸€ä¸ªæ–°å‡½æ•°å»å¤„ç†å‰©ä¸‹çš„å‚æ•°ã€‚</p><blockquote><p>æµ‹è¯•å¯ç”¨quokka.jsï¼ˆå…è´¹ç‰ˆå³å¯ï¼‰  vscodeçš„æ’ä»¶</p></blockquote><h2 id="äºŒã€å‚æ•°å®šé•¿æŸ¯é‡ŒåŒ–"><a href="#äºŒã€å‚æ•°å®šé•¿æŸ¯é‡ŒåŒ–" class="headerlink" title="äºŒã€å‚æ•°å®šé•¿æŸ¯é‡ŒåŒ–"></a>äºŒã€å‚æ•°å®šé•¿æŸ¯é‡ŒåŒ–</h2><h3 id="2-1-ä¾‹ä¸€"><a href="#2-1-ä¾‹ä¸€" class="headerlink" title="2.1 ä¾‹ä¸€"></a>2.1 ä¾‹ä¸€</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> add = <span class="function">(<span class="params">...args</span>) =&gt;</span> args.reduce(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a + b);</span><br><span class="line"></span><br><span class="line">add(<span class="number">1</span>, <span class="number">2</span>) <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sum = currying(add);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> addCurryOne = sum(<span class="number">1</span>);</span><br><span class="line">addCurryOne(<span class="number">2</span>) <span class="comment">// 3</span></span><br><span class="line">addCurryOne(<span class="number">3</span>) <span class="comment">// 4</span></span><br></pre></td></tr></table></figure><p>ç”¨é—­åŒ…æŠŠä¼ å…¥å‚æ•°ä¿å­˜èµ·æ¥ï¼Œå½“ä¼ å…¥å‚æ•°çš„æ•°é‡è¶³å¤Ÿæ‰§è¡Œå‡½æ•°æ—¶ï¼Œå°±å¼€å§‹æ‰§è¡Œå‡½æ•°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">currying</span>(<span class="params">func</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> args = [];</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">result</span>(<span class="params">...rest</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (rest.length === <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> func(...args);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          args.push(...rest);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gi35mxxb8cj30eo0ga0tz.jpg" alt="image-20200825165013800"></p><h3 id="2-2-ä¾‹äºŒ"><a href="#2-2-ä¾‹äºŒ" class="headerlink" title="2.2 ä¾‹äºŒ"></a>2.2 ä¾‹äºŒ</h3><p>æŸ¯é‡ŒåŒ–æ˜¯åœ¨ä¸€ä¸ªå‡½æ•°çš„åŸºç¡€ä¸Šå˜æ¢ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„é¢„è®¾äº†å‚æ•°çš„å‡½æ•°ã€‚æœ€ååœ¨è°ƒç”¨æ–°å‡½æ•°æ—¶å€™ï¼Œå®é™…ä¸Šè¿˜æ˜¯ä¼šè°ƒç”¨æŸ¯é‡ŒåŒ–å‰çš„åŸå‡½æ•°ã€‚</p><p>è€Œä¸”æŸ¯é‡ŒåŒ–å¾—åˆ°çš„æ–°å‡½æ•°å¯ä»¥ç»§ç»­è¢«æŸ¯é‡ŒåŒ–ï¼Œæœ‰ç‚¹é€’å½’çš„æ„Ÿè§‰ï¼Œä¸å¯¹ä¸æ˜¯é€’å½’ï¼Œæœ‰ç‚¹å¥—å¨ƒçš„æ„Ÿè§‰</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gi49mnwbg6j30tk0fp42s.jpg" alt="image-20200826155358746"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">adds</span>(<span class="params">a, b, c</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b + c</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">currying</span>(<span class="params">fn, length</span>) </span>&#123;</span><br><span class="line">    length = length || fn.length; <span class="comment">// ç¬¬ä¸€æ¬¡è°ƒç”¨è·å–å‡½æ•° fn å‚æ•°çš„é•¿åº¦ï¼Œåç»­è°ƒç”¨è·å– fn å‰©ä½™å‚æ•°çš„é•¿åº¦</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">arguments</span> <span class="comment">//å°†ç±»æ•°ç»„å¯¹è±¡è½¬æ¢æˆæ•°ç»„</span></span><br><span class="line">        <span class="keyword">var</span> args = [].slice.call(<span class="built_in">arguments</span>) <span class="comment">// curryingè¿”å›å‡½æ•°æ¥å—çš„å‚æ•°</span></span><br><span class="line">        fn</span><br><span class="line">        args</span><br><span class="line">        <span class="built_in">console</span>.log(args.length)</span><br><span class="line">        length</span><br><span class="line">        <span class="keyword">if</span> (args.length &lt; length) &#123; <span class="comment">// åˆ¤æ–­å‚æ•°çš„é•¿åº¦æ˜¯å¦å°äº fn å‰©ä½™å‚æ•°éœ€è¦æ¥æ”¶çš„é•¿åº¦</span></span><br><span class="line">            <span class="keyword">return</span> currying(fn.bind(<span class="keyword">this</span>, ...args), length - args.length) <span class="comment">// é€’å½’ currying å‡½æ•°ï¼Œæ–°çš„ fn ä¸º bind è¿”å›çš„æ–°å‡½æ•°ï¼ˆbind ç»‘å®šäº† ...args å‚æ•°ï¼Œæœªæ‰§è¡Œï¼‰ï¼Œæ–°çš„ length ä¸º fn å‰©ä½™å‚æ•°çš„é•¿åº¦</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(fn)</span><br><span class="line">            <span class="built_in">console</span>.log(...args)</span><br><span class="line">            <span class="keyword">return</span> fn.call(<span class="keyword">this</span>, ...args) <span class="comment">// æ‰§è¡Œ fn å‡½æ•°ï¼Œä¼ å…¥æ–°å‡½æ•°çš„å‚æ•°</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> addCurry = currying(adds);</span><br><span class="line"><span class="built_in">console</span>.log(addCurry(<span class="number">2</span>)(<span class="number">3</span>)(<span class="number">4</span>)) <span class="comment">// 9</span></span><br><span class="line"><span class="comment">// console.log(addCurry(2, 3)(4))  // 9</span></span><br><span class="line"><span class="comment">// console.log(addCurry(2, 3, 4))  // 9</span></span><br><span class="line"><span class="comment">// addCurry(2)(3, 4) // 9</span></span><br></pre></td></tr></table></figure><p>å®ç°åŸç†éƒ½æ˜¯ã€Œç”¨é—­åŒ…æŠŠä¼ å…¥å‚æ•°ä¿å­˜èµ·æ¥ï¼Œå½“ä¼ å…¥å‚æ•°çš„æ•°é‡è¶³å¤Ÿæ‰§è¡Œå‡½æ•°æ—¶ï¼Œå°±å¼€å§‹æ‰§è¡Œå‡½æ•°ã€</p><h2 id="ä¸‰ã€å®é™…ä½¿ç”¨"><a href="#ä¸‰ã€å®é™…ä½¿ç”¨" class="headerlink" title="ä¸‰ã€å®é™…ä½¿ç”¨"></a>ä¸‰ã€å®é™…ä½¿ç”¨</h2><h3 id="1-bind"><a href="#1-bind" class="headerlink" title="1.bind"></a>1.bind</h3><p>MDNçš„è§£é‡Š</p><blockquote><p><code>Function.prototype.bind()</code>æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œåœ¨<code>bind()</code>è¢«è°ƒç”¨æ—¶ï¼Œè¿™ä¸ªæ–°å‡½æ•°çš„<code>this</code>è¢«æŒ‡å®šä¸º<code>bind</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œå…¶ä½™å‚æ•°ä¼šè¢«æŒ‡å®šä¸ºæ–°å‡½æ•°çš„å‚æ•°ï¼Œä¾›è°ƒç”¨æ—¶ä½¿ç”¨</p></blockquote><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gi5i8qlgwqj30eg0eltb4.jpg" alt="image-20200827173736428"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“!"></a>æ€»ç»“!</h2><p>æŸ¯é‡ŒåŒ–å±äºå‡½æ•°å¼ç¼–ç¨‹æ€æƒ³ã€‚æŸ¯é‡ŒåŒ–æ—¶åªæ˜¯è¿”å›ä¸€ä¸ªé¢„ç½®å‚æ•°çš„æ–°å‡½æ•°ï¼Œæ²¡æœ‰ç«‹åˆ»æ‰§è¡Œï¼Œå®é™…ä¸Šåœ¨æ»¡è¶³æ¡ä»¶åæ‰ä¼šæ‰§è¡Œã€‚ä¸æ±¡æŸ“åŸå‡½æ•°ã€‚</p>]]></content>
    
    <summary type="html">
    
      æ¥å—å¤šä¸ªå‚æ•°çš„å‡½æ•°è½¬æ¢æˆæ¥å—å•ä¸€å‚æ•°çš„å‡½æ•°çš„æ“ä½œã€‚é€šä¿—ç†è§£ä¸ºï¼šåªä¼ é€’ç»™å‡½æ•°çš„ä¸€éƒ¨åˆ†å‚æ•°æ¥è°ƒç”¨å®ƒï¼Œè®©å®ƒè¿”å›ä¸€ä¸ªæ–°å‡½æ•°å»å¤„ç†å‰©ä¸‹çš„å‚æ•°ã€‚
    
    </summary>
    
      <category term="é»˜è®¤åˆ†ç±»" scheme="https://kitions.github.io/categories/%E9%BB%98%E8%AE%A4%E5%88%86%E7%B1%BB/"/>
    
    
      <category term="javascript" scheme="https://kitions.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>æµè§ˆå™¨äº‹ä»¶å…¨å±</title>
    <link href="https://kitions.github.io/2020/07/31/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BA%8B%E4%BB%B6%E5%85%A8%E5%B1%8F/"/>
    <id>https://kitions.github.io/2020/07/31/æµè§ˆå™¨äº‹ä»¶å…¨å±/</id>
    <published>2020-07-31T03:55:08.000Z</published>
    <updated>2020-07-31T03:55:54.231Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æµè§ˆå™¨äº‹ä»¶å…¨å±"><a href="#æµè§ˆå™¨äº‹ä»¶å…¨å±" class="headerlink" title="æµè§ˆå™¨äº‹ä»¶å…¨å±"></a>æµè§ˆå™¨äº‹ä»¶å…¨å±</h1><h2 id="äº‹ä»¶"><a href="#äº‹ä»¶" class="headerlink" title="äº‹ä»¶"></a>äº‹ä»¶</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…¨å±</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> fullScreen = <span class="function">(<span class="params">element: any</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> requestMethod = element.requestFullScreen || element.webkitRequestFullScreen || element.mozRequestFullScreen || element.msRequestFullScreen || element.msRequestFullscreen || element.requestFullscreen;</span><br><span class="line">    <span class="keyword">if</span> (requestMethod) &#123;</span><br><span class="line">        requestMethod.call(element);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> (<span class="built_in">window</span> <span class="keyword">as</span> any).ActiveXObject != <span class="string">"undefined"</span>) &#123;</span><br><span class="line">        <span class="comment">//for IEï¼Œè¿™é‡Œå…¶å®å°±æ˜¯æ¨¡æ‹Ÿäº†æŒ‰ä¸‹é”®ç›˜çš„F11ï¼Œä½¿æµè§ˆå™¨å…¨å±</span></span><br><span class="line">        <span class="keyword">var</span> wscript = <span class="keyword">new</span> ActiveXObject(<span class="string">"WScript.Shell"</span>);</span><br><span class="line">        <span class="keyword">if</span> (wscript != <span class="literal">null</span>) &#123;</span><br><span class="line">            wscript.SendKeys(<span class="string">"&#123;F11&#125;"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é€€å‡ºå…¨å±</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> exitFullScreen = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> el: any = <span class="built_in">document</span>;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­å„ç§æµè§ˆå™¨ï¼Œæ‰¾åˆ°æ­£ç¡®çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">var</span> exitMethod = el.exitFullscreen || <span class="comment">//W3C</span></span><br><span class="line">        el.mozCancelFullScreen || <span class="comment">//FireFox</span></span><br><span class="line">        el.webkitExitFullscreen || <span class="comment">//Chromeç­‰</span></span><br><span class="line">        el.webkitExitFullscreen; <span class="comment">//IE11</span></span><br><span class="line">    <span class="keyword">if</span> (exitMethod) &#123;</span><br><span class="line">        exitMethod.call(<span class="built_in">document</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> (<span class="built_in">window</span> <span class="keyword">as</span> any).ActiveXObject !== <span class="string">"undefined"</span>) &#123; <span class="comment">//for Internet Explorer</span></span><br><span class="line">        <span class="keyword">var</span> wscript = <span class="keyword">new</span> ActiveXObject(<span class="string">"WScript.Shell"</span>);</span><br><span class="line">        <span class="keyword">if</span> (wscript !== <span class="literal">null</span>) &#123;</span><br><span class="line">            wscript.SendKeys(<span class="string">"&#123;F11&#125;"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç›‘å¬äº‹ä»¶"><a href="#ç›‘å¬äº‹ä»¶" class="headerlink" title="ç›‘å¬äº‹ä»¶"></a>ç›‘å¬äº‹ä»¶</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fullChage = <span class="function">(<span class="params">e: any</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> el: any = <span class="built_in">document</span></span><br><span class="line">        <span class="comment">// if isFullScreen</span></span><br><span class="line">        <span class="keyword">if</span> (el.isFullScreen || el.mozFullScreen || el.webkitIsFullScreen) &#123;</span><br><span class="line">            <span class="comment">// do someting</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"å…¨å±å¤±è´¥"</span>, error)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">"fullscreenchange"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    fullChage(e)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">"mozfullscreenchange"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    fullChage(e)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">"webkitfullscreenchange"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    fullChage(e)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">"msfullscreenchange"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    fullChage(e)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      æµè§ˆå™¨çš„å…¨å±ï¼Œé€€å‡ºå…¨å±ï¼Œç›‘å¬å…¨å±
    
    </summary>
    
      <category term="é»˜è®¤åˆ†ç±»" scheme="https://kitions.github.io/categories/%E9%BB%98%E8%AE%A4%E5%88%86%E7%B1%BB/"/>
    
    
      <category term="å…¨å±" scheme="https://kitions.github.io/tags/%E5%85%A8%E5%B1%8F/"/>
    
  </entry>
  
  <entry>
    <title>styled-componentsæµ…å…¥æµ…å‡º</title>
    <link href="https://kitions.github.io/2020/07/25/styled-components/"/>
    <id>https://kitions.github.io/2020/07/25/styled-components/</id>
    <published>2020-07-25T10:45:22.000Z</published>
    <updated>2020-07-31T03:58:33.672Z</updated>
    
    <content type="html"><![CDATA[<h1 id="styled-components"><a href="#styled-components" class="headerlink" title="styled-components"></a>styled-components</h1><p>styled-componentsä»¥ç»„ä»¶çš„å½¢å¼æ¥å£°æ˜æ ·å¼ï¼Œè®©æ ·å¼ä¹Ÿæˆä¸ºç»„ä»¶ï¼Œä»è€Œåˆ†ç¦»é€»è¾‘ç»„ä»¶ä¸å±•ç¤ºç»„ä»¶ã€‚</p><h2 id="éƒ¨åˆ†å®è·µ"><a href="#éƒ¨åˆ†å®è·µ" class="headerlink" title="éƒ¨åˆ†å®è·µ"></a>éƒ¨åˆ†å®è·µ</h2><h3 id="1-å¼•å…¥å…¨éƒ¨æ ·å¼"><a href="#1-å¼•å…¥å…¨éƒ¨æ ·å¼" class="headerlink" title="1.  å¼•å…¥å…¨éƒ¨æ ·å¼"></a>1.  å¼•å…¥å…¨éƒ¨æ ·å¼</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createGlobalStyle&#125; <span class="keyword">from</span> <span class="string">'styled-components'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Global = createGlobalStyle<span class="string">`</span></span><br><span class="line"><span class="string">  body&#123;</span></span><br><span class="line"><span class="string">    background-color:red!important;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"> h1, h2, h3 &#123;</span></span><br><span class="line"><span class="string">    font-family: '<span class="subst">$&#123;props =&gt; props.theme.fontFamily.common&#125;</span>';</span></span><br><span class="line"><span class="string">    font-weight: normal;</span></span><br><span class="line"><span class="string">    font-style: normal;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line">&lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">  &lt;Global&gt;<span class="xml"><span class="tag">&lt;/<span class="name">Global</span>&gt;</span></span></span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-input-attr"><a href="#2-input-attr" class="headerlink" title="2.  input attr"></a>2.  input attr</h3><p>ä¸ºStyled-Componentæ·»åŠ é»˜è®¤å±æ€§å’Œé»˜è®¤æ ·å¼å€¼</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Input = styled.input.attrs(<span class="function"><span class="params">props</span> =&gt;</span> (&#123;</span><br><span class="line">  <span class="comment">// we can define static props</span></span><br><span class="line">  type: <span class="string">"password"</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// or we can define dynamic ones</span></span><br><span class="line">  size: props.size || <span class="string">"1em"</span>,</span><br><span class="line">&#125;))<span class="string">`</span></span><br><span class="line"><span class="string">  color: red;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line">render(</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;Input /&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure><h3 id="3-ä¸»é¢˜"><a href="#3-ä¸»é¢˜" class="headerlink" title="3. ä¸»é¢˜"></a>3. ä¸»é¢˜</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> theme = &#123;</span><br><span class="line">fontSizes: &#123;</span><br><span class="line">sm: <span class="string">'10px'</span>,</span><br><span class="line">md: <span class="string">'15px'</span>,</span><br><span class="line">lg: <span class="string">'25px'</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> BodyTexts = styled.p<span class="string">`</span></span><br><span class="line"><span class="string">font-size: <span class="subst">$&#123;props =&gt; props.theme.fontSizes.sm&#125;</span></span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line">render(</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;ThemeProvider theme=&#123;theme&#125;&gt;</span><br><span class="line">      &lt;BodyTexts&gt;Themed&lt;<span class="regexp">/BodyTexts&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>ThemeProvider&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure><h3 id="4-ç»§æ‰¿"><a href="#4-ç»§æ‰¿" class="headerlink" title="4. ç»§æ‰¿"></a>4. ç»§æ‰¿</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> StyledCompoent2 = styled(StyledCompoent1)<span class="string">`</span></span><br><span class="line"><span class="string">    background:xxx</span></span><br><span class="line"><span class="string">    ...</span></span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure><p>StyledComponent2å…¶å®æ˜¯ä¸€ä¸ªå…¨æ–°çš„class</p><p>å¦‚æœæˆ‘ä»¬æƒ³è¦åšåˆ°<strong>çœŸæ­£çš„ç»§æ‰¿</strong>ï¼Œéœ€è¦ä½¿ç”¨style-componentsæä¾›çš„<code>extend</code>æ–¹æ³•ï¼Œå®ƒæ˜¯StyleComponentä¸‹çš„ä¸€ä¸ªå±æ€§æ–¹æ³•ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> StyledCompoent2 = StyledCompoent1.extend<span class="string">`</span></span><br><span class="line"><span class="string">    background:xxx</span></span><br><span class="line"><span class="string">    ...</span></span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure><h3 id="5-withComponent"><a href="#5-withComponent" class="headerlink" title="5. withComponent"></a>5. withComponent</h3><p>åˆ›å»ºæ–°StyledComponentçš„æ–¹æ³•ï¼Œè¯¥æ–°StyledComponentä¼šåº”ç”¨ä¸åŒçš„æ ‡ç­¾æˆ–ç»„ä»¶ï¼Œä½†æ‰€è°ƒç”¨çš„è§„åˆ™ç›¸åŒã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Component = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">  color: red;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line">render(</span><br><span class="line">  &lt;Component</span><br><span class="line">    <span class="keyword">as</span>=<span class="string">"button"</span></span><br><span class="line">    onClick=&#123;() =&gt; alert(<span class="string">'It works!'</span>)&#125;</span><br><span class="line">  &gt;</span><br><span class="line">    Hello World!</span><br><span class="line">  &lt;<span class="regexp">/Component&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure><h3 id="6-Refs"><a href="#6-Refs" class="headerlink" title="6. Refs"></a>6. Refs</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Input = styled.input<span class="string">`</span></span><br><span class="line"><span class="string">  padding: 0.5em;</span></span><br><span class="line"><span class="string">  margin: 0.5em;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Form</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.inputRef = React.createRef();</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Input</span><br><span class="line">        ref=&#123;<span class="keyword">this</span>.inputRef&#125;</span><br><span class="line">        placeholder=<span class="string">"Hover to focus!"</span></span><br><span class="line">        onMouseEnter=&#123;() =&gt; &#123;</span><br><span class="line">          <span class="keyword">this</span>.inputRef.current.focus()</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">render(</span><br><span class="line">  &lt;Form /&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="7-è·å–Theme"><a href="#7-è·å–Theme" class="headerlink" title="7. è·å–Theme"></a>7. è·å–Theme</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; withTheme &#125; <span class="keyword">from</span> <span class="string">'styled-components'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Current theme: '</span>, <span class="keyword">this</span>.props.theme);</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> withTheme(MyComponent)</span><br></pre></td></tr></table></figure><h2 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a>æ’ä»¶</h2><h3 id="Stylelint"><a href="#Stylelint" class="headerlink" title="Stylelint"></a>Stylelint</h3> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(npm install --save-dev \</span><br><span class="line">  stylelint \</span><br><span class="line">  stylelint-processor-styled-components \</span><br><span class="line">  stylelint-config-styled-components \</span><br><span class="line">  stylelint-config-recommended)</span><br></pre></td></tr></table></figure><h3 id="Styled-Theming"><a href="#Styled-Theming" class="headerlink" title="Styled Theming"></a><a href="https://styled-components.com/docs/tooling#styled-theming" target="_blank" rel="noopener">Styled Theming</a></h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> styled, &#123; ThemeProvider &#125; <span class="keyword">from</span> <span class="string">'styled-components'</span></span><br><span class="line"><span class="keyword">import</span> theme <span class="keyword">from</span> <span class="string">'styled-theming'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> boxBackgroundColor = theme(<span class="string">'mode'</span>, &#123;</span><br><span class="line">  light: <span class="string">'#fff'</span>,</span><br><span class="line">  dark: <span class="string">'#000'</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Box = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">  background-color: <span class="subst">$&#123;boxBackgroundColor&#125;</span>;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;ThemeProvider theme=&#123;&#123; <span class="attr">mode</span>: <span class="string">'light'</span> &#125;&#125;&gt;</span><br><span class="line">      &lt;Box&gt;Hello World&lt;<span class="regexp">/Box&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>ThemeProvider&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="vscode-styled-components"><a href="#vscode-styled-components" class="headerlink" title="vscode-styled-components"></a><strong>vscode-styled-components</strong></h3><h3 id="typescript-plugin-styled-components"><a href="#typescript-plugin-styled-components" class="headerlink" title="typescript-plugin-styled-components"></a><a href="https://github.com/Igorbek/typescript-plugin-styled-components" target="_blank" rel="noopener">typescript-plugin-styled-components</a></h3><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><h3 id="ä¼˜ç‚¹ï¼š"><a href="#ä¼˜ç‚¹ï¼š" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h3><ol><li>æ´»è·ƒçš„<a href="https://github.com/styled-components/styled-components/graphs/contributors" target="_blank" rel="noopener">ç¤¾åŒº</a>ã€‚</li><li><strong>CSSçš„æ¨¡æ¿æ–‡å­—è¯­æ³•</strong>ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœæ‚¨å¯ä»¥ç¼–å†™æ™®é€šçš„CSSï¼Œå°±å¯ä»¥ä¸ºç»„ä»¶è®¾ç½®æ ·å¼ï¼Œè€Œä¸å¿…å­¦ä¹ æ–°çš„è¯­æ³•ã€‚</li><li>Sassæ”¯æŒã€‚</li><li>è‡ªåŠ¨æä¾›å‰ç¼€</li><li>ç»„ä»¶æ›´åŠ ç‹¬ç«‹æ¸…æ™°ï¼Œè¯­ä¹‰åŒ–æ›´æ¸…æ™°ï¼Œç»´æŠ¤ç®€å•ï¼Œç¬¬äºŒä¸ªäººæ¥æ‰‹å¾ˆå¿«ï¼Œä¹Ÿä¸ç”¨é¡¾å¿Œä¹‹å‰çš„æ ·å¼å†²çªã€‚</li><li>å‡è½»äº†å¤§å®¶ç±»åå‘½åçš„è´Ÿæ‹…ã€‚</li><li>å¯å®ç°ä»…åŠ è½½æ‰€éœ€çš„æœ€å°‘ä»£ç ã€‚</li><li>å…¼å®¹æ€§è‰¯å¥½ v4.xï¼ˆReact v16.3 +ï¼šIE11ï¼ŒIE 9+ï¼ˆå¸¦æœ‰Map + Set polyfillsï¼‰</li></ol><h3 id="ç¼ºç‚¹ï¼š"><a href="#ç¼ºç‚¹ï¼š" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h3><ol><li>ä½¿ç”¨<strong>vscode-styled-components</strong> æœ‰æç¤ºï¼Œä½†æç¤ºé€Ÿåº¦è¾ƒæ…¢ï¼Œæ²¡æœ‰scssã€cssæç¤ºå‹å¥½ï¼Œæ¯”å¦‚margin-leftï¼Œæˆ‘åœ¨scssä¸­åªéœ€è¦mlå›è½¦å°±è¡Œäº†ï¼Œåœ¨styled-componentsç»„ä»¶ä¸­å°±è¿˜æ˜¯å¾—æ‰“å…¨ã€‚</li><li>äº§å“æ”¹æ ·å¼ï¼Œæƒ³è¦ä»HTMLä¸­å®šä½ç¡®åˆ‡çš„çŸ¥é“ä»£ç ä¸­æŸä¸ª class åœ¨å“ªå„¿ç”¨åˆ°å¾ˆéš¾</li></ol><h3 id="so"><a href="#so" class="headerlink" title="so:"></a>so:</h3><p>ä¼˜ç‚¹&gt;ç¼ºç‚¹ï¼Œgo on ç”¨èµ·æ¥å§ï¼</p>]]></content>
    
    <summary type="html">
    
      styled-componentsä»¥ç»„ä»¶çš„å½¢å¼æ¥å£°æ˜æ ·å¼ï¼Œè®©æ ·å¼ä¹Ÿæˆä¸ºç»„ä»¶ï¼Œä»è€Œåˆ†ç¦»é€»è¾‘ç»„ä»¶ä¸å±•ç¤ºç»„ä»¶ã€‚
    
    </summary>
    
      <category term="é»˜è®¤åˆ†ç±»" scheme="https://kitions.github.io/categories/%E9%BB%98%E8%AE%A4%E5%88%86%E7%B1%BB/"/>
    
    
      <category term="styled-components" scheme="https://kitions.github.io/tags/styled-components/"/>
    
  </entry>
  
  <entry>
    <title>React + antd-table è¡¨æ ¼æ‹–æ‹½</title>
    <link href="https://kitions.github.io/2020/07/22/React%20+%20antd-table%20%E8%A1%A8%E6%A0%BC%E6%8B%96%E6%8B%BDclass%E7%B1%BB%E5%86%99%E6%B3%95/"/>
    <id>https://kitions.github.io/2020/07/22/React + antd-table è¡¨æ ¼æ‹–æ‹½classç±»å†™æ³•/</id>
    <published>2020-07-22T10:52:24.000Z</published>
    <updated>2020-07-23T01:35:48.732Z</updated>
    
    <content type="html"><![CDATA[<h1 id="React-antd-table-è¡¨æ ¼æ‹–æ‹½classç±»å†™æ³•-Immutability-Helpersä»‹ç»"><a href="#React-antd-table-è¡¨æ ¼æ‹–æ‹½classç±»å†™æ³•-Immutability-Helpersä»‹ç»" class="headerlink" title="React + antd-table è¡¨æ ¼æ‹–æ‹½classç±»å†™æ³•(Immutability Helpersä»‹ç»)"></a>React + antd-table è¡¨æ ¼æ‹–æ‹½classç±»å†™æ³•(Immutability Helpersä»‹ç»)</h1><h2 id="ç¬¬ä¸€ç§æ–¹æ¡ˆï¼šreact-dnt"><a href="#ç¬¬ä¸€ç§æ–¹æ¡ˆï¼šreact-dnt" class="headerlink" title="ç¬¬ä¸€ç§æ–¹æ¡ˆï¼šreact-dnt"></a>ç¬¬ä¸€ç§æ–¹æ¡ˆï¼šreact-dnt</h2><h3 id="ä¸»ç»„ä»¶"><a href="#ä¸»ç»„ä»¶" class="headerlink" title="ä¸»ç»„ä»¶"></a>ä¸»ç»„ä»¶</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; DndProvider &#125; <span class="keyword">from</span> <span class="string">'react-dnd'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; HTML5Backend &#125; <span class="keyword">from</span> <span class="string">'react-dnd-html5-backend'</span>;</span><br><span class="line"><span class="keyword">import</span> update <span class="keyword">from</span> <span class="string">'immutability-helper'</span>;</span><br><span class="line"></span><br><span class="line">moveRow = <span class="function">(<span class="params">dragIndex: number, hoverIndex: number</span>) =&gt;</span> &#123;</span><br><span class="line">   <span class="keyword">const</span> &#123; dataSource &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">   <span class="keyword">const</span> dragRow = dataSource[dragIndex];</span><br><span class="line">   <span class="keyword">this</span>.setState(</span><br><span class="line">     <span class="comment">// ä¸‹é¢æœ‰å¯¹è¿™ä¸ªå‡½æ•°çš„è¯´æ˜</span></span><br><span class="line">     update(<span class="keyword">this</span>.state, &#123;</span><br><span class="line">       dataSource: &#123;</span><br><span class="line">         $splice: [[dragIndex, <span class="number">1</span>], [hoverIndex, <span class="number">0</span>, dragRow]],</span><br><span class="line">       &#125;,</span><br><span class="line">     &#125;), () =&gt; &#123;</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.dataSource)</span><br><span class="line">     &#125;</span><br><span class="line">   );</span><br><span class="line"> &#125;;</span><br><span class="line"></span><br><span class="line">public render() &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; dataSource &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">  &lt;DndProvider backend=&#123;HTML5Backend&#125;&gt;</span><br><span class="line">    &lt;Table</span><br><span class="line">      columns=&#123;<span class="keyword">this</span>.renderColumns()&#125;</span><br><span class="line">      dataSource=&#123;dataSource&#125;</span><br><span class="line">      rowKey=<span class="string">"index"</span></span><br><span class="line">      bordered=&#123;<span class="literal">false</span>&#125;</span><br><span class="line">      pagination=&#123;<span class="literal">false</span>&#125;</span><br><span class="line">      locale=&#123;&#123; <span class="attr">emptyText</span>: <span class="string">"æš‚æœªé€‰æ‹©"</span> &#125;&#125;</span><br><span class="line">      components=&#123;&#123;</span><br><span class="line">        body: &#123;</span><br><span class="line">          row: DragableBodyRow,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      onRow=&#123;(record, index) =&gt; (&#123;</span><br><span class="line">        index,</span><br><span class="line">        moveRow: <span class="keyword">this</span>.moveRow,</span><br><span class="line">      &#125;)&#125;</span><br><span class="line"></span><br><span class="line">      /&gt;</span><br><span class="line">  &lt;<span class="regexp">/DndProvider&gt;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="ç»„ä»¶"><a href="#ç»„ä»¶" class="headerlink" title="ç»„ä»¶"></a>ç»„ä»¶</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; DragSource, DropTarget &#125; <span class="keyword">from</span> <span class="string">'react-dnd'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> dragingIndex = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BodyRow</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span>&lt;<span class="title">any</span>&gt; </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; isOver, connectDragSource, connectDropTarget, moveRow, ...restProps &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">        <span class="keyword">const</span> style = &#123; ...restProps.style, <span class="attr">cursor</span>: <span class="string">'move'</span> &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> className = restProps.className;</span><br><span class="line">        <span class="keyword">if</span> (isOver) &#123;</span><br><span class="line">            <span class="keyword">if</span> (restProps.index &gt; dragingIndex) &#123;</span><br><span class="line">                className += <span class="string">' drop-over-downward'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (restProps.index &lt; dragingIndex) &#123;</span><br><span class="line">                className += <span class="string">' drop-over-upward'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> connectDragSource(</span><br><span class="line">            connectDropTarget(<span class="xml"><span class="tag">&lt;<span class="name">tr</span> &#123;<span class="attr">...restProps</span>&#125; <span class="attr">className</span>=<span class="string">&#123;className&#125;</span> <span class="attr">style</span>=<span class="string">&#123;style&#125;</span> /&gt;</span>),</span></span><br><span class="line"><span class="xml">        );</span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">const rowSource = &#123;</span></span><br><span class="line"><span class="xml">    beginDrag(props: any) &#123;</span></span><br><span class="line"><span class="xml">        dragingIndex = props.index;</span></span><br><span class="line"><span class="xml">        return &#123;</span></span><br><span class="line"><span class="xml">            index: props.index,</span></span><br><span class="line"><span class="xml">        &#125;;</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"><span class="xml">&#125;;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">const rowTarget = &#123;</span></span><br><span class="line"><span class="xml">    drop(props: any, monitor: any) &#123;</span></span><br><span class="line"><span class="xml">        const dragIndex = monitor.getItem().index;</span></span><br><span class="line"><span class="xml">        const hoverIndex = props.index;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">        // Don't replace items with themselves</span></span><br><span class="line"><span class="xml">        if (dragIndex === hoverIndex) &#123;</span></span><br><span class="line"><span class="xml">            return;</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">        // Time to actually perform the action</span></span><br><span class="line"><span class="xml">        props.moveRow(dragIndex, hoverIndex);</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">        // Note: we're mutating the monitor item here!</span></span><br><span class="line"><span class="xml">        // Generally it's better to avoid mutations,</span></span><br><span class="line"><span class="xml">        // but it's good here for the sake of performance</span></span><br><span class="line"><span class="xml">        // to avoid expensive index searches.</span></span><br><span class="line"><span class="xml">        monitor.getItem().index = hoverIndex;</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"><span class="xml">&#125;;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">export const DragableBodyRow = DropTarget('row', rowTarget, (connect, monitor) =&gt; (&#123;</span></span><br><span class="line"><span class="xml">    connectDropTarget: connect.dropTarget(),</span></span><br><span class="line"><span class="xml">    isOver: monitor.isOver(),</span></span><br><span class="line"><span class="xml">&#125;))(</span></span><br><span class="line"><span class="xml">    DragSource('row', rowSource, connect =&gt; (&#123;</span></span><br><span class="line"><span class="xml">        connectDragSource: connect.dragSource(),</span></span><br><span class="line"><span class="xml">    &#125;))(BodyRow),</span></span><br><span class="line"><span class="xml">);</span></span><br></pre></td></tr></table></figure><h3 id="css"><a href="#css" class="headerlink" title="css"></a>css</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">:global &#123;</span><br><span class="line">    .drop-over-downward td &#123;</span><br><span class="line">        border-bottom: <span class="number">2px</span> dashed <span class="number">#1890ff</span><span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.drop-over-upward</span> <span class="selector-tag">td</span> &#123;</span><br><span class="line">        <span class="attribute">border-top</span>: <span class="number">2px</span> dashed <span class="number">#1890ff</span><span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¬¬äºŒç§æ–¹æ¡ˆï¼šreact-sortable-hoc"><a href="#ç¬¬äºŒç§æ–¹æ¡ˆï¼šreact-sortable-hoc" class="headerlink" title="ç¬¬äºŒç§æ–¹æ¡ˆï¼šreact-sortable-hoc"></a>ç¬¬äºŒç§æ–¹æ¡ˆï¼šreact-sortable-hoc</h2><p>æœªåšç»„ä»¶æŠ½ç¦»ï¼Œå‡‘åˆçœ‹</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; arrayMove, SortableContainer, SortableElement, SortableHandle &#125; <span class="keyword">from</span> <span class="string">'react-sortable-hoc'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> SortableItem = SortableElement(<span class="function">(<span class="params">props: any</span>) =&gt;</span></span><br><span class="line">    &lt;tr &#123;...props&#125; /&gt;</span><br><span class="line">);</span><br><span class="line"><span class="keyword">const</span> SortableContainers = SortableContainer(<span class="function">(<span class="params">props: any</span>) =&gt;</span></span><br><span class="line">    &lt;tbody &#123;...props&#125; /&gt;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> DragHandle = SortableHandle(<span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">    &lt;span className=<span class="string">"sortIcon"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">));</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AAA</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span>&lt;<span class="title">Props</span>, <span class="title">State</span>&gt; </span>&#123;</span><br><span class="line">  onSortEnd = <span class="function">(<span class="params">params: any</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> &#123; oldIndex, newIndex &#125; = params;</span><br><span class="line">          <span class="keyword">const</span> &#123; dataSource &#125; = <span class="keyword">this</span>.state;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (oldIndex !== newIndex) &#123;</span><br><span class="line">              <span class="keyword">const</span> newData = arrayMove(<span class="function">(<span class="params">[] <span class="keyword">as</span> ISettleItemUse[]</span>).<span class="params">concat</span>(<span class="params">dataSource</span>), <span class="params">oldIndex</span>, <span class="params">newIndex</span>).<span class="params">filter</span>(<span class="params">(el: any</span>) =&gt;</span> !!el);</span><br><span class="line">              <span class="keyword">this</span>.setState(&#123; <span class="attr">dataSource</span>: newData &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">  DragableBodyRow = <span class="function">(<span class="params">params: any</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ...restProps &#125; = params</span><br><span class="line">    <span class="keyword">const</span> &#123; dataSource &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">const</span> index = dataSource.findIndex(<span class="function"><span class="params">x</span> =&gt;</span> x.index === restProps[<span class="string">'data-row-key'</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">SortableItem</span> <span class="attr">index</span>=<span class="string">&#123;index&#125;</span> &#123;<span class="attr">...restProps</span>&#125; /&gt;</span></span></span><br><span class="line"><span class="xml">  &#125;;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">  render()&#123;</span></span><br><span class="line"><span class="xml">      const DraggableContainer = (props: any) =&gt; (</span></span><br><span class="line"><span class="xml">              <span class="tag">&lt;&gt;</span></span></span><br><span class="line">                  &lt;SortableContainers</span><br><span class="line">                      useDragHandle</span><br><span class="line">                      helperClass="row-dragging"</span><br><span class="line">                      onSortEnd=&#123;this.onSortEnd&#125;</span><br><span class="line">                      &#123;...props&#125;</span><br><span class="line">                  /&gt;</span><br><span class="line">              &lt;/&gt;</span><br><span class="line">          );</span><br><span class="line"></span><br><span class="line">     &lt;Table</span><br><span class="line">       columns=&#123;this.renderColumns()&#125;</span><br><span class="line">       dataSource=&#123;dataSource&#125;</span><br><span class="line">       rowKey="index"</span><br><span class="line">       bordered=&#123;false&#125;</span><br><span class="line">       pagination=&#123;false&#125;</span><br><span class="line">       locale=&#123;&#123; emptyText: "æš‚æœªé€‰æ‹©" &#125;&#125;</span><br><span class="line">       components=&#123;&#123;</span><br><span class="line">          body: &#123;</span><br><span class="line">            wrapper: DraggableContainer,</span><br><span class="line">              row: this.DragableBodyRow,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;&#125;</span><br><span class="line">       /&gt;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> &lt;DragHandle /&gt;ä¸ºæ‹–åŠ¨çš„å›¾æ ‡</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">// æ‹–åŠ¨</span><br><span class="line">  <span class="selector-class">.row-dragging</span> &#123;</span><br><span class="line">      <span class="attribute">background</span>: <span class="number">#fafafa</span>;</span><br><span class="line">      <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>;</span><br><span class="line"></span><br><span class="line">      th &#123;</span><br><span class="line">          color: $color-333;</span><br><span class="line">          <span class="selector-tag">background</span>: <span class="selector-id">#E9EAEA</span> !<span class="selector-tag">important</span>;</span><br><span class="line">          <span class="selector-tag">font-size</span>: 12<span class="selector-tag">px</span>;</span><br><span class="line">          <span class="selector-tag">padding</span>: 8<span class="selector-tag">px</span> 10<span class="selector-tag">px</span> !<span class="selector-tag">important</span>;</span><br><span class="line">          <span class="selector-tag">font-weight</span>: <span class="selector-tag">normal</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="selector-tag">td</span> &#123;</span><br><span class="line">          <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">          <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">10px</span> <span class="meta">!important</span>;</span><br><span class="line">          <span class="attribute">color</span>: $color-<span class="number">333</span>;</span><br><span class="line">          <span class="attribute">visibility</span>: hidden;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="selector-class">.drag-visible</span> &#123;</span><br><span class="line">          <span class="attribute">visibility</span>: visible;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>è¯¥æ–¹æ¡ˆåœ¨ä½¿ç”¨åæœ‰ç‚¹å¡é¡¿ï¼Œæ—¶é—´æ€¥æ²¡æ‰¾åˆ° å¡é¡¿çš„åŸå› ã€‚ä½¿ç”¨äº†ç¬¬ä¸€ç§æ–¹æ¡ˆ</p><p>å¯èƒ½æ˜¯è·Ÿè¡¨æ ¼ä¸­çš„åŠ¨æ€ç¼–è¾‘çš„selectã€inputæœ‰å…³ï¼ŒsetStateå¯¼è‡´tbodyé‡æ–°æ¸²æŸ“ï¼Œé€ æˆå¡é¡¿ï¼Œselectå’Œinputä¹Ÿæœ‰è®¸å¤šè”åŠ¨ï¼Œç›®å‰çŒœæ˜¯è¿™ä¸ªåŸå› ï¼ŒåæœŸæœ‰æ—¶é—´ï¼Œæ‰¾åˆ°ä¸€ä¸‹è¿™ä¸ªåŸå› ã€‚</p><h1 id="immutability-helper"><a href="#immutability-helper" class="headerlink" title="immutability-helper"></a>immutability-helper</h1><p>yarn add immutability-helper</p><p>ä¸Šæ–‡ä¸­update $splice</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> initialArray = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * API: &#123;$splice: array of arrays&#125;</span></span><br><span class="line"><span class="comment"> * åŒæ•°ç»„çš„ splice æ–¹æ³•</span></span><br><span class="line"><span class="comment"> *      æ•°ç»„ arrays ä¸­åŒ…å«çš„æ˜¯æ‰€æœ‰éœ€è¦æ‰§è¡Œçš„æ“ä½œé›†åˆ</span></span><br><span class="line"><span class="comment"> *      å…ƒç´  array ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ ä»£è¡¨ä¸‹æ ‡ï¼Œç¬¬äºŒä¸ªå…ƒç´ ä»£è¡¨éœ€è¦åˆ é™¤çš„ä¸ªæ•°ï¼Œç¬¬ä¸‰ä¸ªå…ƒç´ ä»£è¡¨éœ€è¦æ’å…¥åˆ° initialArray ä¸­çš„çš„å…ƒç´ </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * PS:  1ã€å¯ä»¥åœ¨ arrays ä¸­æ‰§è¡Œå¤šä¸ªé›†åˆï¼›</span></span><br><span class="line"><span class="comment"> *      2ã€ä¸¤ä¸ªæ“ä½œä¸æ˜¯åŒæ—¶æ‰§è¡Œï¼Œè€Œæ˜¯æŒ‰é¡ºåºæ‰§è¡Œï¼Œåé¢çš„æ“ä½œä¼šåœ¨å‰é¢ä¸€ä¸ªæ“ä½œçš„æ‰§è¡Œç»“æœä¸Šæ‰§è¡Œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> spliceArray = update(initialArray, &#123; <span class="attr">$splice</span>: [[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="string">'f'</span>, <span class="string">'g'</span>]] &#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'spliceArrayï¼š'</span>, spliceArray);  <span class="comment">// =&gt; [ 'a', 'd', 'f', 'g', 'e' ]</span></span><br></pre></td></tr></table></figure><p>åœ¨ä¸æ›´æ”¹åŸå§‹æºçš„æƒ…å†µä¸‹æ”¹å˜æ•°æ®å‰¯æœ¬ã€‚</p><blockquote><p>Immutable data encourages pure functions (data-in, data-out) and lends itself to much simpler application development and enabling techniques from functional programming such as lazy evaluation.</p></blockquote><p>API</p><p><code>$push</code> â€”â€” æ•°ç»„;</p><p><code>$unshift</code> â€”â€” æ•°ç»„;</p><p><code>$splice</code> â€”â€” æ•°ç»„;</p><p><code>$set</code> â€”â€” æ›¿æ¢/è¦†ç›–/åˆå¹¶åŸæ•°æ®;</p><p><code>$toggle</code> â€”â€” array of strings ï¼Œtoggles a list of boolean fields from the target objectï¼›</p><p><code>$unset</code> â€”â€” remove the list of keys in array from the target object;</p><p><code>$merge</code> â€”â€” åˆå¹¶å¯¹è±¡;</p><p><code>$apply</code> â€”â€”  passes in the current value to the function and updates it with the new returned valueï¼›</p><p><code>$add</code> â€”â€” æ–°å¢;</p><p><code>$remove</code> â€”â€” åˆ é™¤ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$splice</span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">66</span>];</span><br><span class="line">  <span class="keyword">let</span> arr2 = update(arr,&#123;</span><br><span class="line">    $splice : [[<span class="number">1</span>,<span class="number">2</span>,[<span class="number">66788</span>,<span class="number">99</span>],&#123;<span class="attr">a</span>:<span class="number">123</span>,<span class="attr">b</span>:<span class="string">"fff"</span>&#125;]], <span class="comment">// or [0,1,"ä»æˆ‘å¼€å§‹æ˜¯æ’å…¥çš„å†…å®¹",88,89,90,"åé¢å¯ä»¥å¾ˆå¤šï¼Œæ˜¯æ•°ç»„ã€å¯¹è±¡ã€å­—ç¬¦ä¸²éƒ½è¡Œ"]</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="built_in">console</span>.log(arr2); </span><br><span class="line"></span><br><span class="line">  <span class="comment">//å¤æ‚ä¸€äº›çš„ç”¨æ³•ï¼š</span></span><br><span class="line">  <span class="keyword">let</span> obj=&#123;</span><br><span class="line">    name:<span class="string">"immutable"</span>,</span><br><span class="line">    list :[<span class="number">1</span>,<span class="number">2</span>,[<span class="number">90</span>,<span class="number">55</span>,<span class="number">44</span>,<span class="number">3</span>,<span class="number">22</span>,<span class="number">55</span>],<span class="number">3</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">let</span> obj2 = update(obj,&#123;</span><br><span class="line">    list:&#123;</span><br><span class="line">      [<span class="number">2</span>]:<span class="function"><span class="params">value</span>=&gt;</span>update(value,&#123;</span><br><span class="line">        $splice:[[<span class="number">0</span>,<span class="number">2</span>]]  <span class="comment">// [90,55,44,3,22,55] =&gt; [44, 3, 22, 55]</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p>å‚è€ƒ</p><p><a href="https://www.jianshu.com/p/074bbb7a36b2" target="_blank" rel="noopener">immutabilityå› Reactå®˜æ–¹å‡ºé•œä¹‹ä½¿ç”¨æ€»ç»“åˆ†äº«ï¼</a></p><p><a href="https://ant.design/components/table-cn/" target="_blank" rel="noopener">https://ant.design/components/table-cn/</a></p><p><a href="https://react-dnd.github.io/react-dnd/docs/overview" target="_blank" rel="noopener">https://react-dnd.github.io/react-dnd/docs/overview</a></p>]]></content>
    
    <summary type="html">
    
      React + antd-table è¡¨æ ¼æ‹–æ‹½classç±»å†™æ³•ï¼Œé¡ºä¾¿çœ‹åˆ°äº†Immutability Helpersï¼Œè§‰å¾—è¿˜ä¸é”™ï¼Œç®€å•çš„çœ‹äº†çœ‹
    
    </summary>
    
      <category term="é»˜è®¤åˆ†ç±»" scheme="https://kitions.github.io/categories/%E9%BB%98%E8%AE%A4%E5%88%86%E7%B1%BB/"/>
    
    
      <category term="React" scheme="https://kitions.github.io/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>setStateæ˜¯åŒæ­¥å’Œè¿˜æ˜¯å¼‚æ­¥çš„</title>
    <link href="https://kitions.github.io/2020/06/30/setState/"/>
    <id>https://kitions.github.io/2020/06/30/setState/</id>
    <published>2020-06-30T06:34:54.000Z</published>
    <updated>2021-01-07T07:20:50.139Z</updated>
    
    <content type="html"><![CDATA[<h1 id="setState"><a href="#setState" class="headerlink" title="setState"></a>setState</h1><p>setStateç«‹é©¬æ‰§è¡Œä¹‹åï¼Œæ˜¯æ— æ³•ç›´æ¥è·å–åˆ°æœ€æ–°çš„stateçš„ï¼Œéœ€è¦ç»è¿‡Reactå¯¹stateçš„æ‰€æœ‰æ”¹å˜è¿›è¡Œåˆå¹¶å¤„ç†ä¹‹åï¼Œæ‰ä¼šå»è®¡ç®—æ–°çš„è™šæ‹Ÿdomï¼Œå†æ ¹æ®æœ€æ–°çš„è™šæ‹Ÿdomå»é‡æ–°æ¸²æŸ“çœŸå®domã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">this</span>.setState(&#123; <span class="attr">count</span>: <span class="keyword">this</span>.state.count + <span class="number">1</span> &#125;);</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"console: "</span> + <span class="keyword">this</span>.state.count); <span class="comment">// 0</span></span><br><span class="line">   <span class="keyword">this</span>.setState(&#123; <span class="attr">count</span>: <span class="keyword">this</span>.state.count + <span class="number">1</span> &#125;, () =&gt; &#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">"console from callback: "</span> + <span class="keyword">this</span>.state.count); <span class="comment">// 2</span></span><br><span class="line">   &#125;);</span><br><span class="line">   <span class="keyword">this</span>.setState(<span class="function"><span class="params">prevState</span> =&gt;</span> &#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">"console from func: "</span> + prevState.count); <span class="comment">// 1</span></span><br><span class="line">     <span class="keyword">return</span> &#123;</span><br><span class="line">       count: prevState.count + <span class="number">1</span></span><br><span class="line">     &#125;;</span><br><span class="line">   &#125;, ()=&gt;&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">'last console: '</span>+ <span class="keyword">this</span>.state.count)</span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure><p>ç»“æœ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>: <span class="number">0</span> </span><br><span class="line"><span class="built_in">console</span> <span class="keyword">from</span> func: <span class="number">1</span> </span><br><span class="line"><span class="built_in">console</span> <span class="keyword">from</span> callback: <span class="number">2</span></span><br><span class="line">last <span class="built_in">console</span>: <span class="number">2</span></span><br></pre></td></tr></table></figure><p>React å…¶å®ä¼šç»´æŠ¤ç€ä¸€ä¸ª state çš„æ›´æ–°é˜Ÿåˆ—ï¼Œæ¯æ¬¡è°ƒç”¨ setState éƒ½ä¼šå…ˆæŠŠå½“å‰ä¿®æ”¹çš„ state æ¨è¿›è¿™ä¸ªé˜Ÿåˆ—ï¼Œåœ¨æœ€åï¼ŒReact ä¼šå¯¹è¿™ä¸ªé˜Ÿåˆ—è¿›è¡Œåˆå¹¶å¤„ç†ï¼Œç„¶åå»æ‰§è¡Œå›è°ƒã€‚æ ¹æ®æœ€ç»ˆçš„åˆå¹¶ç»“æœå†å»èµ°ä¸‹é¢çš„æµç¨‹ï¼ˆæ›´æ–°è™šæ‹Ÿdomï¼Œè§¦å‘æ¸²æŸ“ï¼‰ã€‚</p><p>setStateä¸ºä»€ä¹ˆè¦è®¾è®¡æˆâ€œå¼‚æ­¥â€çš„ï¼Œå› ä¸º<code>setState()</code>ä¹‹åæ— æ³•ç«‹é©¬è·å–æœ€æ–°çš„ stateï¼Œç»™äººçš„æ„Ÿè§‰ä¾¿æ˜¯å¼‚æ­¥å»è®¾ç½®çŠ¶æ€ã€‚ä¹Ÿç¡®å®æ˜¯æœ‰å¼‚æ­¥çš„æ„Ÿè§‰ã€‚</p><h3 id="åˆæˆäº‹ä»¶"><a href="#åˆæˆäº‹ä»¶" class="headerlink" title="åˆæˆäº‹ä»¶"></a>åˆæˆäº‹ä»¶</h3><p>Reactä¸ºäº†è§£å†³è·¨å¹³å°ï¼Œå…¼å®¹æ€§é—®é¢˜ï¼Œè‡ªå·±å°è£…äº†ä¸€å¥—äº‹ä»¶æœºåˆ¶ï¼Œä»£æ›¿äº†åŸç”Ÿçš„äº‹ä»¶ï¼Œåƒåœ¨jsxä¸­å¸¸è§çš„onClickã€onChangeè¿™äº›éƒ½æ˜¯åˆæˆäº‹ä»¶</p><h3 id="åŸç”Ÿäº‹ä»¶"><a href="#åŸç”Ÿäº‹ä»¶" class="headerlink" title="åŸç”Ÿäº‹ä»¶"></a>åŸç”Ÿäº‹ä»¶</h3><p>åŸç”Ÿäº‹ä»¶æ˜¯æŒ‡éReactåˆæˆäº‹ä»¶ï¼ŒåŸç”Ÿè‡ªå¸¦çš„äº‹ä»¶ç›‘å¬addEventListenerï¼Œæˆ–è€…ä¹Ÿå¯ä»¥ç”¨åŸç”Ÿjsï¼Œjqueryç›´æ¥document.querySelector().onclick è¿™ç§ç»‘å®šäº‹ä»¶çš„å½¢å¼éƒ½å±äºåŸç”Ÿäº‹ä»¶ã€‚</p><p><a href="https://codesandbox.io/s/k2jwvz03m3?expanddevtools=1&amp;file=/src/index.js" target="_blank" rel="noopener">ç‚¹å‡»æ‰§è¡Œ</a>ï¼Œç‚¹ä¸€ç‚¹ç†è§£å°±å¾ˆæ¸…æ¥šäº†</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    count: <span class="number">0</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="comment">// ç”Ÿå‘½å‘¨æœŸä¸­è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">count</span>: <span class="keyword">this</span>.state.count + <span class="number">1</span> &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"lifecycle: "</span> + <span class="keyword">this</span>.state.count);</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// setTimeoutä¸­è°ƒç”¨</span></span><br><span class="line">      <span class="keyword">this</span>.setState(&#123; <span class="attr">count</span>: <span class="keyword">this</span>.state.count + <span class="number">1</span> &#125;);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"setTimeout: "</span> + <span class="keyword">this</span>.state.count);</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"div2"</span>).addEventListener(<span class="string">"click"</span>, <span class="keyword">this</span>.increment2);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  increment = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// åˆæˆäº‹ä»¶ä¸­è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">count</span>: <span class="keyword">this</span>.state.count + <span class="number">1</span> &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"react event: "</span> + <span class="keyword">this</span>.state.count);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  increment2 = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// åŸç”Ÿäº‹ä»¶ä¸­è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">count</span>: <span class="keyword">this</span>.state.count + <span class="number">1</span> &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"dom event: "</span> + <span class="keyword">this</span>.state.count);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">        &lt;h2&gt;couont: &#123;<span class="keyword">this</span>.state.count&#125;&lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div id="div1" onClick=&#123;this.increment&#125;&gt;</span></span><br><span class="line"><span class="regexp">          click me and count+1</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br><span class="line">        &lt;div id=<span class="string">"div2"</span>&gt;click me and count+<span class="number">1</span>&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gga4li3ykej31400mawj5.jpg" alt="image-20200630105133004"></p><h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><blockquote><p>ä¸‹é¢çš„å¼‚æ­¥æ˜¯å¸¦å¼•å·çš„</p></blockquote><ol><li>setState åªåœ¨åˆæˆäº‹ä»¶å’Œé’©å­å‡½æ•°ä¸­çš„æ˜¯å¼‚æ­¥çš„ï¼Œåœ¨åŸç”Ÿäº‹ä»¶å’Œ<strong>setTimeout</strong>ä¸­éƒ½æ˜¯åŒæ­¥çš„</li><li>setState çš„å¼‚æ­¥å¹¶ä¸æ˜¯è¯´å†…éƒ¨ç”±å¼‚æ­¥ä»£ç å®ç°ï¼Œå…¶å®æœ¬èº«æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å’Œä»£ç éƒ½æ˜¯åŒæ­¥çš„ï¼Œåªæ˜¯åˆæˆäº‹ä»¶å’Œé’©å­å‡½æ•°çš„è°ƒç”¨é¡ºåºåœ¨æ›´æ–°ä¹‹å‰ï¼Œå¯¼è‡´åœ¨åˆæˆäº‹ä»¶å’Œé’©å­å‡½æ•°ä¸­æ²¡æ³•ç«‹é©¬æ‹¿åˆ°æ›´æ–°åçš„å€¼ï¼Œå½¢æˆäº†æ‰€è°“çš„å¼‚æ­¥ï¼Œå½“ç„¶å¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°setState(partialState, callback)ä¸­çš„callbackæ‹¿åˆ°æ›´æ–°åçš„ç»“æœ</li><li>setState çš„æ‰¹é‡æ›´æ–°ä¼˜åŒ–ä¹Ÿæ˜¯å»ºç«‹åœ¨å¼‚æ­¥ï¼ˆåˆæˆäº‹ä»¶ï¼Œé’©å­å‡½æ•°ï¼‰åªä¸Šçš„ï¼Œåœ¨åŸç”Ÿäº‹ä»¶å’ŒsetTimeoutä¸­ä¸ä¼šæ‰¹é‡æ›´æ–°ï¼Œåœ¨å¼‚æ­¥ä¸­å¦‚æœå¯¹åŒä¸€ä¸ªå€¼è¿›è¡Œå¤šæ¬¡setTimeoutï¼ŒsetStateçš„æ‰¹é‡æ›´æ–°ç­–ç•¥ä¼šå¯¹å…¶è¿›è¡Œè¦†ç›–ï¼Œå–æœ€åä¸€æ¬¡çš„æ‰§è¡Œï¼Œå¦‚æœæ˜¯åŒäº‹setStateå¯¹ä¸ªä¸åŒçš„å€¼ï¼Œåœ¨æ›´æ–°æ—¶ä¼šå¯¹å…¶è¿›è¡Œåˆå¹¶æ‰¹é‡æ›´æ–°</li></ol><h3 id="20210107è¡¥å……"><a href="#20210107è¡¥å……" class="headerlink" title="20210107è¡¥å……"></a>20210107è¡¥å……</h3><p>setState å¼‚æ­¥çš„ï¼Œæ€§èƒ½ä¼˜åŒ–è¿‡ç¨‹ä¸­çš„batchedUpdatesæ‰¹å¤„ç†ï¼Œå½“è§¦å‘äº‹ä»¶ï¼Œå¤šä¸ªthis.setState,åªè§¦å‘ä¸€æ¬¡ï¼Œå¤šæ¬¡åˆå¹¶ä¸ºä¸€æ¬¡ï¼Œæå‡reactæ€§èƒ½ã€‚</p><p>å…¨å±€å˜é‡executionContext |= BatchedContext<br>setTimeOut, å…¨éƒ¨çš„ä¸Šä¸‹æ–‡ä¸å­˜åœ¨BathedContext,è·³å‡º,åŒæ­¥æ›´æ–°</p><p>ä»¥ä¸Šæ˜¯åŸºäºReactDom.render(<app>, rootElement)   legacyæ¨¡å¼</app></p><p>å¦‚æœå¼€å¯Concurrentæ¨¡å¼åˆ™å…¨æ˜¯å¼‚æ­¥ï¼Œ ReactDom.unstable_createRoot(rootElement).render(App /)</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gmf5oykrulj31050ittb6.jpg" alt=""><br><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gmf5oxt81bj30gq09kt9p.jpg" alt=""></p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol><li><a href="https://juejin.im/post/5b45c57c51882519790c7441" target="_blank" rel="noopener">https://juejin.im/post/5b45c57c51882519790c7441</a></li></ol>]]></content>
    
    <summary type="html">
    
      setState çš„åˆå¹¶æ˜¯é€šè¿‡é˜Ÿåˆ—å®ç°çš„ã€‚é€šè¿‡åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—æ¥ä¿å­˜æ¯æ¬¡ setState çš„æ•°æ®ï¼Œç„¶åæ¯éš”ä¸€æ®µæ—¶é—´ï¼Œæ¸…ç©ºå’Œè¿™ä¸ªé˜Ÿåˆ—å¹¶æ¸²æŸ“ç»„ä»¶ã€‚åœ¨ React çš„ setState ä¸­ï¼Œåˆ©ç”¨ JavaScript çš„äº‹ä»¶å¾ªç¯æœºåˆ¶å¯¹å¤šä¸ª setState è°ƒç”¨è¿›è¡Œåˆå¹¶ã€‚é¦–å…ˆåˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ä¿å­˜æ¯æ¬¡ setState çš„æ•°æ®ï¼Œåœ¨ä¸€æ¬¡äº‹ä»¶å¾ªç¯çš„æ‰€æœ‰åŒæ­¥ä»»åŠ¡ä¹‹åï¼Œæ¸…ç©ºç€é˜Ÿåˆ—ï¼Œå°†é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰ setState è¿›è¡Œåˆå¹¶ï¼Œå¹¶è¿›è¡Œä¸€æ¬¡æ€§æ›´æ–°æ¸²æŸ“ã€‚è¿™æ ·åœ¨ä¸€æ¬¡äº‹ä»¶å¾ªç¯çš„ï¼Œæœ€å¤šåªä¼šæ‰§è¡Œä¸€æ¬¡åˆå¹¶æ“ä½œï¼Œå¹¶ä¸”åªä¼šæ¸²æŸ“ä¸€æ¬¡ç»„ä»¶ã€‚
    
    </summary>
    
      <category term="é»˜è®¤åˆ†ç±»" scheme="https://kitions.github.io/categories/%E9%BB%98%E8%AE%A4%E5%88%86%E7%B1%BB/"/>
    
    
      <category term="react" scheme="https://kitions.github.io/tags/react/"/>
    
  </entry>
  
  <entry>
    <title>å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡</title>
    <link href="https://kitions.github.io/2020/05/29/%E5%AE%8F%E4%BB%BB%E5%8A%A1%E4%B8%8E%E5%BE%AE%E4%BB%BB%E5%8A%A1/"/>
    <id>https://kitions.github.io/2020/05/29/å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡/</id>
    <published>2020-05-29T12:34:54.000Z</published>
    <updated>2020-06-30T07:17:21.421Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡"><a href="#å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡" class="headerlink" title="å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡"></a>å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡</h1><p>åœ¨ç‚¹å‡»äº‹ä»¶å†’æ³¡æ•è·çš„å¤„ç†ä¸­ï¼Œé€šè¿‡ä½¿ç”¨setTimeout çš„æ–¹å¼ï¼Œæƒ³è¦è°ƒæ•´æŸä¸ªä»£ç çš„æ‰§è¡Œé¡ºåºçš„è¯ï¼Œå…¶å…·ä½“çš„æ‰§è¡Œé¡ºåºï¼Œç”±ä¸€å¥—  <strong>æœºåˆ¶</strong>  å»å®ç°ï¼Œè¿™å¥—æœºåˆ¶å°±æ˜¯é€šè¿‡å®šä¹‰ <strong>å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡</strong> æ¥å®‰æ’æ‰§è¡Œé¡ºåºã€‚</p><h2 id="å¼‚æ­¥æœºåˆ¶ï¼šjavascriptäº‹ä»¶å¾ªç¯"><a href="#å¼‚æ­¥æœºåˆ¶ï¼šjavascriptäº‹ä»¶å¾ªç¯" class="headerlink" title="å¼‚æ­¥æœºåˆ¶ï¼šjavascriptäº‹ä»¶å¾ªç¯"></a>å¼‚æ­¥æœºåˆ¶ï¼šjavascriptäº‹ä»¶å¾ªç¯</h2><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggabuqi9gbj313s0u0n1x.jpg" alt="image-20200507113822255"></p><p><strong>å†…å­˜å †</strong>ï¼šè¿™æ˜¯å†…å­˜åˆ†é…å‘ç”Ÿçš„åœ°æ–¹ã€‚å½“V8å¼•æ“é‡åˆ°å˜é‡å£°æ˜å’Œå‡½æ•°å£°æ˜çš„æ—¶å€™ï¼Œå°±æŠŠå®ƒä»¬å­˜å‚¨åœ¨å †é‡Œé¢ã€‚</p><p><strong>è°ƒç”¨æ ˆ</strong>ï¼šè¿™æ˜¯ä½ çš„ä»£ç æ‰§è¡Œæ—¶çš„åœ°æ–¹ã€‚å½“å¼•æ“é‡åˆ°åƒå‡½æ•°è°ƒç”¨ä¹‹ç±»çš„å¯æ‰§è¡Œå•å…ƒï¼Œå°±ä¼šæŠŠå®ƒä»¬æ¨å…¥è°ƒç”¨æ ˆã€‚</p><p>JSå•çº¿ç¨‹ï¼ŒæŒ‡çš„æ˜¯åœ¨JSå¼•æ“ä¸­ï¼Œè§£ææ‰§è¡ŒJSä»£ç çš„è°ƒç”¨æ ˆæ˜¯å”¯ä¸€çš„ï¼Œæ‰€æœ‰çš„JSä»£ç éƒ½åœ¨è¿™ä¸€ä¸ªè°ƒç”¨æ ˆé‡ŒæŒ‰ç…§è°ƒç”¨é¡ºåºæ‰§è¡Œï¼Œä¸èƒ½åŒæ—¶æ‰§è¡Œå¤šä¸ªå‡½æ•°ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggabvgopfkj31470u0jyq.jpg" alt="image-20200507154251938" style="zoom: 33%;"></p><p><strong>Web APIs</strong>ï¼šè¿˜æœ‰å¾ˆå¤šå¼•æ“ä¹‹å¤–çš„ APIï¼Œæˆ‘ä»¬æŠŠè¿™äº›ç§°ä¸ºæµè§ˆå™¨æä¾›çš„ Web APIï¼Œæ¯”å¦‚è¯´ äº‹ä»¶ç›‘å¬å‡½æ•°ã€DOMã€HTTPï¼AJAXè¯·æ±‚ã€setTimeoutç­‰ç­‰ã€‚</p><p><strong>å›è°ƒé˜Ÿåˆ—</strong>ï¼ˆEvent Queue)ï¼šæŒ‰ç…§<strong>å…ˆè¿›å…ˆå‡º</strong>çš„é¡ºåºå­˜å‚¨æ‰€æœ‰çš„å›è°ƒå‡½æ•°ã€‚åœ¨ä»»æ„æ—¶é—´ï¼Œåªè¦Web APIå®¹å™¨ä¸­çš„äº‹ä»¶è¾¾åˆ°è§¦å‘æ¡ä»¶ï¼Œå°±å¯ä»¥æŠŠå›è°ƒå‡½æ•°æ·»åŠ åˆ°å›è°ƒé˜Ÿåˆ—ä¸­å»ã€‚</p><p><strong>äº‹ä»¶å¾ªç¯ </strong> (Event Loop)ï¼šæŒç»­çš„æ£€æµ‹è°ƒç”¨æ ˆå’Œå›è°ƒé˜Ÿåˆ—ï¼Œå¦‚æœæ£€æµ‹åˆ°è°ƒç”¨æ ˆä¸ºç©ºï¼Œå®ƒå°±ä¼šé€šçŸ¥å›è°ƒé˜Ÿåˆ—æŠŠé˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°æ¨å…¥æ‰§è¡Œæ ˆã€‚</p><h3 id="æœºåˆ¶"><a href="#æœºåˆ¶" class="headerlink" title="æœºåˆ¶"></a>æœºåˆ¶</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ggabvmfj03j30vw0qo7fl.jpg" alt="tapd_55367591_base64_1587813146_16"></p><p>JSè¿è¡Œæ—¶ç¯å¢ƒçš„å·¥ä½œæœºåˆ¶ï¼š</p><ol><li><strong>JSå¼•æ“</strong>ï¼šï¼ˆå”¯ä¸€ä¸»çº¿ç¨‹ï¼‰æŒ‰é¡ºåºè§£æä»£ç ï¼Œé‡åˆ°å‡½æ•°å£°æ˜ï¼Œå…¥å †ï¼Œé‡åˆ°å‡½æ•°è°ƒç”¨ï¼Œå…¥æ ˆï¼›</li><li>å¦‚æœæ˜¯åŒæ­¥å‡½æ•°è°ƒç”¨ï¼Œç›´æ¥æ‰§è¡Œå¾—åˆ°ç»“æœï¼ŒåŒæ­¥å‡½æ•°å¼¹å‡ºæ ˆï¼Œç»§ç»­ä¸‹ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼›</li><li>å¦‚æœæ˜¯å¼‚æ­¥å‡½æ•°è°ƒç”¨ï¼Œåˆ†å‘ç»™<strong>Web API</strong>ï¼ˆå¤šä¸ªè¾…åŠ©çº¿ç¨‹ï¼‰ï¼Œè¿›å…¥Event Tableå¹¶æ³¨å†Œå‡½æ•°ï¼Œå¼‚æ­¥å‡½æ•°å¼¹å‡ºæ ˆï¼Œç»§ç»­ä¸‹ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼›</li><li>Web APIä¸­ï¼Œå¼‚æ­¥å‡½æ•°åœ¨ç›¸åº”è¾…åŠ©çº¿ç¨‹ä¸­å¤„ç†å®Œæˆåï¼Œå³å¼‚æ­¥å‡½æ•°è¾¾åˆ°è§¦å‘æ¡ä»¶äº†ï¼ŒEvent Tableå°±å°†å›è°ƒå‡½æ•°æ¨å…¥<strong>å›è°ƒé˜Ÿåˆ—</strong>ä¸­ã€‚</li><li><strong>Event Loop</strong>ï¼šä¸åœåœ°æ£€æŸ¥ä¸»çº¿ç¨‹çš„è°ƒç”¨æ ˆä¸å›è°ƒé˜Ÿåˆ—ï¼Œå½“è°ƒç”¨æ ˆç©ºæ—¶ï¼Œå°±æŠŠå›è°ƒé˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªä»»åŠ¡æ¨å…¥æ ˆä¸­æ‰§è¡Œï¼Œä¸æ–­å¾ªç¯ã€‚</li></ol><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><p>ä¸‹é¢æ˜¯ä¸€æ®µç®€æ˜“çš„ <code>ajax</code> è¯·æ±‚ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let data = [];</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">    url:www.javascript.com,</span><br><span class="line">    data:data,</span><br><span class="line">    success:() =&gt; &#123;</span><br><span class="line">        console.log(&apos;å‘é€æˆåŠŸ!&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">console.log(&apos;ä»£ç æ‰§è¡Œç»“æŸ&apos;);</span><br></pre></td></tr></table></figure><ul><li><p>ajaxè¿›å…¥Event Tableï¼Œæ³¨å†Œå›è°ƒå‡½æ•° <code>success</code> ã€‚</p></li><li><p>æ‰§è¡Œ <code>console.log(&#39;ä»£ç æ‰§è¡Œç»“æŸ&#39;)</code> ã€‚</p></li><li><p>ajaxäº‹ä»¶å®Œæˆï¼Œå›è°ƒå‡½æ•° <code>success</code> è¿›å…¥Event Queueã€‚</p></li><li><p>ä¸»çº¿ç¨‹ä»Event Queueè¯»å–å›è°ƒå‡½æ•° <code>success</code> å¹¶æ‰§è¡Œã€‚</p></li></ul><p>ä¸‹é¢æ˜¯ä¸€æ®µæ›´è¯¦ç»†çš„ä¾‹å­ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Hey, Why am I last?'</span>)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHi</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Hello'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayBye</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Goodbye'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sayHi()</span><br><span class="line">sayBye()</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>JSå¼•æ“ä¼šæ£€æŸ¥æ•´æ®µä»£ç çš„è¯­æ³•é”™è¯¯ï¼Œå¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œå°±ä»å¤´å¼€å§‹æ·±åº¦è§£æ</li><li>é¦–å…ˆé‡åˆ°setTimeoutå‡½æ•°è°ƒç”¨ï¼ŒæŠŠå®ƒæ¨å…¥æ‰§è¡Œæ ˆé¡¶</li><li>è§£æå‡½æ•°ä½“ï¼Œå‘ç°setTimeoutå‡½æ•°æ˜¯Web APIçš„ä¸€ç§ï¼Œå› æ­¤å°±æŠŠå®ƒåˆ†å‘åˆ°Web APIæ¨¡å—ç„¶åæ¨å‡ºæ ˆ</li><li>å› ä¸ºå®šæ—¶å™¨è®¾ç½®äº†0mså»¶è¿Ÿï¼Œå› æ­¤Web APIæ¨¡å—ç«‹å³æŠŠå®ƒçš„åŒ¿åå›è°ƒå‡½æ•°æ¨å…¥åˆ°å›è°ƒå‡½æ•°å‡½æ•°é˜Ÿåˆ—ã€‚äº‹ä»¶å¾ªç¯æ£€æµ‹æ‰§è¡Œæ ˆæ˜¯å¦æ˜¯ç©ºé—²ï¼Œä½†æ˜¯å½“å‰æ ˆå¹¶ä¸ç©ºé—²ï¼Œå› ä¸ºâ€¦</li><li>å½“setTimeoutå‡½æ•°ä¸€è¢«åˆ†å‘åˆ°Web APIæ¨¡å—ï¼ŒJSå¼•æ“å‘ç°äº†ä¸¤ä¸ªå‡½æ•°å£°æ˜ï¼ŒæŠŠå®ƒä»¬å­˜å‚¨åœ¨å †å†…å­˜é‡Œï¼Œç„¶åé‡åˆ°äº†sayHiå‡½æ•°çš„è°ƒç”¨ï¼Œå°±æŠŠå®ƒæ¨å…¥äº†æ ˆé¡¶</li><li>sayHiå‡½æ•°è°ƒç”¨äº†console.logå‡½æ•°ï¼Œå› æ­¤console.logå°±è¢«æ¨å…¥äº†æ ˆé¡¶</li><li>JSå¼•æ“å¼€å§‹è§£æconsole.logçš„å‡½æ•°ä½“ï¼Œå®ƒæ¥æ”¶äº†ä¸€ä¸ªæ¶ˆæ¯å»æ‰“å°â€˜Helloâ€™ï¼Œç„¶åè¢«å¼¹å‡ºæ ˆ</li><li>JSå¼•æ“è¿”å›åˆ°å‡½æ•°sayHiçš„æ‰§è¡Œï¼Œé‡åˆ°å‡½æ•°çš„ç»“æŸç¬¦å·}ä¹‹åï¼ŒæŠŠsayHiå¼¹å‡ºæ ˆ</li><li>sayHiå‡½æ•°ä¸€å‡ºæ ˆï¼Œç´§æ¥ç€sayByeå‡½æ•°è¢«è°ƒç”¨ï¼Œå®ƒå°±è¢«æ¨å…¥æ ˆé¡¶ï¼Œè¢«è§£æï¼Œè°ƒç”¨console.logï¼ŒæŠŠconsole.logæ¨å…¥æ ˆé¡¶ï¼Œæ‰“å°ä¸€æ¡æ¶ˆæ¯ï¼Œå¼¹å‡ºæ ˆã€‚ç„¶åsayByeå‡½æ•°å¼¹å‡ºæ ˆ</li><li>äº‹ä»¶å¾ªç¯æ£€æµ‹åˆ°æ‰§è¡Œæ ˆç»ˆäºç©ºé—²äº†ï¼Œé€šçŸ¥å›è°ƒé˜Ÿåˆ—ï¼Œç„¶åå›è°ƒé˜Ÿåˆ—æŠŠå…¶ä¸­çš„åŒ¿åå‡½æ•°æ¨å…¥æ‰§è¡Œæ ˆ</li><li>åŒ¿åå‡½æ•°ï¼ˆå°±æ˜¯setTimeoutçš„å›è°ƒå‡½æ•°ï¼‰è¢«è§£æï¼Œè°ƒç”¨console.logï¼Œconsole.logæ¨å…¥æ ˆé¡¶</li><li>console.logæ‰§è¡Œå®Œæ¯•ã€å†å‡ºæ ˆ</li><li>åŒ¿åå‡½æ•°å†è¢«æ¨å‡ºæ ˆï¼Œç¨‹åºç»“æŸ</li></ol><h2 id="å¦ä¸€ä¸ªå¼‚æ­¥æœºåˆ¶ï¼šå®ä»»åŠ¡ä¸å¾®ä»»åŠ¡"><a href="#å¦ä¸€ä¸ªå¼‚æ­¥æœºåˆ¶ï¼šå®ä»»åŠ¡ä¸å¾®ä»»åŠ¡" class="headerlink" title="å¦ä¸€ä¸ªå¼‚æ­¥æœºåˆ¶ï¼šå®ä»»åŠ¡ä¸å¾®ä»»åŠ¡"></a>å¦ä¸€ä¸ªå¼‚æ­¥æœºåˆ¶ï¼šå®ä»»åŠ¡ä¸å¾®ä»»åŠ¡</h2><p>ä½†æ˜¯ï¼ŒJSå¼‚æ­¥è¿˜æœ‰ä¸€ä¸ªæœºåˆ¶ï¼Œå°±æ˜¯é‡åˆ°å®ä»»åŠ¡ï¼Œå…ˆå¤„ç†å®ä»»åŠ¡â€”â€”å°†å®ä»»åŠ¡æ”¾å…¥Event Queueï¼Œç„¶åå†å¤„ç†å¾®ä»»åŠ¡â€”â€”å°†å¾®ä»»åŠ¡æ”¾å…¥Event Queueã€‚<br>æ³¨æ„ï¼Œè¿™é‡Œä¸¤ä¸ªEvent Queueä¸æ˜¯åŒä¸€ä¸ªqueueã€‚<br>å½“jså¼•æ“çš„ä¸»çº¿ç¨‹æ‰§è¡Œæ ˆä¸ºç©ºæ—¶ï¼Œå®ƒä¼šä¼˜å…ˆä»å¾®ä»»åŠ¡queueé‡Œéå†æ³¨å†Œçš„å›è°ƒå‡½æ•°å¹¶ä¸€ä¸€æ‰§è¡Œï¼Œç„¶åå†ä»å®ä»»åŠ¡çš„queueé‡Œéå†æ‰§è¡Œæ³¨å†Œçš„å›è°ƒå‡½æ•°ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://bucket-1256530863.cos.ap-shanghai.myqcloud.com/tapd_55367591_1587814302_40.png" alt="tapd_55367591_1587814302_40" style="zoom: 50%;"></p><ul><li><p><strong>Web API</strong>ä¸­ï¼Œå¼‚æ­¥å‡½æ•°åœ¨ç›¸åº”è¾…åŠ©çº¿ç¨‹ä¸­å¤„ç†å®Œæˆåï¼Œå³å¼‚æ­¥å‡½æ•°è¾¾åˆ°è§¦å‘æ¡ä»¶äº†ï¼ˆæ¯”å¦‚setTimeoutè®¾ç½®çš„10såï¼‰ï¼Œå¦‚æœå¼‚æ­¥å‡½æ•°æ˜¯å®ä»»åŠ¡ï¼Œåˆ™å…¥<strong>å®ä»»åŠ¡æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼Œå¦‚æœæ˜¯å¾®ä»»åŠ¡ï¼Œåˆ™å…¥<strong>å¾®ä»»åŠ¡æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼›</p></li><li><p><strong>Event Loop</strong>ä¸åœåœ°æ£€æŸ¥ä¸»çº¿ç¨‹çš„è°ƒç”¨æ ˆä¸å›è°ƒé˜Ÿåˆ—ï¼Œå½“è°ƒç”¨æ ˆç©ºæ—¶ï¼Œå°±æŠŠ<strong>å¾®ä»»åŠ¡</strong>æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªä»»åŠ¡æ¨å…¥æ ˆä¸­æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæˆåï¼Œå†å–ç¬¬äºŒä¸ªå¾®ä»»åŠ¡ï¼Œç›´åˆ°å¾®ä»»åŠ¡æ¶ˆæ¯é˜Ÿåˆ—ä¸ºç©ºï¼›ç„¶å å»å®ä»»åŠ¡æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–ç¬¬ä¸€ä¸ªå®ä»»åŠ¡æ¨å…¥æ ˆä¸­æ‰§è¡Œï¼Œå½“è¯¥å®ä»»åŠ¡æ‰§è¡Œå®Œæˆåï¼Œåœ¨ä¸‹ä¸€ä¸ªå®ä»»åŠ¡æ‰§è¡Œå‰ï¼Œå†ä¾æ¬¡å–å‡ºå¾®ä»»åŠ¡æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å¾®ä»»åŠ¡å…¥æ ˆæ‰§è¡Œã€‚</p></li></ul><p>ä¸Šè¿°è¿‡ç¨‹ä¸æ–­å¾ªç¯ï¼Œæ¯å½“å¾®ä»»åŠ¡é˜Ÿåˆ—æ¸…ç©ºï¼Œå¯ä½œä¸ºæœ¬è½®äº‹ä»¶å¾ªç¯çš„ç»“æŸã€‚</p><p><strong>å®ä»»åŠ¡</strong> (macrotask/task)</p><p>åŒ…æ‹¬ï¼š</p><ul><li>I/Oï¼ˆä¾‹å¦‚ç‚¹å‡»ä¸€æ¬¡<code>button</code>ï¼Œä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸ç¨‹åºäº§ç”Ÿäº¤äº’çš„è¿™äº›éƒ½å¯ä»¥ç§°ä¹‹ä¸º<code>I/O</code>ï¼‰</li><li>setTimeout</li><li>setInterval</li><li>setImmediateï¼ˆä»…Nodeï¼‰</li><li>requestAnimationFrameï¼ˆä»…æµè§ˆå™¨ï¼‰</li><li>xhr</li><li>postMessage</li><li>MessageChannel</li></ul><p>å¯¹äº <code>setInterval(fn,ms)</code> æ¥è¯´ï¼Œä¸æ˜¯æ¯è¿‡ <code>ms</code> ç§’ä¼šæ‰§è¡Œä¸€æ¬¡ <code>fn</code> ï¼Œè€Œæ˜¯æ¯è¿‡ <code>ms</code> ç§’ï¼Œä¼šæœ‰ <code>fn</code> è¿›å…¥Event Queueã€‚<br>ä¸€æ—¦ <code>setInterval</code> çš„å›è°ƒå‡½æ•° <code>fn</code> æ‰§è¡Œæ—¶é—´è¶…è¿‡äº†å»¶è¿Ÿæ—¶é—´ <code>ms</code> ï¼Œé‚£ä¹ˆå°±å®Œå…¨çœ‹ä¸å‡ºæ¥æœ‰æ—¶é—´é—´éš”äº†ã€‚</p><p><em>P.S. æœ‰äº›åœ°æ–¹ä¼šåˆ—å‡ºæ¥<code>UI Rendering</code>ï¼Œè¯´è¿™ä¸ªä¹Ÿæ˜¯å®ä»»åŠ¡ï¼Œå¯æ˜¯åœ¨è¯»äº†<a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop-processing-model" target="_blank" rel="noopener">HTMLè§„èŒƒæ–‡æ¡£</a>ä»¥åï¼Œå‘ç°è¿™å¾ˆæ˜¾ç„¶æ˜¯å’Œå¾®ä»»åŠ¡å¹³è¡Œçš„ä¸€ä¸ªæ“ä½œæ­¥éª¤</em></p><p><em>P.S. <code>requestAnimationFrame</code>åœ¨<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame" target="_blank" rel="noopener">MDNçš„å®šä¹‰</a>ä¸ºï¼Œä¸‹æ¬¡é¡µé¢é‡ç»˜å‰æ‰€æ‰§è¡Œçš„æ“ä½œï¼Œè€Œé‡ç»˜ä¹Ÿæ˜¯ä½œä¸ºå®ä»»åŠ¡çš„ä¸€ä¸ªæ­¥éª¤æ¥å­˜åœ¨çš„ï¼Œä¸”è¯¥æ­¥éª¤æ™šäºå¾®ä»»åŠ¡çš„æ‰§è¡Œ</em></p><p><strong>å¾®ä»»åŠ¡</strong> (microtask/job)</p><p>åŒ…æ‹¬ï¼š</p><ul><li>Promise.then catch finally</li><li>process.nextTickï¼ˆä»…Nodeï¼‰</li><li>MutationObserverï¼ˆä»…æµè§ˆå™¨ï¼‰</li></ul><p><strong>P.S.</strong> new Promiseåœ¨å®ä¾‹åŒ–çš„è¿‡ç¨‹ä¸­æ‰€æ‰§è¡Œçš„ä»£ç éƒ½æ˜¯åŒæ­¥è¿›è¡Œçš„ï¼Œè€Œthenä¸­æ³¨å†Œçš„å›è°ƒæ‰æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚ async/awaitåº•å±‚æ˜¯åŸºäºPromiseå°è£…çš„ï¼Œæ‰€ä»¥awaitå‰é¢çš„ä»£ç ç›¸å½“äºnew Promiseï¼Œæ˜¯åŒæ­¥è¿›è¡Œçš„ï¼Œawaitåé¢çš„ä»£ç ç›¸å½“äºthenï¼Œæ‰æ˜¯å¼‚æ­¥è¿›è¡Œçš„ã€‚</p><p><strong>P.S</strong>.  åœ¨<a href="https://promisesaplus.com/#notes" target="_blank" rel="noopener">Promise/A+çš„è§„èŒƒ</a>ä¸­ï¼Œ<code>Promise</code>çš„å®ç°å¯ä»¥æ˜¯å¾®ä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥æ˜¯å®ä»»åŠ¡ï¼Œä½†æ˜¯æ™®éçš„å…±è¯†è¡¨ç¤º(è‡³å°‘<code>Chrome</code>æ˜¯è¿™ä¹ˆåšçš„)ï¼Œ<code>Promise</code>åº”è¯¥æ˜¯å±äºå¾®ä»»åŠ¡é˜µè¥çš„*</p><h3 id="ä¾‹å­-1"><a href="#ä¾‹å­-1" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="params">_</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">  resolve()</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">&#125;).then(<span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">3</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">2</span>)</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆè¾“å‡ºç»“æœä¸ºï¼š1 &gt; 2 &gt; 3 &gt; 4</p><p>å†æ¥çœ‹ä¸€ä¸ªåµŒå¥—çš„ç¤ºä¾‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Promise1'</span>) </span><br><span class="line">  <span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Promise2'</span>)    </span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'setTimeout1'</span>)</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'setTimeout2'</span>)</span><br><span class="line">  &#125;,<span class="number">0</span>)</span><br><span class="line">&#125;,<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>æœ€åè¾“å‡ºç»“æœæ˜¯Promise1 &gt; setTimeout1 &gt; Promise2 &gt; setTimeout2</p><p>Promise1</p><h2 id="Node-ç¯å¢ƒ"><a href="#Node-ç¯å¢ƒ" class="headerlink" title="Node ç¯å¢ƒ"></a>Node ç¯å¢ƒ</h2><h3 id="Nodeä¸­äº‹ä»¶å¾ªç¯"><a href="#Nodeä¸­äº‹ä»¶å¾ªç¯" class="headerlink" title="Nodeä¸­äº‹ä»¶å¾ªç¯"></a>Nodeä¸­äº‹ä»¶å¾ªç¯</h3><p> Nodeç”¨V8ä½œä¸ºjsçš„è§£æå¼•æ“ï¼Œè€ŒI/Oå¤„ç†æ–¹é¢ä½¿ç”¨äº†è‡ªå·±è®¾è®¡çš„libuvï¼Œlibuvæ˜¯ä¸€ä¸ªåŸºäºäº‹ä»¶é©±åŠ¨çš„è·¨å¹³å°æŠ½è±¡å±‚ï¼Œå°è£…äº†ä¸åŒæ“ä½œç³»ç»Ÿä¸€äº›åº•å±‚ç‰¹æ€§ï¼Œå¯¹å¤–æä¾›ç»Ÿä¸€çš„APIï¼Œäº‹ä»¶å¾ªç¯æœºåˆ¶ä¹Ÿæ˜¯å®ƒé‡Œé¢çš„å®ç°ã€‚ Nodeä¹Ÿæ˜¯å•çº¿ç¨‹ï¼Œä½†æ˜¯åœ¨å¤„ç†Event Loopä¸Šä¸æµè§ˆå™¨ç¨å¾®æœ‰äº›ä¸åŒã€‚</p><p>åœ¨nodeé‡Œï¼Œæœ‰ä¸€äº›å¸¸ç”¨çš„å¼‚æ­¥APIï¼Œè¿™é‡Œç®€å•ä»‹ç»ä¸‹ä»–ä»¬ï¼š</p><h4 id="setImmediate"><a href="#setImmediate" class="headerlink" title="setImmediate()"></a><strong>setImmediate()</strong></h4><p><code>setImmediate()</code>åœ¨ä¸€æ¬¡Event Loopæ‰§è¡Œå®Œæ¯•åç«‹åˆ»è°ƒç”¨ã€‚ </p><p><code>setTimeout</code>åˆ™æ˜¯é€šè¿‡è®¡ç®—ä¸€ä¸ªå»¶è¿Ÿæ—¶é—´åè¿›è¡Œæ‰§è¡Œã€‚</p><p>æ‰€ä»¥å¦‚ä¸‹ç¤ºä¾‹ï¼Œä¸èƒ½ä¿è¯è¾“å‡ºé¡ºåºã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="params">_</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'setTimeout'</span>))</span><br><span class="line">setImmediate(<span class="function"><span class="params">_</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'setImmediate'</span>))</span><br></pre></td></tr></table></figure><p>è€Œå¦‚æœæ˜¯ä¸‹é¢è¿™æ ·ï¼Œåˆ™ä¸€å®šæ˜¯setImmediateå…ˆè¾“å‡ºã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="params">_</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'setTimeout'</span>), <span class="number">20</span>)</span><br><span class="line">setImmediate(<span class="function"><span class="params">_</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'setImmediate'</span>))</span><br></pre></td></tr></table></figure><h4 id="process-nextTick"><a href="#process-nextTick" class="headerlink" title="process.nextTick()"></a><strong>process.nextTick()</strong></h4><p><code>process.nextTick()</code>ä¼šå°†å›è°ƒå‡½æ•°æ”¾å…¥é˜Ÿåˆ—ä¸­,åœ¨ä¸‹ä¸€è½®Tickæ—¶å–å‡ºæ‰§è¡Œ</p><p>è¿™æ˜¯å› ä¸º ï¼Œprocess.nextTick()ä¸­çš„å›è°ƒå‡½æ•°æ‰§è¡Œçš„ä¼˜å…ˆçº§è¦é«˜äºsetImmediate()ã€‚<br>Nodeé‡Œï¼Œäº‹ä»¶å¾ªç¯å¯¹è§‚å¯Ÿè€…çš„æ£€æŸ¥æ˜¯æœ‰å…ˆåé¡ºåºçš„,process.nextTick()å±äºidleè§‚å¯Ÿè€…, setImmediate()å±äºcheckè§‚å¯Ÿè€…ã€‚</p><p>process.nextTickå’ŒsetImmediateçš„ä¸€ä¸ªé‡è¦åŒºåˆ«ï¼šå¤šä¸ªprocess.nextTickè¯­å¥æ€»æ˜¯åœ¨å½“å‰â€æ‰§è¡Œæ ˆâ€ä¸€æ¬¡æ‰§è¡Œå®Œï¼Œå¤šä¸ªsetImmediateå¯èƒ½åˆ™éœ€è¦å¤šæ¬¡loopæ‰èƒ½æ‰§è¡Œå®Œã€‚ äº‹å®ä¸Šï¼Œè¿™æ­£æ˜¯Node.js 10.0ç‰ˆæ·»åŠ setImmediateæ–¹æ³•çš„åŸå› ï¼Œå¦åˆ™åƒä¸‹é¢è¿™æ ·çš„é€’å½’è°ƒç”¨process.nextTickï¼Œå°†ä¼šæ²¡å®Œæ²¡äº†ï¼Œä¸»çº¿ç¨‹æ ¹æœ¬ä¸ä¼šå»è¯»å–â€äº‹ä»¶é˜Ÿåˆ—â€ï¼</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">process.nextTick(<span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  process.nextTick(foo);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://juejin.im/post/5e972f3c518825739d40874a" target="_blank" rel="noopener">https://juejin.im/post/5e972f3c518825739d40874a</a></p><p><a href="https://juejin.im/post/5e9d0b48f265da47ff7cd9e6" target="_blank" rel="noopener">JSæ ¸å¿ƒç†è®ºä¹‹ã€Šè¿è¡Œæœºåˆ¶ä¸å®ä»»åŠ¡ã€å¾®ä»»åŠ¡ã€‹</a></p><p><a href="https://github.com/benyasin/js-core-theory/blob/master/JSå¼•æ“ã€è¿è¡Œæ—¶ä¸è°ƒç”¨æ¤æ ˆ.md" target="_blank" rel="noopener">JSæ ¸å¿ƒç†è®ºä¹‹ã€ŠJSå¼•æ“ã€è¿è¡Œæ—¶ä¸è°ƒç”¨æ¤æ ˆã€‹</a></p><h2 id="From"><a href="#From" class="headerlink" title="From"></a>From</h2><p><a href="http://mythcwj.com/" target="_blank" rel="noopener">copy from  wenjie</a></p>]]></content>
    
    <summary type="html">
    
      copy from  wenjie, åˆ†æçš„å¾ˆåˆ°ä½ï¼Œä¹Ÿéå¸¸è¯¦ç»†ã€‚é‡åˆ°å®ä»»åŠ¡ï¼Œå…ˆå¤„ç†å®ä»»åŠ¡â€”â€”å°†å®ä»»åŠ¡æ”¾å…¥Event Queueï¼Œç„¶åå†å¤„ç†å¾®ä»»åŠ¡â€”â€”å°†å¾®ä»»åŠ¡æ”¾å…¥Event Queueã€‚
    
    </summary>
    
      <category term="é»˜è®¤åˆ†ç±»" scheme="https://kitions.github.io/categories/%E9%BB%98%E8%AE%A4%E5%88%86%E7%B1%BB/"/>
    
    
      <category term="javascript" scheme="https://kitions.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>React diffæ­ç§˜</title>
    <link href="https://kitions.github.io/2020/05/26/react%20diff%E6%BA%90%E7%A0%81%E6%8F%AD%E7%A7%98/"/>
    <id>https://kitions.github.io/2020/05/26/react diffæºç æ­ç§˜/</id>
    <published>2020-05-26T13:56:43.000Z</published>
    <updated>2020-05-27T08:49:31.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="React-diffæ­ç§˜"><a href="#React-diffæ­ç§˜" class="headerlink" title="React diffæ­ç§˜"></a>React diffæ­ç§˜</h1><p>React æ¡†æ¶å†…éƒ¨çš„è¿ä½œå¯ä»¥åˆ†ä¸º 3 å±‚ï¼š</p><ul><li>Virtual DOM å±‚ï¼Œæè¿°é¡µé¢é•¿ä»€ä¹ˆæ ·ã€‚</li><li><strong>Reconciler å±‚ï¼Œè´Ÿè´£è°ƒç”¨ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œè¿›è¡Œ Diff è¿ç®—ç­‰</strong>ã€‚</li><li>Renderer å±‚ï¼Œæ ¹æ®ä¸åŒçš„å¹³å°ï¼Œæ¸²æŸ“å‡ºç›¸åº”çš„é¡µé¢ï¼Œæ¯”è¾ƒå¸¸è§çš„æ˜¯ ReactDOM å’Œ ReactNativeã€‚</li></ul><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gf71qq5z11j30sk0jbjzp.jpg" alt="image-20200527153644396"></p><p>ReactChildFiber.new.jsä¸­</p><h2 id="Diffçš„å…¥å£å‡½æ•°"><a href="#Diffçš„å…¥å£å‡½æ•°" class="headerlink" title="Diffçš„å…¥å£å‡½æ•°"></a>Diffçš„å…¥å£å‡½æ•°</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ¹æ®newChildç±»å‹é€‰æ‹©ä¸åŒdiffå‡½æ•°å¤„ç†</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reconcileChildFibers</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  returnFiber: Fiber,</span></span></span><br><span class="line"><span class="function"><span class="params">  currentFirstChild: Fiber | null,</span></span></span><br><span class="line"><span class="function"><span class="params">  newChild: any,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">Fiber</span> | <span class="title">null</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> isObject = <span class="keyword">typeof</span> newChild === <span class="string">'object'</span> &amp;&amp; newChild !== <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isObject) &#123;</span><br><span class="line">    <span class="comment">// objectç±»å‹ï¼Œå¯èƒ½æ˜¯ REACT_ELEMENT_TYPE æˆ– REACT_PORTAL_TYPE</span></span><br><span class="line">    <span class="keyword">switch</span> (newChild.$$<span class="keyword">typeof</span>) &#123;</span><br><span class="line">      <span class="keyword">case</span> REACT_ELEMENT_TYPE:</span><br><span class="line">        <span class="comment">// è°ƒç”¨ reconcileSingleElement å¤„ç†</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> REACT_PORTAL_TYPE:</span><br><span class="line">        <span class="comment">// è°ƒç”¨ reconcileSinglePortal</span></span><br><span class="line">        <span class="keyword">return</span> placeSingleChild(</span><br><span class="line">          reconcileSinglePortal(</span><br><span class="line">            ... <span class="comment">//å››ä¸ªå‚æ•°</span></span><br><span class="line">          ),</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> newChild === <span class="string">'string'</span> || <span class="keyword">typeof</span> newChild === <span class="string">'number'</span>) &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨ reconcileSingleTextNode å¤„ç†</span></span><br><span class="line">    reconcileSingleTextNode</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isArray(newChild)) &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨ reconcileChildrenArray å¤„ç†</span></span><br><span class="line">    reconcileChildrenArray</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸€äº›å…¶ä»–æƒ…å†µè°ƒç”¨å¤„ç†å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä»¥ä¸Šéƒ½æ²¡æœ‰å‘½ä¸­ï¼Œåˆ é™¤èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">return</span> deleteRemainingChildren(returnFiber, currentFirstChild);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>newChild</code>å‚æ•°å°±æ˜¯æœ¬æ¬¡æ›´æ–°çš„ JSX å¯¹è±¡ï¼ˆå¯¹åº”<code>ClassComponent</code>çš„<code>this.render</code>æ–¹æ³•è¿”å›å€¼ï¼Œæˆ–è€…<code>FunctionComponent</code>æ‰§è¡Œçš„è¿”å›å€¼ï¼‰</p><hr><h3 id="åŒçº§çš„èŠ‚ç‚¹æ•°é‡å°†Diffåˆ†ä¸ºä¸¤ç±»ï¼š"><a href="#åŒçº§çš„èŠ‚ç‚¹æ•°é‡å°†Diffåˆ†ä¸ºä¸¤ç±»ï¼š" class="headerlink" title="åŒçº§çš„èŠ‚ç‚¹æ•°é‡å°†Diffåˆ†ä¸ºä¸¤ç±»ï¼š"></a>åŒçº§çš„èŠ‚ç‚¹æ•°é‡å°†Diffåˆ†ä¸ºä¸¤ç±»ï¼š</h3><ol><li>å½“newChildç±»å‹ä¸º<code>object</code>ã€<code>number</code>ã€<code>string</code>ï¼Œä»£è¡¨åŒçº§åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹</li><li>å½“newChildç±»å‹ä¸º<code>Array</code>æ—¶ï¼Œä»£è¡¨åŒçº§æœ‰å¤šä¸ªèŠ‚ç‚¹</li></ol><h4 id="æƒ…å†µä¸€ï¼šåŒçº§åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹"><a href="#æƒ…å†µä¸€ï¼šåŒçº§åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹" class="headerlink" title="æƒ…å†µä¸€ï¼šåŒçº§åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹"></a>æƒ…å†µä¸€ï¼šåŒçº§åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹</h4><p>å¯¹äºå•ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬ä»¥ç±»å‹objectä¸ºä¾‹ï¼Œä¼šè¿›å…¥<code>reconcileSingleElement</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isObject = <span class="keyword">typeof</span> newChild === <span class="string">'object'</span> &amp;&amp; newChild !== <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isObject) &#123;</span><br><span class="line">    <span class="comment">// å¯¹è±¡ç±»å‹ï¼Œå¯èƒ½æ˜¯ REACT_ELEMENT_TYPE æˆ– REACT_PORTAL_TYPE</span></span><br><span class="line">    <span class="keyword">switch</span> (newChild.$$<span class="keyword">typeof</span>) &#123;</span><br><span class="line">      <span class="keyword">case</span> REACT_ELEMENT_TYPE:</span><br><span class="line">        <span class="comment">// è°ƒç”¨ reconcileSingleElement å¤„ç†</span></span><br><span class="line">      <span class="comment">// ...å…¶ä»–case</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gf4tpxrf79j30u00n40ye.jpg" alt="img"></p><blockquote><p><a href="https://github.com/BetaSu/react-on-the-way/blob/v1/packages/react-reconciler/ReactFiber.js#L15" target="_blank" rel="noopener">Fiber</a> å…¶å®æŒ‡çš„æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå®ƒå¯ä»¥ç”¨ä¸€ä¸ªçº¯ JS å¯¹è±¡æ¥è¡¨ç¤ºï¼š</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fiber = &#123;</span><br><span class="line">    stateNode,    <span class="comment">// èŠ‚ç‚¹å®ä¾‹</span></span><br><span class="line">    child,        <span class="comment">// å­èŠ‚ç‚¹</span></span><br><span class="line">    sibling,      <span class="comment">// å…„å¼ŸèŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">return</span>,       <span class="comment">// çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gf5pbqpocoj30i607z40d.jpg" alt="image-20200526114139235"></p><p>åœ¨<strong>render</strong>é˜¶æ®µä¼šç”Ÿæˆçš„Fiberç»“æ„</p><ul><li><p>Fiberä¸­å¯ä»¥ä¿å­˜èŠ‚ç‚¹çš„ç±»å‹ï¼Œä¾‹å­ä¸­AppèŠ‚ç‚¹æ˜¯ä¸€ä¸ªå‡½æ•°ç»„ä»¶èŠ‚ç‚¹ï¼ŒdivèŠ‚ç‚¹æ˜¯ä¸€ä¸ªåŸç”ŸDOMèŠ‚ç‚¹ï¼ŒI amèŠ‚ç‚¹æ˜¯ä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹ã€‚</p></li><li><p>å¯ä»¥ä¿å­˜èŠ‚ç‚¹çš„ä¿¡æ¯ï¼ˆæ¯”å¦‚stateï¼Œpropsï¼‰ã€‚</p></li><li><p>å¯ä»¥ä¿å­˜èŠ‚ç‚¹å¯¹åº”çš„å€¼ï¼ˆæ¯”å¦‚AppèŠ‚ç‚¹å¯¹åº”Appå‡½æ•°ï¼ŒdivèŠ‚ç‚¹å¯¹åº”div DOMElementï¼‰ã€‚è¿™æ ·çš„ç»“æ„ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆå‡½æ•°ç»„ä»¶é€šè¿‡<a href="https://zh-hans.reactjs.org/docs/hooks-intro.html" target="_blank" rel="noopener">Hooks</a>å¯ä»¥ä¿å­˜stateã€‚å› ä¸ºstateå¹¶ä¸æ˜¯ä¿å­˜åœ¨å‡½æ•°ä¸Šï¼Œè€Œæ˜¯ä¿å­˜åœ¨å‡½æ•°ç»„ä»¶å¯¹åº”çš„FiberèŠ‚ç‚¹ä¸Šã€‚</p></li><li><p>å¯ä»¥ä¿å­˜èŠ‚ç‚¹çš„è¡Œä¸ºï¼ˆæ›´æ–°/åˆ é™¤/æ’å…¥ï¼‰</p></li></ul><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gf5pe5bpcnj30ex0ct0u4.jpg" alt="image-20200526114358997"></p><p>div Fiber.return = App Fiber; å³ç”¨returnæŒ‡å‘è‡ªå·±çš„çˆ¶èŠ‚ç‚¹ã€‚çˆ¶çº§å«returnä¸å«parent</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gf5pilkjgnj30f50dewgf.jpg" alt="image-20200526114645771"></p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gf5leqv5u6j30iv0mwq5w.jpg" alt="image-20200526092607718"></p><p>åˆ¤æ–­DOMèŠ‚ç‚¹æ˜¯å¦å¯ä»¥å¤ç”¨ï¼Œè®©æˆ‘ä»¬é€šè¿‡ä»£ç çœ‹çœ‹æ˜¯å¦‚ä½•åˆ¤æ–­çš„ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reconcileSingleElement</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  returnFiber: Fiber,</span></span></span><br><span class="line"><span class="function"><span class="params">  currentFirstChild: Fiber | null,</span></span></span><br><span class="line"><span class="function"><span class="params">  element: ReactElement</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">Fiber</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> key = element.key;</span><br><span class="line">  <span class="keyword">let</span> child = currentFirstChild;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é¦–å…ˆåˆ¤æ–­æ˜¯å¦å­˜åœ¨å¯¹åº”DOMèŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">while</span> (child !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// ä¸Šä¸€æ¬¡æ›´æ–°å­˜åœ¨DOMèŠ‚ç‚¹ï¼Œæ¥ä¸‹æ¥åˆ¤æ–­æ˜¯å¦å¯å¤ç”¨</span></span><br><span class="line">    <span class="keyword">if</span> (child.key === key) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ğŸ™‹â€â™‚ï¸åŒå­¦çœ‹è¿™é‡Œï¼Œé¦–å…ˆæ¯”è¾ƒkeyæ˜¯å¦ç›¸åŒ</span></span><br><span class="line">      <span class="keyword">switch</span> (child.tag) &#123;</span><br><span class="line">        <span class="comment">// ...çœç•¥case</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">default</span>: &#123;</span><br><span class="line">          <span class="keyword">if</span> (child.elementType === element.type) &#123;</span><br><span class="line">            <span class="comment">// ğŸ™‹â€â™‚ï¸åŒå­¦çœ‹è¿™é‡Œï¼Œkeyç›¸åŒåå†çœ‹typeæ˜¯å¦ç›¸åŒ</span></span><br><span class="line">            <span class="comment">// å¦‚æœç›¸åŒåˆ™è¡¨ç¤ºå¯ä»¥å¤ç”¨</span></span><br><span class="line">            <span class="keyword">return</span> existing;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// typeä¸åŒåˆ™è·³å‡ºå¾ªç¯</span></span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// ğŸ‘¹ keyä¸åŒæˆ–typeä¸åŒéƒ½ä»£è¡¨ä¸èƒ½å¤ç”¨ï¼Œä¼šåˆ°è¿™é‡Œ</span></span><br><span class="line">      <span class="comment">// ä¸èƒ½å¤ç”¨çš„èŠ‚ç‚¹ï¼Œè¢«æ ‡è®°ä¸ºåˆ é™¤</span></span><br><span class="line">      deleteRemainingChildren(returnFiber, child);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      deleteChild(returnFiber, child);</span><br><span class="line">    &#125;</span><br><span class="line">    child = child.sibling;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ›å»ºæ–°Fiberï¼Œå¹¶è¿”å›</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ä»£ç å¯ä»¥çœ‹å‡ºï¼ŒReacté€šè¿‡å…ˆåˆ¤æ–­keyæ˜¯å¦ç›¸åŒï¼Œå¦‚æœkeyç›¸åŒåˆ™åˆ¤æ–­typeæ˜¯å¦ç›¸åŒï¼Œåªæœ‰éƒ½ç›¸åŒæ—¶ä¸€ä¸ªDOMèŠ‚ç‚¹æ‰èƒ½å¤ç”¨ã€‚</p><h6 id="ç»ƒä¹ é¢˜"><a href="#ç»ƒä¹ é¢˜" class="headerlink" title="ç»ƒä¹ é¢˜"></a>ç»ƒä¹ é¢˜</h6><p>è¯·åˆ¤æ–­å¦‚ä¸‹JSXå¯¹è±¡å¯¹åº”çš„DOMå…ƒç´ æ˜¯å¦å¯ä»¥å¤ç”¨ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¹ é¢˜1 æ›´æ–°å‰</span></span><br><span class="line">&lt;div&gt;<span class="number">123</span>&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ æ›´æ–°å</span></span><br><span class="line"><span class="regexp">&lt;p&gt;123&lt;/</span>p&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¹ é¢˜2 æ›´æ–°å‰</span></span><br><span class="line">&lt;div key=<span class="string">"xxx"</span>&gt;<span class="number">123</span>&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ æ›´æ–°å</span></span><br><span class="line"><span class="regexp">&lt;div key="ooo"&gt;123&lt;/</span>div&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¹ é¢˜3 æ›´æ–°å‰</span></span><br><span class="line">&lt;div key=<span class="string">"xxx"</span>&gt;<span class="number">123</span>&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ æ›´æ–°å</span></span><br><span class="line"><span class="regexp">&lt;p key="ooo"&gt;123&lt;/</span>p&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¹ é¢˜4 æ›´æ–°å‰</span></span><br><span class="line">&lt;div key=<span class="string">"xxx"</span>&gt;<span class="number">123</span>&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ æ›´æ–°å</span></span><br><span class="line"><span class="regexp">&lt;div key="xxx"&gt;456&lt;/</span>div&gt;</span><br></pre></td></tr></table></figure><p>`</p><p>`</p><p>`</p><p>`</p><p>`</p><p>`</p><p>`</p><p>ä¹ é¢˜1: æœªè®¾ç½®key propé»˜è®¤ key = null;ï¼Œæ‰€ä»¥æ›´æ–°å‰åkeyç›¸åŒï¼Œéƒ½ä¸ºnullï¼Œä½†æ˜¯æ›´æ–°å‰typeä¸ºdivï¼Œæ›´æ–°åä¸ºpï¼Œtypeæ”¹å˜åˆ™ä¸èƒ½å¤ç”¨ã€‚</p><p>ä¹ é¢˜2: æ›´æ–°å‰åkeyæ”¹å˜ï¼Œä¸éœ€è¦å†åˆ¤æ–­typeï¼Œä¸èƒ½å¤ç”¨ã€‚</p><p>ä¹ é¢˜3: æ›´æ–°å‰åkeyæ”¹å˜ï¼Œä¸éœ€è¦å†åˆ¤æ–­typeï¼Œä¸èƒ½å¤ç”¨ã€‚</p><p>ä¹ é¢˜4: æ›´æ–°å‰åkeyä¸typeéƒ½æœªæ”¹å˜ï¼Œå¯ä»¥å¤ç”¨ã€‚childrenå˜åŒ–ï¼ŒDOMçš„å­å…ƒç´ éœ€è¦æ›´æ–°ã€‚</p><h4 id="æƒ…å†µäºŒï¼šåŒçº§æœ‰å¤šä¸ªå…ƒç´ çš„Diff"><a href="#æƒ…å†µäºŒï¼šåŒçº§æœ‰å¤šä¸ªå…ƒç´ çš„Diff" class="headerlink" title="æƒ…å†µäºŒï¼šåŒçº§æœ‰å¤šä¸ªå…ƒç´ çš„Diff"></a>æƒ…å†µäºŒï¼šåŒçº§æœ‰å¤šä¸ªå…ƒç´ çš„Diff</h4><p>åˆšæ‰æˆ‘ä»¬ä»‹ç»äº†å•ä¸€å…ƒç´ çš„Diffï¼Œç°åœ¨è€ƒè™‘æˆ‘ä»¬æœ‰ä¸€ä¸ª<code>FunctionComponent</code>ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">List</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">            &lt;li key=<span class="string">"0"</span>&gt;<span class="number">0</span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">            &lt;li key="1"&gt;1&lt;/</span>li&gt;</span><br><span class="line">            &lt;li key=<span class="string">"2"</span>&gt;<span class="number">2</span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">            &lt;li key="3"&gt;3&lt;/</span>li&gt;</span><br><span class="line">        &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿”å›å€¼JSXå¯¹è±¡çš„childrenå±æ€§ä¸æ˜¯å•ä¸€å…ƒç´ ï¼Œè€Œæ˜¯åŒ…å«å››ä¸ªå¯¹è±¡çš„æ•°ç»„</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gf5lt57bhrj30u00bpwi1.jpg" alt="img"></p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒreconcileChildFibersçš„newChildå‚æ•°ä¸ºArrayï¼Œå°±æ‰§è¡Œåˆ°äº†è¿™å„¿</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gf5m5nz6goj30ft05vmxn.jpg" alt="image-20200526095202092"></p><p>æ¥çœ‹çœ‹Reactå¦‚ä½•å¤„ç†åŒçº§å¤šä¸ªå…ƒç´ çš„Diffã€‚</p><h3 id="åŒçº§å¤šä¸ªèŠ‚ç‚¹è¯¦è§£"><a href="#åŒçº§å¤šä¸ªèŠ‚ç‚¹è¯¦è§£" class="headerlink" title="åŒçº§å¤šä¸ªèŠ‚ç‚¹è¯¦è§£"></a><strong>åŒçº§å¤šä¸ªèŠ‚ç‚¹</strong>è¯¦è§£</h3><ol><li><p>èŠ‚ç‚¹æ›´æ–°</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// æƒ…å†µ1 èŠ‚ç‚¹æ›´æ–°</span><br><span class="line">    </span><br><span class="line">// ä¹‹å‰</span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"0"</span> <span class="attr">className</span>=<span class="string">"before"</span>&gt;</span>0<span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"1"</span>&gt;</span>1<span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">// ä¹‹åæƒ…å†µ1 èŠ‚ç‚¹å±æ€§å˜åŒ–</span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"0"</span> <span class="attr">className</span>=<span class="string">"after"</span>&gt;</span>0<span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"1"</span>&gt;</span>1<span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">// ä¹‹åæƒ…å†µ2 èŠ‚ç‚¹ç±»å‹æ›´æ–°</span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">"0"</span>&gt;</span>0<span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"1"</span>&gt;</span>1<span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li><p>èŠ‚ç‚¹æ–°å¢æˆ–å‡å°‘</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// æƒ…å†µ2 èŠ‚ç‚¹æ–°å¢æˆ–å‡å°‘</span><br><span class="line"></span><br><span class="line">// ä¹‹å‰</span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"0"</span>&gt;</span>0<span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"1"</span>&gt;</span>1<span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// ä¹‹åæƒ…å†µ1 æ–°å¢èŠ‚ç‚¹</span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"0"</span>&gt;</span>0<span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"1"</span>&gt;</span>1<span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"2"</span>&gt;</span>2<span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// ä¹‹åæƒ…å†µ2 åˆ é™¤èŠ‚ç‚¹</span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"1"</span>&gt;</span>1<span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><p>èŠ‚ç‚¹ä½ç½®å˜åŒ–</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// æƒ…å†µ3 èŠ‚ç‚¹ä½ç½®å˜åŒ–</span><br><span class="line"></span><br><span class="line">// ä¹‹å‰</span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"0"</span>&gt;</span>0<span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"1"</span>&gt;</span>1<span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// ä¹‹å</span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"1"</span>&gt;</span>1<span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"0"</span>&gt;</span>0<span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><p>åŒä¸€æ¬¡åŒçº§å¤šä¸ªå…ƒç´ çš„Diffï¼Œä¸€å®šå±äºä»¥ä¸Šä¸‰ç§æƒ…å†µä¸­çš„ä¸€ç§æˆ–å¤šç§ã€‚</p><p>è¯¥å¦‚ä½•è®¾è®¡ç®—æ³•å‘¢</p><p>é¦–å…ˆæƒ³åˆ°çš„æ˜¯æ–¹æ¡ˆæ˜¯ï¼š</p><ol><li>åˆ¤æ–­å½“å‰èŠ‚ç‚¹çš„æ›´æ–°å±äºå“ªç§æƒ…å†µ</li><li>å¦‚æœæ˜¯æ–°å¢ï¼Œæ‰§è¡Œæ–°å¢é€»è¾‘</li><li>å¦‚æœæ˜¯åˆ é™¤ï¼Œæ‰§è¡Œåˆ é™¤é€»è¾‘</li><li>å¦‚æœæ˜¯æ›´æ–°ï¼Œæ‰§è¡Œæ›´æ–°é€»è¾‘</li></ol><p>æŒ‰è¿™ä¸ªæ–¹æ¡ˆï¼Œå…¶å®æœ‰ä¸ªéšå«çš„å‰æï¼Œä¸Šè¿°<strong>ä¸åŒæ“ä½œçš„ä¼˜å…ˆçº§æ˜¯ç›¸åŒçš„</strong></p><p>ä½†Reactå›¢é˜Ÿå‘ç°ï¼Œåœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œç›¸å¯¹äºå¢åŠ å’Œåˆ é™¤ï¼Œæ›´æ–°ç»„ä»¶å‘ç”Ÿçš„é¢‘ç‡æ›´é«˜ã€‚æ‰€ä»¥React Diffä¼šä¼˜å…ˆåˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦å±äºæ›´æ–°ã€‚</p><p>è™½ç„¶æœ¬æ¬¡æ›´æ–°çš„JSXå¯¹è±¡<code>newChildren</code>ä¸ºæ•°ç»„å½¢å¼ï¼Œä½†æ˜¯å’Œ<code>newChildren</code>ä¸­æ¯ä¸ªå€¼è¿›è¡Œæ¯”è¾ƒçš„æ˜¯ä¸Šæ¬¡æ›´æ–°çš„FiberèŠ‚ç‚¹ï¼ŒFiberèŠ‚ç‚¹çš„åŒçº§èŠ‚ç‚¹æ˜¯ç”±siblingï¼ˆå…„å¼ŸèŠ‚ç‚¹ï¼‰æŒ‡é’ˆé“¾æ¥å½¢æˆçš„é“¾è¡¨ã€‚</p><p>å³ newChildren[0]ä¸oldFiberæ¯”è¾ƒï¼ŒnewChildren[1]ä¸oldFiber.siblingæ¯”è¾ƒã€‚</p><p><a href="https://blog.csdn.net/wyqwilliam/article/details/82717670" target="_blank" rel="noopener">å•é“¾è¡¨</a>æ— æ³•ä½¿ç”¨åŒæŒ‡é’ˆï¼Œæ‰€ä»¥æ— æ³•å¯¹ç®—æ³•ä½¿ç”¨åŒæŒ‡é’ˆä¼˜åŒ–ã€‚</p><p>åŸºäºä»¥ä¸ŠåŸå› ï¼ŒDiffç®—æ³•çš„æ•´ä½“é€»è¾‘ä¼šç»å†ä¸¤è½®éå†ã€‚</p><p>ç¬¬ä¸€è½®éå†ï¼šå¤„ç†æ›´æ–°çš„èŠ‚ç‚¹ã€‚</p><p>ç¬¬äºŒè½®éå†ï¼šå¤„ç†å‰©ä¸‹çš„ä¸å±äºæ›´æ–°çš„èŠ‚ç‚¹ã€‚</p><h4 id="ç¬¬ä¸€ééå†"><a href="#ç¬¬ä¸€ééå†" class="headerlink" title="ç¬¬ä¸€ééå†"></a><strong>ç¬¬ä¸€ééå†</strong></h4><ol><li>éå†newChildrenï¼Œi = 0ï¼Œå°†newChildren[i]ä¸oldFiberæ¯”è¾ƒï¼Œåˆ¤æ–­DOMèŠ‚ç‚¹æ˜¯å¦å¯å¤ç”¨ã€‚</li><li>å¦‚æœå¯å¤ç”¨ï¼Œi++ï¼Œæ¯”è¾ƒnewChildren[i]ä¸oldFiber.siblingæ˜¯å¦å¯å¤ç”¨ã€‚å¯ä»¥å¤ç”¨åˆ™é‡å¤æ­¥éª¤2ã€‚</li><li>å¦‚æœä¸å¯å¤ç”¨ï¼Œç«‹å³è·³å‡ºæ•´ä¸ªéå†ã€‚</li><li>å¦‚æœnewChildrenéå†å®Œæˆ–è€…oldFiberéå†å®Œï¼ˆå³oldFiber.sibling === nullï¼‰ï¼Œè·³å‡ºéå†ã€‚</li></ol><p>å½“æœ€ç»ˆå®Œæˆéå†åï¼Œä¼šæœ‰ä¸¤ç§ç»“æœï¼š</p><p>ç»“æœä¸€ï¼šå¦‚æœæ˜¯æ­¥éª¤3è·³å‡ºçš„éå†ï¼ŒnewChildrenæ²¡æœ‰éå†å®Œï¼ŒoldFiberä¹Ÿæ²¡æœ‰éå†å®Œã€‚</p><p>ä¸¾ä¸ªæ —å­ğŸŒ°</p><p>å¦‚ä¸‹ä»£ç ä¸­ï¼Œå‰2ä¸ªèŠ‚ç‚¹å¯å¤ç”¨ï¼Œkey === 2çš„èŠ‚ç‚¹typeæ”¹å˜ï¼Œä¸å¯å¤ç”¨ï¼Œè·³å‡ºéå†ã€‚</p><p>æ­¤æ—¶oldFiberå‰©ä¸‹key === 2æœªéå†ï¼ŒnewChildrenå‰©ä¸‹key === 2ã€key === 3æœªéå†ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// ä¹‹å‰</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"0"</span>&gt;</span>0<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"1"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"2"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// ä¹‹å</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"0"</span>&gt;</span>0<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"1"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">"2"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"3"</span>&gt;</span>3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç»“æœäºŒï¼šå¦‚æœæ˜¯æ­¥éª¤4è·³å‡ºçš„éå†ï¼Œå¯èƒ½newChildrenéå†å®Œï¼Œæˆ–oldFiberéå†å®Œï¼Œæˆ–ä»–ä»¬åŒæ—¶éå†å®Œã€‚</p><p>å†æ¥ä¸ªğŸŒ°</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// ä¹‹å‰</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"0"</span> <span class="attr">className</span>=<span class="string">"a"</span>&gt;</span>0<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"1"</span> <span class="attr">className</span>=<span class="string">"b"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// ä¹‹åæƒ…å†µ1 newChildrenä¸oldFiberéƒ½éå†å®Œ</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"0"</span> <span class="attr">className</span>=<span class="string">"aa"</span>&gt;</span>0<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"1"</span> <span class="attr">className</span>=<span class="string">"bb"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// ä¹‹åæƒ…å†µ2 newChildrenæ²¡éå†å®Œï¼ŒoldFiberéå†å®Œ</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"0"</span> <span class="attr">className</span>=<span class="string">"aa"</span>&gt;</span>0<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"1"</span> <span class="attr">className</span>=<span class="string">"bb"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"2"</span> <span class="attr">className</span>=<span class="string">"cc"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// ä¹‹åæƒ…å†µ3 newChildrenéå†å®Œï¼ŒoldFiberæ²¡éå†å®Œ</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">"0"</span> <span class="attr">className</span>=<span class="string">"aa"</span>&gt;</span>0<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ç¬¬äºŒè½®éå†"><a href="#ç¬¬äºŒè½®éå†" class="headerlink" title="ç¬¬äºŒè½®éå†"></a>ç¬¬äºŒè½®éå†</h4><p>å¯¹äºç»“æœäºŒï¼Œèªæ˜çš„ä½ æƒ³ä¸€æƒ³ğŸ¯ï¼ŒnewChildrenæ²¡éå†å®Œï¼ŒoldFiberéå†å®Œæ„å‘³ç€ä»€ä¹ˆï¼Ÿ</p><p>è€çš„DOMèŠ‚ç‚¹éƒ½å¤ç”¨äº†ï¼Œè¿™æ—¶è¿˜æœ‰æ–°åŠ å…¥çš„èŠ‚ç‚¹ï¼Œæ„å‘³ç€æœ¬æ¬¡æ›´æ–°æœ‰æ–°èŠ‚ç‚¹æ’å…¥ï¼Œæˆ‘ä»¬åªéœ€è¦éå†å‰©ä¸‹çš„newChildrenä¾æ¬¡æ‰§è¡Œæ’å…¥æ“ä½œ<a href="https://blog.csdn.net/qiwoo_weekly/article/details/106247621" target="_blank" rel="noopener">ï¼ˆFiber.effectTag = Placement;ï¼‰</a>ã€‚</p><blockquote><p><strong>effectTag</strong>å­—æ®µè¡¨ç¤ºå½“å‰<strong>Fiber</strong>éœ€è¦æ‰§è¡Œçš„å‰¯ä½œç”¨ï¼Œæœ€å¸¸è§çš„å‰¯ä½œç”¨æ˜¯ï¼š</p></blockquote><ul><li>Placement æ’å…¥DOMèŠ‚ç‚¹</li><li>Update æ›´æ–°DOMèŠ‚ç‚¹</li><li>Deletion åˆ é™¤DOMèŠ‚ç‚¹</li></ul><p>åŒæ ·çš„ï¼Œæˆ‘ä»¬ä¸¾ä¸€åä¸‰ã€‚newChildrenéå†å®Œï¼ŒoldFiberæ²¡éå†å®Œæ„å‘³ç€ä»€ä¹ˆï¼Ÿ</p><p>æ„å‘³ç€å¤šä½™çš„oldFiberåœ¨è¿™æ¬¡æ›´æ–°ä¸­å·²ç»ä¸å­˜åœ¨äº†ï¼Œæ‰€ä»¥éœ€è¦éå†å‰©ä¸‹çš„oldFiberï¼Œä¾æ¬¡æ‰§è¡Œåˆ é™¤æ“ä½œï¼ˆFiber.effectTag = Deletion;ï¼‰ã€‚</p><p>é‚£ä¹ˆç»“æœä¸€æ€ä¹ˆå¤„ç†å‘¢ï¼ŸnewChildrenä¸oldFiberéƒ½æ²¡éå†å®Œï¼Œè¿™æ„å‘³ç€æœ‰èŠ‚ç‚¹åœ¨è¿™æ¬¡æ›´æ–°ä¸­æ”¹å˜äº†ä½ç½®ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œå°±æ˜¯Diffç®—æ³•æœ€ç²¾é«“çš„éƒ¨åˆ†ï¼ï¼ï¼</p><h4 id="å¤„ç†ä½ç½®äº¤æ¢çš„èŠ‚ç‚¹"><a href="#å¤„ç†ä½ç½®äº¤æ¢çš„èŠ‚ç‚¹" class="headerlink" title="å¤„ç†ä½ç½®äº¤æ¢çš„èŠ‚ç‚¹"></a>å¤„ç†ä½ç½®äº¤æ¢çš„èŠ‚ç‚¹</h4><p>ä¸ºäº†å¿«é€Ÿçš„æ‰¾åˆ°keyå¯¹åº”çš„oldFiberï¼Œæˆ‘ä»¬å°†æ‰€æœ‰è¿˜æ²¡å¤„ç†çš„oldFiberæ”¾è¿›ä»¥keyå±æ€§ä¸ºkeyï¼ŒFiberä¸ºvalueçš„mapã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> existingChildren = mapRemainingChildren(returnFiber, oldFiber);</span><br></pre></td></tr></table></figure><p>æºç éƒ¨åˆ†<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapRemainingChildren</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    returnFiber: Fiber,</span></span></span><br><span class="line"><span class="function"><span class="params">    currentFirstChild: Fiber,</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>): <span class="title">Map</span>&lt;<span class="title">string</span> | <span class="title">number</span>, <span class="title">Fiber</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// Add the remaining children to a temporary map so that we can find them by</span></span><br><span class="line">    <span class="comment">// keys quickly. Implicit (null) keys get added to this set with their index</span></span><br><span class="line">    <span class="comment">// instead.</span></span><br><span class="line">    <span class="keyword">const</span> existingChildren: <span class="built_in">Map</span>&lt;string | number, Fiber&gt; = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> existingChild = currentFirstChild;</span><br><span class="line">    <span class="keyword">while</span> (existingChild !== <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (existingChild.key !== <span class="literal">null</span>) &#123;</span><br><span class="line">        existingChildren.set(existingChild.key, existingChild);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        existingChildren.set(existingChild.index, existingChild);</span><br><span class="line">      &#125;</span><br><span class="line">      existingChild = existingChild.sibling;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> existingChildren;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>å†éå†å‰©ä½™çš„newChildrenï¼Œé€šè¿‡newChildren[i].keyå°±èƒ½åœ¨existingChildrenä¸­æ‰¾åˆ°keyç›¸åŒçš„oldFiberã€‚</p><p>æ¥ä¸‹æ¥æ˜¯é‡ç‚¹å“¦ï¼Œæ•²é»‘æ¿ ğŸ‘¨â€ğŸ«</p><p>åœ¨æˆ‘ä»¬ç¬¬ä¸€è½®å’Œç¬¬äºŒè½®éå†ä¸­ï¼Œæˆ‘ä»¬é‡åˆ°çš„æ¯ä¸€ä¸ªå¯ä»¥å¤ç”¨çš„èŠ‚ç‚¹ï¼Œä¸€å®šå­˜åœ¨ä¸€ä¸ªä»£è¡¨ä¸Šä¸€æ¬¡æ›´æ–°æ—¶è¯¥èŠ‚ç‚¹çŠ¶æ€çš„oldFiberï¼Œå¹¶ä¸”é¡µé¢ä¸Šæœ‰ä¸€ä¸ªDOMå…ƒç´ ä¸å…¶å¯¹åº”ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬åœ¨Diffå‡½æ•°çš„å…¥å£å¤„ï¼Œå®šä¹‰ä¸€ä¸ªå˜é‡</p><p>ä¸Šç¯‡React diff ä¸­çš„LastIndex</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let lastPlacedIndex = 0;</span><br></pre></td></tr></table></figure><p>è¯¥å˜é‡è¡¨ç¤ºå½“å‰æœ€åä¸€ä¸ªå¯å¤ç”¨çš„èŠ‚ç‚¹ï¼Œå¯¹åº”çš„<code>oldFiber</code>åœ¨ä¸Šæ¬¡æ›´æ–°ä¸­çš„æ‰€åœ¨çš„ä½ç½®ç´¢å¼•ï¼Œæˆ‘ä»¬é€šè¿‡è¿™ä¸ªå˜é‡åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦éœ€è¦ç§»åŠ¨ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ç®€åŒ–ä¸€ä¸‹ä¹¦å†™ï¼Œæ¯ä¸ªå­—æ¯ä»£è¡¨ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå­—æ¯çš„å€¼ä»£è¡¨èŠ‚ç‚¹çš„key</p><p>// ä¹‹å‰<br>abcd</p><p>// ä¹‹å<br>acdb</p><table><thead><tr><th>index</th><th style="text-align:left">èŠ‚ç‚¹</th><th style="text-align:left">oldIndex</th><th style="text-align:left">lastIndex</th><th style="text-align:left">æ“ä½œ</th></tr></thead><tbody><tr><td>0</td><td style="text-align:left">B</td><td style="text-align:left">0</td><td style="text-align:left">0</td><td style="text-align:left">oldIndex(0)==lastIndex(0),ä¸åŠ¨</td></tr><tr><td>1</td><td style="text-align:left">c</td><td style="text-align:left">2</td><td style="text-align:left">2</td><td style="text-align:left">oldIndex(2)==lastIndex(2),ä¸åŠ¨</td></tr><tr><td>2</td><td style="text-align:left">d</td><td style="text-align:left">3</td><td style="text-align:left">3</td><td style="text-align:left">oldIndex(3)==lastIndex3),ä¸åŠ¨</td></tr><tr><td>3</td><td style="text-align:left">b</td><td style="text-align:left">1</td><td style="text-align:left">3</td><td style="text-align:left">oldIndex(1)&lt;lastIndex(3),èŠ‚ç‚¹bç§»åŠ¨è‡³index(3)çš„ä½ç½®</td></tr></tbody></table><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¹‹å‰</span></span><br><span class="line">abcd</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¹‹å</span></span><br><span class="line">acdb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">===ç¬¬ä¸€è½®éå†å¼€å§‹===</span><br><span class="line">aï¼ˆä¹‹åï¼‰vs aï¼ˆä¹‹å‰ï¼‰</span><br><span class="line">keyä¸å˜ï¼Œå¯å¤ç”¨</span><br><span class="line">æ­¤æ—¶ a å¯¹åº”çš„oldFiberï¼ˆä¹‹å‰çš„aï¼‰åœ¨ä¹‹å‰çš„æ•°ç»„ï¼ˆabcdï¼‰ä¸­ç´¢å¼•ä¸º<span class="number">0</span></span><br><span class="line">æ‰€ä»¥ lastPlacedIndex = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">ç»§ç»­ç¬¬ä¸€è½®éå†...</span><br><span class="line"></span><br><span class="line">cï¼ˆä¹‹åï¼‰vs bï¼ˆä¹‹å‰ï¼‰</span><br><span class="line">keyæ”¹å˜ï¼Œä¸èƒ½å¤ç”¨ï¼Œè·³å‡ºç¬¬ä¸€è½®éå†</span><br><span class="line">æ­¤æ—¶ lastPlacedIndex === <span class="number">0</span>;</span><br><span class="line">===ç¬¬ä¸€è½®éå†ç»“æŸ===</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">===ç¬¬äºŒè½®éå†å¼€å§‹===</span><br><span class="line"></span><br><span class="line">newChildren === cdbï¼Œæ²¡ç”¨å®Œï¼Œä¸éœ€è¦æ‰§è¡Œåˆ é™¤æ—§èŠ‚ç‚¹</span><br><span class="line">oldFiber === bcdï¼Œæ²¡ç”¨å®Œï¼Œä¸éœ€è¦æ‰§è¡Œæ’å…¥æ–°èŠ‚ç‚¹</span><br><span class="line"></span><br><span class="line">å°†å‰©ä½™oldFiberï¼ˆbcdï¼‰ä¿å­˜ä¸ºmap</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰oldFiberï¼šbcd</span></span><br><span class="line"><span class="comment">// å½“å‰newChildrenï¼šcdb</span></span><br><span class="line"></span><br><span class="line">ç»§ç»­éå†å‰©ä½™newChildren</span><br><span class="line"></span><br><span class="line">key === c åœ¨ oldFiberä¸­å­˜åœ¨</span><br><span class="line"><span class="keyword">const</span> oldIndex = cï¼ˆä¹‹å‰ï¼‰.index;</span><br><span class="line">å³ oldIndex ä»£è¡¨å½“å‰å¯å¤ç”¨èŠ‚ç‚¹ï¼ˆcï¼‰åœ¨ä¸Šä¸€æ¬¡æ›´æ–°æ—¶çš„ä½ç½®ç´¢å¼•</span><br><span class="line">æ­¤æ—¶ oldIndex === <span class="number">2</span>; <span class="comment">// ä¹‹å‰èŠ‚ç‚¹ä¸º abcdï¼Œæ‰€ä»¥c.index === 2</span></span><br><span class="line">æ¯”è¾ƒ oldIndex ä¸ lastPlacedIndex;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å¦‚æœ oldIndex &gt;= lastPlacedIndex ä»£è¡¨è¯¥å¯å¤ç”¨èŠ‚ç‚¹ä¸éœ€è¦ç§»åŠ¨</span><br><span class="line">å¹¶å°† lastPlacedIndex = oldIndex;</span><br><span class="line">å¦‚æœ oldIndex &lt; lastplacedIndex è¯¥å¯å¤ç”¨èŠ‚ç‚¹ä¹‹å‰æ’å…¥çš„ä½ç½®ç´¢å¼•å°äºè¿™æ¬¡æ›´æ–°éœ€è¦æ’å…¥çš„ä½ç½®ç´¢å¼•ï¼Œä»£è¡¨è¯¥èŠ‚ç‚¹éœ€è¦å‘å³ç§»åŠ¨</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">åœ¨ä¾‹å­ä¸­ï¼ŒoldIndex <span class="number">2</span> &gt; lastPlacedIndex <span class="number">0</span>ï¼Œ</span><br><span class="line">åˆ™ lastPlacedIndex = <span class="number">2</span>;</span><br><span class="line">cèŠ‚ç‚¹ä½ç½®ä¸å˜</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç»§ç»­éå†å‰©ä½™newChildren</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰oldFiberï¼šbd</span></span><br><span class="line"><span class="comment">// å½“å‰newChildrenï¼šdb</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key === d åœ¨ oldFiberä¸­å­˜åœ¨</span><br><span class="line"><span class="keyword">const</span> oldIndex = dï¼ˆä¹‹å‰ï¼‰.index;</span><br><span class="line"></span><br><span class="line">oldIndex <span class="number">3</span> &gt; lastPlacedIndex <span class="number">2</span> <span class="comment">// ä¹‹å‰èŠ‚ç‚¹ä¸º abcdï¼Œæ‰€ä»¥d.index === 3</span></span><br><span class="line">åˆ™ lastPlacedIndex = <span class="number">3</span>;</span><br><span class="line">dèŠ‚ç‚¹ä½ç½®ä¸å˜</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç»§ç»­éå†å‰©ä½™newChildren</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰oldFiberï¼šb</span></span><br><span class="line"><span class="comment">// å½“å‰newChildrenï¼šb</span></span><br><span class="line"></span><br><span class="line">key === b åœ¨ oldFiberä¸­å­˜åœ¨</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> oldIndex = bï¼ˆä¹‹å‰ï¼‰.index;</span><br><span class="line"></span><br><span class="line">oldIndex <span class="number">1</span> &lt; lastPlacedIndex <span class="number">3</span> <span class="comment">// ä¹‹å‰èŠ‚ç‚¹ä¸º abcdï¼Œæ‰€ä»¥b.index === 1</span></span><br><span class="line">åˆ™ bèŠ‚ç‚¹éœ€è¦å‘å³ç§»åŠ¨</span><br><span class="line">===ç¬¬äºŒè½®éå†ç»“æŸ===</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æœ€ç»ˆacd <span class="number">3</span>ä¸ªèŠ‚ç‚¹éƒ½æ²¡æœ‰ç§»åŠ¨ï¼ŒbèŠ‚ç‚¹è¢«æ ‡è®°ä¸ºç§»åŠ¨</span><br></pre></td></tr></table></figure><p>ç›¸ä¿¡ä½ å·²ç»æ˜ç™½äº†èŠ‚ç‚¹ç§»åŠ¨æ˜¯å¦‚ä½•åˆ¤æ–­çš„</p><p>å†æ¥çœ‹ä¸€ä¸ªä¾‹å­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// ä¹‹å‰abcd</span><br><span class="line">// ä¹‹ådabc</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">===ç¬¬ä¸€è½®éå†å¼€å§‹===</span><br><span class="line">dï¼ˆä¹‹åï¼‰vs aï¼ˆä¹‹å‰ï¼‰</span><br><span class="line">keyä¸å˜ï¼Œtypeæ”¹å˜ï¼Œä¸èƒ½å¤ç”¨ï¼Œè·³å‡ºéå†</span><br><span class="line">===ç¬¬ä¸€è½®éå†ç»“æŸ===</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">===ç¬¬äºŒè½®éå†å¼€å§‹===</span><br><span class="line">newChildren === dabcï¼Œæ²¡ç”¨å®Œï¼Œä¸éœ€è¦æ‰§è¡Œåˆ é™¤æ—§èŠ‚ç‚¹</span><br><span class="line">oldFiber === abcdï¼Œæ²¡ç”¨å®Œï¼Œä¸éœ€è¦æ‰§è¡Œæ’å…¥æ–°èŠ‚ç‚¹</span><br><span class="line"></span><br><span class="line">å°†å‰©ä½™oldFiberï¼ˆabcdï¼‰ä¿å­˜ä¸ºmap</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç»§ç»­éå†å‰©ä½™newChildren</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰oldFiberï¼šabcd</span></span><br><span class="line"><span class="comment">// å½“å‰newChildren dabc</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key === d åœ¨ oldFiberä¸­å­˜åœ¨</span><br><span class="line"><span class="keyword">const</span> oldIndex = dï¼ˆä¹‹å‰ï¼‰.index;</span><br><span class="line">æ­¤æ—¶ oldIndex === <span class="number">3</span>; <span class="comment">// ä¹‹å‰èŠ‚ç‚¹ä¸º abcdï¼Œæ‰€ä»¥d.index === 3</span></span><br><span class="line">æ¯”è¾ƒ oldIndex ä¸ lastPlacedIndex;</span><br><span class="line">oldIndex <span class="number">3</span> &gt; lastPlacedIndex <span class="number">0</span></span><br><span class="line">åˆ™ lastPlacedIndex = <span class="number">3</span>;</span><br><span class="line">dèŠ‚ç‚¹ä½ç½®ä¸å˜</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç»§ç»­éå†å‰©ä½™newChildren</span><br><span class="line"><span class="comment">// å½“å‰oldFiberï¼šabc</span></span><br><span class="line"><span class="comment">// å½“å‰newChildren abc</span></span><br><span class="line"></span><br><span class="line">key === a åœ¨ oldFiberä¸­å­˜åœ¨</span><br><span class="line"><span class="keyword">const</span> oldIndex = aï¼ˆä¹‹å‰ï¼‰.index; <span class="comment">// ä¹‹å‰èŠ‚ç‚¹ä¸º abcdï¼Œæ‰€ä»¥a.index === 0</span></span><br><span class="line">æ­¤æ—¶ oldIndex === <span class="number">0</span>;</span><br><span class="line">æ¯”è¾ƒ oldIndex ä¸ lastPlacedIndex;</span><br><span class="line">oldIndex <span class="number">0</span> &lt; lastPlacedIndex <span class="number">3</span></span><br><span class="line">åˆ™ aèŠ‚ç‚¹éœ€è¦å‘å³ç§»åŠ¨</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç»§ç»­éå†å‰©ä½™newChildren</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰oldFiberï¼šbc</span></span><br><span class="line"><span class="comment">// å½“å‰newChildren bc</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key === b åœ¨ oldFiberä¸­å­˜åœ¨</span><br><span class="line"><span class="keyword">const</span> oldIndex = bï¼ˆä¹‹å‰ï¼‰.index; <span class="comment">// ä¹‹å‰èŠ‚ç‚¹ä¸º abcdï¼Œæ‰€ä»¥b.index === 1</span></span><br><span class="line">æ­¤æ—¶ oldIndex === <span class="number">1</span>;</span><br><span class="line">æ¯”è¾ƒ oldIndex ä¸ lastPlacedIndex;</span><br><span class="line">oldIndex <span class="number">1</span> &lt; lastPlacedIndex <span class="number">3</span></span><br><span class="line">åˆ™ bèŠ‚ç‚¹éœ€è¦å‘å³ç§»åŠ¨</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç»§ç»­éå†å‰©ä½™newChildren</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰oldFiberï¼šc</span></span><br><span class="line"><span class="comment">// å½“å‰newChildren c</span></span><br><span class="line"></span><br><span class="line">key === c åœ¨ oldFiberä¸­å­˜åœ¨</span><br><span class="line"><span class="keyword">const</span> oldIndex = cï¼ˆä¹‹å‰ï¼‰.index; <span class="comment">// ä¹‹å‰èŠ‚ç‚¹ä¸º abcdï¼Œæ‰€ä»¥c.index === 2</span></span><br><span class="line">æ­¤æ—¶ oldIndex === <span class="number">2</span>;</span><br><span class="line">æ¯”è¾ƒ oldIndex ä¸ lastPlacedIndex;</span><br><span class="line">oldIndex <span class="number">2</span> &lt; lastPlacedIndex <span class="number">3</span></span><br><span class="line">åˆ™ cèŠ‚ç‚¹éœ€è¦å‘å³ç§»åŠ¨</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">===ç¬¬äºŒè½®éå†ç»“æŸ===</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä»¥ä¸ºä» abcd å˜ä¸º dabcï¼Œåªéœ€è¦å°†dç§»åŠ¨åˆ°å‰é¢ã€‚</p><p>ä½†å®é™…ä¸ŠReactä¿æŒdä¸å˜ï¼Œå°†abcåˆ†åˆ«ç§»åŠ¨åˆ°äº†dçš„åé¢ã€‚</p><p>ä»è¿™ç‚¹å¯ä»¥çœ‹å‡ºï¼Œè€ƒè™‘æ€§èƒ½ï¼Œæˆ‘ä»¬è¦å°½é‡å‡å°‘å°†èŠ‚ç‚¹ä»åé¢ç§»åŠ¨åˆ°å‰é¢çš„æ“ä½œã€‚</p><h4 id="æ³¨é‡Šè¿‡çš„Reactæºç "><a href="#æ³¨é‡Šè¿‡çš„Reactæºç " class="headerlink" title="æ³¨é‡Šè¿‡çš„Reactæºç "></a><a href="https://github.com/BetaSu/react-on-the-way/blob/master/packages/react-reconciler/ReactChildFiber.js#L265" target="_blank" rel="noopener">æ³¨é‡Šè¿‡çš„Reactæºç </a></h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// diffç®—æ³•ä¼šè¿›è¡Œä¸¤è½®éå†ï¼Œå¯èƒ½ä¸­é—´æœ‰ä¸­æ–­ï¼Œæ—¶é—´å¤æ‚åº¦O(n)</span></span><br><span class="line">  <span class="comment">// å¯å¤ç”¨èŠ‚ç‚¹çš„å‡ ç§æƒ…å†µï¼š</span></span><br><span class="line">  <span class="comment">// 1. ç›¸åŒkeyï¼ˆindexå¯ä»¥ä¸åŒï¼‰ç›¸åŒtype</span></span><br><span class="line">  <span class="comment">// 2. æ²¡æœ‰keyï¼Œç›¸åŒindexï¼Œç›¸åŒtype</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">reconcileChildrenArray</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">returnFiber, </span></span></span><br><span class="line"><span class="function"><span class="params"> currentFirstChild, </span></span></span><br><span class="line"><span class="function"><span class="params"> newChildren, </span></span></span><br><span class="line"><span class="function"><span class="params"> expirationTime   <span class="comment">// æœ€æ–°ç‰ˆæœ¬æ¢ä¸ºäº† lanes: Lanes,</span></span></span></span><br><span class="line"><span class="function"><span class="params">  </span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ç”±äºfiberæ²¡æœ‰ä¿å­˜beforeå¼•ç”¨ï¼Œæ‰€ä»¥æ— æ³•é€šè¿‡å¤´å°¾åŒæŒ‡é’ˆçš„æ–¹å¼ä¼˜åŒ–diffç®—æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// diffå®Œæˆåæ–°çš„ç¬¬ä¸€ä¸ªchild</span></span><br><span class="line">    <span class="keyword">let</span> resultingFirstChild = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">let</span> previousNewFiber = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// å¯å¤ç”¨èŠ‚ç‚¹çš„ä½ç½®å¯èƒ½å’Œä¸Šæ¬¡ä¸åŒï¼ˆéœ€è¦æ ‡è®°Placementä»£è¡¨ç§»åŠ¨ï¼‰ exï¼š abcd =&gt; badc</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥åˆ¤æ–­å®Œæ˜¯å¦å¯å¤ç”¨åè¿˜éœ€è¦æ¯”è¾ƒindexï¼Œå…·ä½“é€»è¾‘è§ placeChild</span></span><br><span class="line">    <span class="keyword">let</span> lastPlacedIndex = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// éå†åˆ°çš„newChild ç´¢å¼•</span></span><br><span class="line">    <span class="keyword">let</span> newIdx = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// éå†è¿‡ç¨‹ä¸­ç”¨äºæ¯”è¾ƒçš„è€fiber</span></span><br><span class="line">    <span class="keyword">let</span> oldFiber = currentFirstChild;</span><br><span class="line">    <span class="keyword">let</span> nextOldFiber = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬ä¸€è½®éå†ï¼Œå¯¹æ¯”oldFiberä¸newChildren[i]å¯»æ‰¾å¯ä»¥å¤ç”¨çš„fiberï¼Œå¯å¤ç”¨æ¡ä»¶ï¼š</span></span><br><span class="line">    <span class="comment">// 1. æ–°æ—§èŠ‚ç‚¹éƒ½ä¸ºæ–‡æœ¬èŠ‚ç‚¹ï¼Œç›´æ¥å¤ç”¨ï¼ˆæ–‡æœ¬èŠ‚ç‚¹æ²¡æœ‰keyï¼‰</span></span><br><span class="line">    <span class="comment">// 2. å…¶ä»–ç±»å‹èŠ‚ç‚¹åˆ¤æ–­keyæ˜¯å¦ç›¸åŒå†³å®šå¤ç”¨ï¼ˆå¯èƒ½keyç›¸åŒä½†æ˜¯ç±»å‹ä¸åŒï¼‰</span></span><br><span class="line">    <span class="comment">// è¿™æ¬¡éå†è¦æ±‚æ–°æ—§fiber keyç›¸åŒï¼Œé¡ºåºç›¸åŒï¼Œå¦‚æœé‡åˆ°ä¸æ»¡è¶³çš„åˆ™è·³å‡ºè¿™æ¬¡éå†</span></span><br><span class="line">    <span class="keyword">for</span> (; oldFiber !== <span class="literal">null</span> &amp;&amp; newIdx &lt; newChildren.length; newIdx++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (oldFiber.index &gt; newIdx) &#123;</span><br><span class="line">        <span class="comment">// fiber.index å§‹ç»ˆç­‰äºè¯¥fiberåœ¨æ•°ç»„ä¸­çš„ç´¢å¼•ï¼Œå³ä½¿å…¶å‰ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹æ˜¯null</span></span><br><span class="line">        <span class="comment">// exï¼š [null, a] ï¼Œ å…¶ä¸­ a.index === 1</span></span><br><span class="line">        <span class="comment">// ä¸Šæ¬¡çš„ç´¢å¼•å¤§äºè¿™æ¬¡ï¼Œä»£è¡¨ä¸Šæ¬¡è¿™ä¸ªèŠ‚ç‚¹ä¹‹å‰çš„å…„å¼ŸèŠ‚ç‚¹æœ‰null  exï¼š [null, a] </span></span><br><span class="line">        <span class="comment">// å‡è®¾è¿™æ¬¡æ˜¯ [b, a] ï¼Œåˆ™å®é™…ä¸Š diffçš„æ˜¯ null -&gt; b   a -&gt; a</span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥è¿™é‡Œè¿™ä¹ˆèµ‹å€¼</span></span><br><span class="line">        nextOldFiber = oldFiber;</span><br><span class="line">        oldFiber = <span class="literal">null</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        nextOldFiber = oldFiber.sibling;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// keyç›¸åŒåˆ™æ›´æ–°fiber</span></span><br><span class="line">      <span class="comment">//   æ›´æ–°åŒ…æ‹¬ å¤ç”¨fiberæˆ–è€…åˆ›å»ºæ–°fiber</span></span><br><span class="line">      <span class="comment">// keyä¸åŒåˆ™è¿”å›nullï¼Œä»£è¡¨è¯¥èŠ‚ç‚¹ä¸èƒ½å¤ç”¨</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// å°è¯•å¤ç”¨èŠ‚ç‚¹</span></span><br><span class="line">      <span class="keyword">const</span> newFiber = updateSlot(</span><br><span class="line">        returnFiber,</span><br><span class="line">        oldFiber,</span><br><span class="line">        newChildren[newIdx],</span><br><span class="line">        expirationTime</span><br><span class="line">      )</span><br><span class="line">      <span class="keyword">if</span> (newFiber === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// è¯¥ç´¢å¼•å¯¹åº”ä½ç½®çš„æ–°èŠ‚ç‚¹æ˜¯ null</span></span><br><span class="line">        <span class="keyword">if</span> (!oldFiber) &#123;</span><br><span class="line">          oldFiber = nextOldFiber;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (shouldTrackSideEffects) &#123;</span><br><span class="line">        <span class="keyword">if</span> (oldFiber &amp;&amp; !newFiber.alternate) &#123;</span><br><span class="line">          <span class="comment">// oldFiberä¸newFiberéƒ½å­˜åœ¨ä»£è¡¨å¯¹åº”ç´¢å¼•keyæ²¡å˜åŒ–</span></span><br><span class="line">          <span class="comment">// !newFiber.alternateä»£è¡¨newFiberæ˜¯æ–°åˆ›å»ºçš„fiber</span></span><br><span class="line">          <span class="comment">//   exï¼šoldFiber: &lt;div key="1"&gt;&lt;/div&gt; newFiber: &lt;p key="1"&gt;&lt;/p&gt;</span></span><br><span class="line">          <span class="comment">//   æ–°æ—§fiber keyç›¸åŒï¼Œåˆ™newFiberå­˜åœ¨ï¼Œä½†æ˜¯typeä¸åŒï¼Œæ‰€ä»¥æ˜¯åˆ›å»ºæ–°fiberï¼Œæ²¡æœ‰å¯¹åº”alternate</span></span><br><span class="line">          <span class="comment">// æ’å…¥æ–°DOMèŠ‚ç‚¹çš„åŒæ—¶åˆ æ‰è€çš„DOMèŠ‚ç‚¹</span></span><br><span class="line">          deleteChild(returnFiber, oldFiber);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// å°†å¯å¤ç”¨çš„æ–°fiberæ’å…¥ï¼Œè¿”å›æ’å…¥çš„ç´¢å¼•</span></span><br><span class="line">      lastPlacedIndex = placeChild(newFiber, lastPlacedIndex, newIdx);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!previousNewFiber) &#123;</span><br><span class="line">        <span class="comment">// è¿™æ˜¯ç¬¬ä¸€ä¸ªæ’å…¥çš„æ–°fiber</span></span><br><span class="line">        resultingFirstChild = newFiber;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        previousNewFiber.sibling = newFiber;</span><br><span class="line">      &#125;</span><br><span class="line">      previousNewFiber = newFiber;</span><br><span class="line">      oldFiber = nextOldFiber;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬äºŒè½®éå†æƒ…å†µ1 newChildrenéå†å®Œæ—¶</span></span><br><span class="line">    <span class="keyword">if</span> (newIdx === newChildren.length) &#123;</span><br><span class="line">      <span class="comment">// å½“newChildrenéå†å®Œæ—¶ï¼Œä»£è¡¨ç¬¬ä¸€è½®æ‰€æœ‰æ–°èŠ‚ç‚¹éƒ½å¯å¤ç”¨ï¼Œ</span></span><br><span class="line">      <span class="comment">// åªéœ€è¦åˆ é™¤å‰©ä¸‹çš„oldFiberï¼Œå› ä¸ºè¿™éƒ¨åˆ†oldFiberåœ¨æ–°çš„æ•°ç»„é‡Œå·²ç»ä¸å­˜åœ¨äº†</span></span><br><span class="line">      deleteRemainingChildren(returnFiber, oldFiber);</span><br><span class="line">      <span class="keyword">return</span> resultingFirstChild;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç¬¬äºŒè½®éå†æƒ…å†µ2 oldFiberéå†å®Œæ—¶</span></span><br><span class="line">    <span class="keyword">if</span> (!oldFiber) &#123;</span><br><span class="line">      <span class="comment">// å½“oldFiberéå†å®Œæ—¶ï¼Œä»£è¡¨æ‰€æœ‰oldFiberå·²ç»å¤ç”¨å®Œæˆ–è€…è¿™æ˜¯é¦–æ¬¡æ¸²æŸ“æ²¡æœ‰oldFiber</span></span><br><span class="line">      <span class="comment">// å†éå†newChildrenï¼ŒæŠŠæ–°èŠ‚ç‚¹appendåˆ°åé¢ï¼Œè¿™éƒ¨åˆ†åœ¨oldFiberä¸­ä¸å­˜åœ¨çš„èŠ‚ç‚¹æ˜¯æ–°åŠ å…¥çš„</span></span><br><span class="line">      <span class="keyword">for</span> (; newIdx &lt; newChildren.length; newIdx++) &#123;</span><br><span class="line">        <span class="keyword">const</span> newFiber = createChild(returnFiber, newChildren[newIdx], expirationTime);</span><br><span class="line">        <span class="keyword">if</span> (!newFiber) &#123;</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        lastPlacedIndex = placeChild(newFiber, lastPlacedIndex, newIdx);</span><br><span class="line">        <span class="keyword">if</span> (previousNewFiber === <span class="literal">null</span>) &#123;</span><br><span class="line">          resultingFirstChild = newFiber;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          previousNewFiber.sibling = newFiber;</span><br><span class="line">        &#125;</span><br><span class="line">        previousNewFiber = newFiber;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> resultingFirstChild;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¬¬äºŒè½®éå†æƒ…å†µ3 newChildrenï¼ŒoldFiberéƒ½æœªéå†å®Œ</span></span><br><span class="line">    <span class="comment">// å°†å¯å¤ç”¨çš„èŠ‚ç‚¹ç§»åŠ¨ä½ç½®</span></span><br><span class="line">    <span class="comment">// å°†æ‰€æœ‰æœªéå†çš„oldFiberå­˜å…¥mapï¼Œè¿™æ ·åœ¨æ¥ä¸‹æ¥çš„éå†ä¸­èƒ½O(1)çš„å¤æ‚åº¦å°±èƒ½é€šè¿‡keyæ‰¾åˆ°å¯¹åº”çš„oldFiber</span></span><br><span class="line">    <span class="keyword">const</span> existingChildren = mapRemainingChildren(returnFiber, oldFiber);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (; newIdx &lt; newChildren.length; newIdx++) &#123;</span><br><span class="line">      <span class="keyword">const</span> newFiber = updateFromMap(</span><br><span class="line">        existingChildren,</span><br><span class="line">        returnFiber,</span><br><span class="line">        newIdx,</span><br><span class="line">        newChildren[newIdx],</span><br><span class="line">        expirationTime</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">if</span> (newFiber) &#123;</span><br><span class="line">        <span class="keyword">if</span> (shouldTrackSideEffects) &#123;</span><br><span class="line">          <span class="keyword">if</span> (newFiber.alternate) &#123;</span><br><span class="line">            <span class="comment">// å­˜åœ¨currentï¼Œä»£è¡¨æˆ‘ä»¬éœ€è¦å¤ç”¨è¿™ä¸ªèŠ‚ç‚¹ï¼Œå°†å¯¹åº”oldFiberä»mapä¸­åˆ é™¤</span></span><br><span class="line">            <span class="comment">// è¿™æ ·è¯¥oldFiberå°±ä¸ä¼šç½®ä¸ºåˆ é™¤</span></span><br><span class="line">            existingChildren.delete(newFiber.key === <span class="literal">null</span> ? newIdx : newFiber.key);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        lastPlacedIndex = placeChild(newFiber, lastPlacedIndex, newIdx);</span><br><span class="line">        <span class="keyword">if</span> (!previousNewFiber) &#123;</span><br><span class="line">          resultingFirstChild = newFiber;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          previousNewFiber.sibling = newFiber;</span><br><span class="line">        &#125;</span><br><span class="line">        previousNewFiber = newFiber;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (shouldTrackSideEffects) &#123;</span><br><span class="line">      <span class="comment">// è¿˜ç•™ä¸‹çš„oldFiberè¡¨ç¤ºæ²¡æœ‰è¢«å¤ç”¨ï¼Œéœ€è¦åˆ é™¤</span></span><br><span class="line">      existingChildren.forEach(<span class="function"><span class="params">child</span> =&gt;</span> deleteChild(returnFiber, child));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> resultingFirstChild;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åè°ƒå­èŠ‚ç‚¹ï¼Œåˆ†ä¸º mount å’Œ reconcile 2ç±»</span></span><br><span class="line">  <span class="comment">// mountç”¨äºé¦–æ¬¡æ¸²æŸ“ï¼Œchildæ²¡æœ‰å¯¹åº”fiberï¼Œç›´æ¥ç”Ÿæˆfiberï¼Œmountä¸ä¼šæ”¹å˜fiberçš„effectTagï¼ŒåŸå› è§ appendAllChildren</span></span><br><span class="line">  <span class="comment">// reconcileç”¨äºæ›´æ–°</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">reconcileChildFibers</span>(<span class="params">returnFiber, currentFirstChild, newChild, expirationTime</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// React.createElementç±»å‹ æˆ–è€… å­èŠ‚ç‚¹æ˜¯Stringã€Numberå¯¹åº”çš„Arrayç±»å‹</span></span><br><span class="line">    <span class="keyword">const</span> isObject = <span class="keyword">typeof</span> newChild === <span class="string">'object'</span> &amp;&amp; newChild !== <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (isObject) &#123;</span><br><span class="line">      <span class="keyword">switch</span> (newChild.$$<span class="keyword">typeof</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> REACT_ELEMENT_TYPE:</span><br><span class="line">          <span class="keyword">return</span> placeSingleChild(reconcileSingleElement(</span><br><span class="line">            returnFiber,</span><br><span class="line">            currentFirstChild,</span><br><span class="line">            newChild,</span><br><span class="line">            expirationTime</span><br><span class="line">          ))</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// åœ¨ beginWork updateå„ç±»Componentæ—¶å¹¶æœªå¤„ç†HostTextï¼Œè¿™é‡Œå¤„ç†å•ä¸ªHostText</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> newChild === <span class="string">'number'</span> || <span class="keyword">typeof</span> newChild === <span class="string">'string'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> placeSingleChild(reconcileSingleTextNode(</span><br><span class="line">          returnFiber,</span><br><span class="line">          currentFirstChild,</span><br><span class="line">          newChild,</span><br><span class="line">          expirationTime</span><br><span class="line">        ))</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// åœ¨ beginWork updateå„ç±»Componentæ—¶å¹¶æœªå¤„ç†HostTextï¼Œè¿™é‡Œå¤„ç†å¤šä¸ªHostText</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(newChild)) &#123;</span><br><span class="line">        <span class="keyword">return</span> reconcileChildrenArray(</span><br><span class="line">          returnFiber,</span><br><span class="line">          currentFirstChild,</span><br><span class="line">          newChild,</span><br><span class="line">          expirationTime</span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å…œåº•åˆ é™¤</span></span><br><span class="line">    <span class="keyword">return</span> deleteRemainingChildren(returnFiber, currentFirstChild);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> reconcileChildFibers;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒå¤§ä½¬"><a href="#å‚è€ƒå¤§ä½¬" class="headerlink" title="å‚è€ƒå¤§ä½¬"></a>å‚è€ƒå¤§ä½¬</h2><ol><li><p>å¥‡èˆå‘¨åˆŠ. <a href="https://mp.weixin.qq.com/s/e0fDbM5pp9bX1YuYBSXhLA" target="_blank" rel="noopener">Reactæºç æ­ç§˜(ä¸‰)ï¼šDiffç®—æ³•è¯¦è§£</a></p></li><li><p><a href="https://github.com/BetaSu/react-on-the-way/blob/master/packages/react-reconciler/ReactChildFiber.js#L265" target="_blank" rel="noopener">https://github.com/BetaSu/react-on-the-way/blob/master/packages/react-reconciler/ReactChildFiber.js#L265</a></p></li><li><p><a href="https://blog.csdn.net/qiwoo_weekly/article/details/106247621" target="_blank" rel="noopener">https://blog.csdn.net/qiwoo_weekly/article/details/106247621</a></p></li><li><p><a href="https://juejin.im/post/5e9abf06e51d454702460bf6#heading-5" target="_blank" rel="noopener">https://juejin.im/post/5e9abf06e51d454702460bf6#heading-5</a></p></li><li><p><a href="https://juejin.im/post/5ec507146fb9a047f47cb805" target="_blank" rel="noopener">https://juejin.im/post/5ec507146fb9a047f47cb805</a> (åŸä½œè€…å¤§ä½¬)</p></li><li><p><a href="https://segmentfault.com/a/1190000018250127" target="_blank" rel="noopener">https://segmentfault.com/a/1190000018250127</a></p></li><li><p><a href="https://segmentfault.com/a/1190000018250127" target="_blank" rel="noopener">React Fiber åŸç†ä»‹ç»</a></p></li></ol>]]></content>
    
    <summary type="html">
    
      React diffç®€æ˜“æºç åŸç†æ¢ç©¶
    
    </summary>
    
      <category term="é»˜è®¤åˆ†ç±»" scheme="https://kitions.github.io/categories/%E9%BB%98%E8%AE%A4%E5%88%86%E7%B1%BB/"/>
    
    
      <category term="React" scheme="https://kitions.github.io/tags/React/"/>
    
      <category term="diff" scheme="https://kitions.github.io/tags/diff/"/>
    
  </entry>
  
  <entry>
    <title>React ä¸¤å¤§ç‰¹è‰²ä¹‹React diff</title>
    <link href="https://kitions.github.io/2020/05/18/React%20diff/"/>
    <id>https://kitions.github.io/2020/05/18/React diff/</id>
    <published>2020-05-18T10:51:45.000Z</published>
    <updated>2020-05-27T08:45:26.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="React-ä¸¤å¤§ç‰¹è‰²ä¹‹React-diff"><a href="#React-ä¸¤å¤§ç‰¹è‰²ä¹‹React-diff" class="headerlink" title="React ä¸¤å¤§ç‰¹è‰²ä¹‹React diff"></a>React ä¸¤å¤§ç‰¹è‰²ä¹‹React diff</h1><p>React çš„ä¸¤å¤§ç‰¹è‰²ï¼šReact diff å’Œ Virtual Domã€‚</p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>React diffï¼Œæ˜¯ Virtual DOMå’Œæ¸²æŸ“çš„æ€§èƒ½ä¿è¯ï¼Œé«˜æ•ˆçš„diffç®—æ³•æå¤§åœ°ä¿éšœäº†Reactçš„æ€§èƒ½ã€‚ä½¿æˆ‘ä»¬çš„é¡µé¢çš„æ„å»ºæ•ˆç‡æåˆ°äº†æå¤§çš„æå‡ã€‚</p><h2 id="ä¼ ç»Ÿçš„diffç®—æ³•"><a href="#ä¼ ç»Ÿçš„diffç®—æ³•" class="headerlink" title="ä¼ ç»Ÿçš„diffç®—æ³•"></a>ä¼ ç»Ÿçš„diffç®—æ³•</h2><p>ä¼ ç»Ÿdiffç®—æ³•é€šè¿‡å¾ªç¯é€’å½’å¯¹èŠ‚ç‚¹è¿›è¡Œä¾æ¬¡å¯¹æ¯”ï¼Œæ•ˆç‡ä½ä¸‹ï¼Œç®—æ³•å¤æ‚åº¦è¾¾åˆ° O(n^3)ï¼Œå…¶ä¸­ n æ˜¯æ ‘ä¸­èŠ‚ç‚¹çš„æ€»æ•°ã€‚å…·ä½“æ˜¯æ€ä¹ˆç®—å‡ºæ¥çš„ï¼Œå¯ä»¥æŸ¥çœ‹çŸ¥ä¹ä¸Šçš„ä¸€ä¸ªå›ç­”ã€‚</p><p><a href="https://www.zhihu.com/question/66851503" target="_blank" rel="noopener">reactçš„diff ä»O(n^3)åˆ° O(n) ï¼Œè¯·é—® O(n^3) å’ŒO(n) æ˜¯æ€ä¹ˆç®—å‡ºæ¥ï¼Ÿ</a></p><p>æ‡’å¾—ç‚¹é“¾æ¥çœ‹ä¸‹ï¼š</p><p>ä¼ ç»ŸDiffç®—æ³•éœ€è¦æ‰¾åˆ°ä¸¤ä¸ªæ ‘çš„æœ€å°æ›´æ–°æ–¹å¼ï¼Œæ‰€ä»¥éœ€è¦[ä¸¤ä¸¤]å¯¹æ¯”æ¯ä¸ªå¶å­èŠ‚ç‚¹æ˜¯å¦ç›¸åŒï¼Œå¯¹æ¯”å°±éœ€è¦O(n^2)æ¬¡äº†ï¼Œå†åŠ ä¸Šæ›´æ–°ï¼ˆç§»åŠ¨ã€åˆ›å»ºã€åˆ é™¤ï¼‰æ—¶éœ€è¦éå†ä¸€æ¬¡ï¼Œæ‰€ä»¥æ˜¯O(n^3)ã€‚</p><p>æŸ¥æ‰¾ä¸åŒå°±éœ€è¦O(n^2)ï¼Œæ‰¾åˆ°å·®å¼‚åè¿˜è¦è®¡ç®—æœ€å°è½¬æ¢æ–¹å¼ï¼Œæœ€ç»ˆç»“æœä¸ºO(n^3)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Prev                  Last</span><br><span class="line">       A                     A  </span><br><span class="line">      / \                   / \</span><br><span class="line">     /   \                 /   \</span><br><span class="line">    B     D     ====&gt;     D     B</span><br><span class="line">   /                             \</span><br><span class="line">  C                               C</span><br></pre></td></tr></table></figure><p>å°±ä¸Šé¢ä¸¤æ ‘çš„å˜åŒ–è€Œè¨€ï¼Œè‹¥è¦è¾¾åˆ°æœ€å°æ›´æ–°ï¼Œé¦–å…ˆè¦å¯¹æ¯”æ¯ä¸ªèŠ‚ç‚¹æ˜¯å¦ç›¸åŒï¼Œä¹Ÿå°±æ˜¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PA-&gt;LA</span><br><span class="line">PA-&gt;LB</span><br><span class="line">PA-&gt;LC</span><br><span class="line">PA-&gt;LD</span><br><span class="line">PB-&gt;LA</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>Reactçš„Diffç®—æ³•å®Œå…¨ä¸åŒï¼Œç®€å•åˆ°æœ‰äº›ç²—æš´ï¼Œè¿‡ç¨‹å¦‚ä¸‹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># æŒ‰å¶å­èŠ‚ç‚¹ä½ç½®æ¯”è¾ƒ</span><br><span class="line">[0,0]     :     PA-&gt;LA   # ç›¸åŒï¼Œä¸ç†ä¼š</span><br><span class="line">[0.0, 0.0]:     PB-&gt;LD   # ä¸åŒï¼Œåˆ é™¤PBï¼Œæ·»åŠ LD</span><br><span class="line">[0.1, 0.1]:     PD-&gt;LB   # ä¸åŒï¼Œæ›´æ–°</span><br><span class="line">[0.1.0, 0.1.0]: PC-&gt;Null # Lastæ ‘æ²¡æœ‰è¯¥èŠ‚ç‚¹ï¼Œæ‰€ä»¥åˆ é™¤PCå³å¯</span><br><span class="line">[0.1.2, 0.1.2]: Null-&gt;LC # Prevæ ‘æ²¡æœ‰è¯¥èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ·»åŠ Cåˆ°è¯¥ä½ç½®</span><br></pre></td></tr></table></figure><p>æ ‡å‡†çš„O(n)ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹åªéå†ä¸€æ¬¡ã€‚</p><p>O(n^3)åˆ°O(n)çš„æå‡æœ‰å¤šå¤§ï¼Œé€šè¿‡ä¸€å¼ å›¾æ¥çœ‹ä¸€ä¸‹</p><p><img src="https://i.loli.net/2020/05/13/qGAO7U2kXWx3eiu.png" alt="image.png" style="zoom:50%;"></p><h2 id="Reactçš„diffç­–ç•¥"><a href="#Reactçš„diffç­–ç•¥" class="headerlink" title="Reactçš„diffç­–ç•¥"></a>Reactçš„diffç­–ç•¥</h2><ol><li><p>ç­–ç•¥ä¸€ï¼šå¿½ç•¥Web UIä¸­DOMèŠ‚ç‚¹è·¨å±‚çº§ç§»åŠ¨ï¼›ï¼ˆè·¨å±‚çº§ä¸è¿›è¡Œæ¯”è¾ƒï¼‰</p></li><li><p>ç­–ç•¥äºŒï¼šæ‹¥æœ‰ç›¸åŒç±»å‹çš„ä¸¤ä¸ªç»„ä»¶äº§ç”Ÿçš„DOMç»“æ„ä¹Ÿæ˜¯ç›¸ä¼¼çš„ï¼Œä¸åŒç±»å‹çš„ä¸¤ä¸ªç»„ä»¶äº§ç”Ÿçš„DOMç»“æ„åˆ™ä¸è¿‘ç›¸åŒï¼ˆä¸åŒç±»ä¸è¿›è¡Œæ¯”è¾ƒï¼ŒåŒçº§èŠ‚ç‚¹åšdiffï¼‰</p></li><li><p>ç­–ç•¥ä¸‰ï¼šå¯¹äºåŒä¸€å±‚çº§çš„ä¸€ç»„å­èŠ‚ç‚¹ï¼Œé€šè¿‡åˆ†é…å”¯ä¸€idè¿›è¡ŒåŒºåˆ†ï¼ˆåŒç±»åŒçº§é€šè¿‡keyæ¯”è¾ƒï¼‰</p></li></ol><p>ä¸Šé¢çš„å¥½åƒä¸å¤ªé€šä¿—æ˜“æ‡‚</p><ol><li>ä¸€ï¼šåªå¯¹åŒçº§å…ƒç´ è¿›è¡ŒDiffã€‚å¦‚æœä¸€ä¸ªDOMèŠ‚ç‚¹åœ¨å‰åä¸¤æ¬¡æ›´æ–°ä¸­è·¨è¶Šäº†å±‚çº§ï¼Œé‚£ä¹ˆReactä¸ä¼šå¤ç”¨å®ƒã€‚</li><li>äºŒï¼šä¸¤ä¸ªä¸åŒç±»å‹çš„å…ƒç´ ä¼šäº§ç”Ÿå‡ºä¸åŒçš„æ ‘ã€‚å¦‚æœå…ƒç´ ç”±divå˜ä¸ºpï¼ŒReactä¼šé”€æ¯divåŠå…¶å­å­™èŠ‚ç‚¹ï¼Œå¹¶æ–°å»ºpåŠå…¶å­å­™èŠ‚ç‚¹ã€‚</li><li>ä¸‰ï¼šå¼€å‘è€…å¯ä»¥é€šè¿‡ keyå±æ€§ æ¥æš—ç¤ºå“ªäº›å­å…ƒç´ åœ¨ä¸åŒçš„æ¸²æŸ“ä¸‹èƒ½ä¿æŒç¨³å®šã€‚</li></ol><p>åœ¨Web UIçš„åœºæ™¯ä¸‹ï¼ŒåŸºäºä»¥ä¸Šä¸‰ä¸ªç‚¹ï¼ŒReactå¯¹tree diffã€component diffã€element diffè¿›è¡Œä¼˜åŒ–ï¼Œå°†æ™®é€‚diffçš„å¤æ‚åº¦é™ä½åˆ°ä¸€ä¸ªæ•°é‡çº§ï¼Œä¿è¯äº†æ•´ä½“UIç•Œé¢çš„æ„å»ºæ€§èƒ½ï¼</p><h3 id="Tree-diff"><a href="#Tree-diff" class="headerlink" title="Tree diff"></a>Tree diff</h3><hr><p>é’ˆå¯¹ç­–ç•¥ä¸€ï¼ŒReactå¯¹æ ‘çš„ç®—æ³•è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¯¹æ ‘è¿›è¡Œåˆ†å±‚æ¯”è¾ƒï¼Œä¸¤æ£µæ ‘åªä¼šå¯¹åŒä¸€å±‚æ¬¡çš„èŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒã€‚</p><p>æ—¢ç„¶DOMèŠ‚ç‚¹è·¨å±‚çº§çš„ç§»åŠ¨æ“ä½œå°‘åˆ°å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œé’ˆå¯¹è¿™ä¸€ç°è±¡ï¼ŒReactåªä¼šå¯¹ç›¸åŒå±‚çº§çš„DOMèŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒï¼Œå³åŒä¸€ä¸ªçˆ¶èŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹ã€‚å½“å‘ç°èŠ‚ç‚¹å·²ç»ä¸å­˜åœ¨æ—¶ï¼Œåˆ™è¯¥èŠ‚ç‚¹åŠå…¶å­èŠ‚ç‚¹ä¼šè¢«å®Œå…¨åˆ é™¤æ‰ï¼Œä¸ä¼šè¿›è¡Œä¸‹ä¸€æ­¥çš„æ¯”è¾ƒã€‚è¿™æ ·å°±åªéœ€è¦å¯¹æ ‘è¿›è¡Œä¸€æ¬¡éå†ï¼Œå°±èƒ½å®Œæˆæ•´ä¸ªDOMæ ‘çš„æ¯”è¾ƒã€‚</p><p><img src="https://i.loli.net/2020/05/14/iZWFCyOxuRKn52G.png" alt="image.png"></p><p>å‰ææ˜¯WEB ui ä¸­çš„DOMèŠ‚ç‚¹è·¨å±‚çº§çš„ç§»åŠ¨æ“ä½œç‰¹åˆ«å°‘ï¼Œä½†å¹¶æ²¡æœ‰å¦å®šDOMèŠ‚ç‚¹è·¨å±‚çº§çš„æ“ä½œçš„å­˜åœ¨ï¼Œé‚£ä¹ˆå½“é‡åˆ°è¿™ç§æ“ä½œæ—¶ï¼ŒReactçš„å¤„ç†æ–¹å¼</p><p>exampleï¼› A(åŒ…æ‹¬å…¶å­èŠ‚ç‚¹) â€“&gt; D</p><p><img src="https://i.loli.net/2020/05/14/Avw4XQcBJDCFMf8.png" alt="image.png"></p><p>ç”±äºReactåªä¼šç®€å•çš„è€ƒè™‘åŒå±‚çº§èŠ‚ç‚¹çš„ä½ç½®å˜æ¢ï¼Œè€Œå¯¹äºä¸åŒå±‚çº§çš„èŠ‚ç‚¹ï¼Œåªä¼šåˆ›å»ºå’Œåˆ é™¤æ“ä½œã€‚å½“æ ¹èŠ‚ç‚¹å‘ç°å­èŠ‚ç‚¹çš„Aæ¶ˆå¤±äº†ï¼Œå°±ä¼šç›´æ¥é”€æ¯Aï¼Œå½“Då‘ç°å¤šäº†ä¸€ä¸ªå­èŠ‚ç‚¹Aï¼Œåˆ™ä¼šåˆ›å»ºæ–°çš„A(åŒ…æ‹¬å­èŠ‚ç‚¹)ä½œä¸ºå…¶å­èŠ‚ç‚¹ã€‚æ­¤æ—¶ï¼Œdiffçš„æ‰§è¡Œæƒ…å†µæ˜¯ï¼›</p><p>â€‹                        CreateA â€”&gt;   CreateB â€”&gt;   CreateC â€”&gt;   DeleteA </p><p>  æ‰€ä»¥ï¼Œç”±æ­¤å¯ä»¥çœ‹å‡ºï¼Œå½“å‡ºç°èŠ‚ç‚¹è·¨å±‚çº§ç§»åŠ¨ï¼Œå¹¶ä¸ä¼šå‡ºç°æƒ³è±¡ä¸­çš„ç›´æ¥æŠŠæ•´ä¸ªAèŠ‚ç‚¹ç§»åŠ¨åˆ°DèŠ‚ç‚¹ä¸‹çš„ç§»åŠ¨æ“ä½œï¼Œè€Œæ˜¯ä»¥AèŠ‚ç‚¹çš„æ•´ä¸ªæ ‘ä¼šè¢«é‡æ–°åˆ›å»ºã€‚soï¼Œè¿™æ˜¯ä¸€ç§å½±å“Reactæ€§èƒ½çš„æ“ä½œï¼Œå› æ­¤å®˜æ–¹å»ºè®®ä¸è¦è¿›è¡ŒDOMèŠ‚ç‚¹è·¨å±‚çº§çš„æ“ä½œã€‚</p><blockquote><p>åœ¨å¼€å‘ç»„ä»¶æ—¶ï¼Œä¿æŒç¨³å®šçš„ DOM ç»“æ„ä¼šæœ‰åŠ©äºæ€§èƒ½çš„æå‡ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡ CSS éšè—æˆ–æ˜¾ç¤ºèŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯çœŸæ­£åœ°ç§»é™¤æˆ–æ·»åŠ  DOM èŠ‚ç‚¹ã€‚</p></blockquote><p>å›¾æ•´ä¸ªå¤„ç†è¿‡ç¨‹ï¼š</p><p><img src="https://i.loli.net/2020/05/14/GCazVwlI52WcSxd.png" alt="image.png"></p><h3 id="Component-diff"><a href="#Component-diff" class="headerlink" title="Component diff"></a>Component diff</h3><hr><p>React æ˜¯åŸºäºç»„ä»¶æ„å»ºåº”ç”¨çš„ï¼Œå¯¹äºç»„ä»¶é—´çš„æ¯”è¾ƒæ‰€é‡‡å–çš„ç­–ç•¥ä¹Ÿæ˜¯ç®€æ´ã€é«˜æ•ˆçš„ã€‚</p><ol><li><p><strong>å¦‚æœæ˜¯åŒä¸€ç±»å‹çš„ç»„ä»¶ï¼ŒæŒ‰ç…§åŸç­–ç•¥ç»§ç»­æ¯”è¾ƒ Virtual DOM æ ‘å³å¯ã€‚</strong></p></li><li><p><strong>å¦‚æœä¸æ˜¯ï¼Œåˆ™å°†è¯¥ç»„ä»¶åˆ¤å®šä¸ºdirty componentï¼Œä»è€Œæ›¿æ¢æ•´ä¸ªç»„ä»¶ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹</strong></p></li><li><p><strong>å¯¹äºåŒä¸€ç±»å‹çš„ç»„ä»¶ï¼Œæœ‰å¯èƒ½å…¶Virtual DOMæ²¡æœ‰ä»»ä½•å˜åŒ–ï¼Œå¦‚æœèƒ½å¤Ÿç¡®åˆ‡çŸ¥é“è¿™ç‚¹ï¼Œé‚£ä¹ˆå¯ä»¥èŠ‚çœå¤§é‡çš„diffè¿ç®—æ—¶é—´ï¼Œå› æ­¤ï¼ŒReactå…è®¸ç”¨æˆ·é€šè¿‡ShouldComponentUpdate()æ¥åˆ¤æ–­è¯¥ç»„ä»¶æ˜¯å¦éœ€è¦è¿›è¡Œdiffç®—æ³•ï¼Œä½†å¦‚æœè°ƒç”¨äº†forceUpdateæ–¹æ³•ï¼ŒShouldComponentUpdateä¼šå¤±æ•ˆ</strong></p><p>exampleï¼› D â€“&gt; G</p></li></ol><p><img src="https://i.loli.net/2020/05/13/juDeNmIx9zRHGE1.png" alt="image.png"></p><p>å†…éƒ¨æµç¨‹</p><p><img src="https://i.loli.net/2020/05/18/tGXixoF8fMYVhDa.png" alt="image.png"></p><p>å½“ç»„ä»¶Då˜ä¸ºç»„ä»¶Gæ—¶,å³ä½¿è¿™ä¸¤ä¸ªç»„ä»¶çš„ç»“æ„ç›¸ä¼¼,ä¸€æ—¦Reactåˆ¤æ–­Då’ŒGæ˜¯ä¸åŒç±»å‹çš„ç»„ä»¶ï¼Œå°±ä¸ä¼šæ¯”è¾ƒäºŒè€…çš„ç»“æ„ï¼Œè€Œæ˜¯ç›´æ¥åˆ é™¤ç»„ä»¶Dï¼Œé‡æ–°åˆ›å»ºç»„ä»¶GåŠå…¶å­èŠ‚ç‚¹ã€‚è™½ç„¶å½“ä¸¤ä¸ªç»„ä»¶æ—¶ä¸åŒç±»å‹ä½†ç»“æ„ç›¸ä¼¼æ—¶ï¼Œdiffä¼šå½±å“æ€§èƒ½ï¼Œä½†å…¥Reactå®˜æ–¹æ‰€è¯´ï¼Œä¸åŒç±»å‹çš„ç»„ä»¶å¾ˆå°‘å­˜åœ¨ç›¸ä¼¼DOMæ ‘çš„æƒ…å†µï¼Œå› æ­¤è¿™ç§æç«¯å› ç´ å¾ˆéš¾åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­é€ æˆè¾ƒå¤§çš„å½±å“ã€‚</p><h3 id="Element-diff"><a href="#Element-diff" class="headerlink" title="Element diff"></a>Element diff</h3><p>å½“èŠ‚ç‚¹å¤„äºåŒäºåŒä¸€å±‚çº§æ—¶å€™ï¼Œdiffæä¾›äº†3ç§èŠ‚ç‚¹æ“ä½œï¼Œåˆ†åˆ«æ˜¯æ’å…¥ã€ç§»åŠ¨ã€åˆ é™¤</p><ul><li>æ’å…¥ï¼šæ–°çš„ç»„ä»¶ç±»å‹ä¸åœ¨æ—§é›†åˆé‡Œï¼Œå³å…¨æ–°çš„èŠ‚ç‚¹ï¼Œéœ€è¦å¯¹æ–°èŠ‚ç‚¹æ‰§è¡Œæ’å…¥æ“ä½œ</li><li>ç§»åŠ¨ï¼šæ—§é›†åˆé‡Œæœ‰æ–°ç»„ä»¶ç±»å‹ï¼Œä¸”elementæ˜¯å¯æ›´æ–°çš„ç±»å‹ï¼Œè¿™ç§æƒ…å†µä¸‹ prevChild=nextChild ï¼Œå°±éœ€è¦åšç§»åŠ¨æ“ä½œï¼Œå¯ä»¥å¤ç”¨ä»¥å‰çš„ DOM èŠ‚ç‚¹ã€‚</li><li>åˆ é™¤ï¼šæ—§ç»„ä»¶ç±»å‹ï¼Œåœ¨æ–°é›†åˆé‡Œä¹Ÿæœ‰ï¼Œä½†å¯¹åº”çš„elementä¸åŒåˆ™ä¸èƒ½ç›´æ¥å¤ç”¨å’Œæ›´æ–°ï¼Œéœ€è¦æ‰§è¡Œåˆ é™¤æ“ä½œï¼Œæˆ–è€…æ—§ç»„ä»¶ä¸åœ¨æ–°é›†åˆé‡Œï¼Œä¹Ÿéœ€è¦æ‰§è¡Œåˆ é™¤æ“ä½œã€‚</li></ul><p><img src="https://i.loli.net/2020/05/18/SpXsxoKOGFJmEbj.png" style="zoom: 33%;"></p><p>æ—§é›†åˆä¸­åŒ…å«èŠ‚ç‚¹Aã€Bã€Cå’ŒDï¼Œ</p><p>æ›´æ–°åçš„æ–°é›†åˆä¸­åŒ…å«èŠ‚ç‚¹Bã€Aã€Då’ŒCï¼Œ</p><p>æ­¤æ—¶æ–°æ—§é›†åˆè¿›è¡Œdiffå·®å¼‚åŒ–å¯¹æ¯”ï¼Œå‘ç°B!=Aï¼Œåˆ™åˆ›å»ºå¹¶æ’å…¥Bè‡³æ–°é›†åˆï¼Œåˆ é™¤æ—§é›†åˆA;ä»¥æ­¤ç±»æ¨ï¼Œåˆ›å»ºå¹¶æ’å…¥Aã€Då’ŒCï¼Œåˆ é™¤Bã€Cå’ŒDã€‚</p><hr><p>æˆ‘ä»¬å‘ç°è¿™äº›éƒ½æ˜¯ç›¸åŒçš„èŠ‚ç‚¹ï¼Œä»…ä»…æ˜¯ä½ç½®å‘ç”Ÿäº†å˜åŒ–ï¼Œä½†å´éœ€è¦è¿›è¡Œç¹æ‚ä½æ•ˆçš„åˆ é™¤ã€åˆ›å»ºæ“ä½œï¼Œå…¶å®åªè¦å¯¹è¿™äº›èŠ‚ç‚¹è¿›è¡Œä½ç½®ç§»åŠ¨å³å¯ã€‚Reacté’ˆå¯¹è¿™ä¸€ç°è±¡æå‡ºäº†ä¸€ç§ä¼˜åŒ–ç­–ç•¥ï¼š<strong>è®©å¼€å‘è€…å¯¹åŒä¸€å±‚çº§çš„åŒç»„å­èŠ‚ç‚¹ï¼Œæ·»åŠ å”¯ä¸€keyè¿›è¡ŒåŒºåˆ†</strong>ã€‚è™½ç„¶è¿™åªæ˜¯å°å°çš„æ”¹åŠ¨ï¼Œæ€§èƒ½ä¸Šå´å‘ç”Ÿäº†ç¿»å¤©è¦†åœ°çš„å˜åŒ–ï¼Œå†æ¥çœ‹ä¸€ä¸‹åº”ç”¨äº†è¿™ä¸ªç­–ç•¥ä¹‹åï¼Œdiffæ˜¯å¦‚ä½•å¤„ç†çš„</p><p>example:</p><p><img src="https://i.loli.net/2020/05/18/AOauJGyqPtEoHNW.png" alt="image.png" style="zoom: 50%;"></p><p>é€šè¿‡keyå¯ä»¥å‡†ç¡®çš„å‘ç°æ–°æ—§é›†åˆä¸­çš„èŠ‚ç‚¹éƒ½æ˜¯ç›¸åŒçš„èŠ‚ç‚¹ï¼Œå› æ­¤æ— éœ€è¿›è¡ŒèŠ‚ç‚¹åˆ é™¤å’Œåˆ›å»ºï¼Œåªéœ€è¦å°†æ—§é›†åˆä¸­çš„ä½ç½®è¿›è¡Œç§»åŠ¨ï¼Œæ›´æ–°ä¸ºæ–°é›†åˆä¸­èŠ‚ç‚¹çš„ä½ç½®åè¯æ˜¯çš„Reactç»™å‡ºçš„diffç»“æœä¸ºï¼šBã€Dä¸åšä»»ä½•æ“ä½œï¼ŒAã€Cè¿›è¡Œç§»åŠ¨æ“ä½œå°±è¡Œã€‚</p><p>å…·ä½“çš„æµç¨‹çœ‹è¡¨æ ¼ï¼š</p><table><thead><tr><th>index</th><th style="text-align:left">èŠ‚ç‚¹</th><th style="text-align:left">oldIndex</th><th style="text-align:left">lastIndex</th><th style="text-align:left">æ“ä½œ</th></tr></thead><tbody><tr><td>0</td><td style="text-align:left">B</td><td style="text-align:left">1</td><td style="text-align:left">0</td><td style="text-align:left">oldIndex(1)&gt;lastIndex(0),lastIndex=oldIndexï¼ŒlastIndexå˜ä¸º1</td></tr><tr><td>1</td><td style="text-align:left">A</td><td style="text-align:left">0</td><td style="text-align:left">1</td><td style="text-align:left">oldIndex(0)&lt;lastIndex(1),èŠ‚ç‚¹Aç§»åŠ¨è‡³index(1)çš„ä½ç½®</td></tr><tr><td>2</td><td style="text-align:left">D</td><td style="text-align:left">3</td><td style="text-align:left">1</td><td style="text-align:left">oldIndex(3)&gt;lastIndex(1),lastIndex=oldIndexï¼ŒlastIndexå˜ä¸º3</td></tr><tr><td>3</td><td style="text-align:left">C</td><td style="text-align:left">2</td><td style="text-align:left">3</td><td style="text-align:left">oldIndex(2)&lt;lastIndex(3),èŠ‚ç‚¹Cç§»åŠ¨è‡³index(3)çš„ä½ç½®</td></tr></tbody></table><ul><li>indexï¼š æ–°é›†åˆçš„éå†ä¸‹æ ‡ã€‚</li><li>oldIndexï¼šå½“å‰èŠ‚ç‚¹åœ¨è€é›†åˆä¸­çš„ä¸‹æ ‡ã€‚</li><li>lastIndexï¼šåœ¨æ–°é›†åˆè®¿é—®è¿‡çš„èŠ‚ç‚¹ä¸­ï¼Œå…¶åœ¨è€é›†åˆçš„æœ€å¤§ä¸‹æ ‡å€¼(åœ¨è€é›†åˆä¸­æœ€å³çš„ä½ç½®, å³æœ€å¤§çš„ä½ç½®)ã€‚</li></ul><p>æ“ä½œä¸€æ ä¸­åªæ¯”è¾ƒoldIndexå’ŒlastIndexï¼š</p><ul><li><p>å½“oldIndex&gt;lastIndexæ—¶ï¼Œå°†oldIndexçš„å€¼èµ‹å€¼ç»™lastIndex</p></li><li><p>å½“oldIndex=lastIndexæ—¶ï¼Œä¸æ“ä½œ</p></li><li><p>å½“oldIndex&lt;lastIndexæ—¶ï¼Œå°†å½“å‰èŠ‚ç‚¹ç§»åŠ¨åˆ°indexçš„ä½ç½®ï¼Œ</p><p>æ–°ç‰ˆæœ¬Reactï¼Œåº”è¯¥æ˜¯ä»v16èµ·, placeChild(<em>newFiber</em>, <em>lastPlacedIndex</em>, <em>newIndex</em>), <em>lastPlacedIndex</em>å°±æ˜¯å½“å‰çš„æ–°fiberæ•°ç»„ä¸­å·²ç»éå†è¿‡çš„fiberä¸­åœ¨ä¸Šä¸€æ¬¡æ›´æ–°æ—¶çš„indexä¸­æœ€å¤§çš„é‚£ä¸ªï¼Œå°±æ˜¯ä¸Šé¢çš„lastIndex</p></li></ul><p>  <del>è€ç‰ˆæœ¬Reactæºç ä¸­çš„enqueueMove(this, child._mountIndex, toIndex)ï¼Œå…¶ä¸­ toIndex å…¶å®å°±æ˜¯ nextIndex</del></p><p>  <img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gf72uvqaenj30df0fdjtm.jpg" alt="image-20200527161523369"></p><hr><p>ä¸Šé¢ä¾‹å­æ˜¯æ–°æ—§é›†åˆä¸­çš„èŠ‚ç‚¹éƒ½æ˜¯ç›¸åŒçš„èŠ‚ç‚¹çš„æƒ…å†µä¸‹ï¼Œé‚£å¦‚æœæ–°é›†åˆä¸­æœ‰æ–°åŠ å…¥çš„èŠ‚ç‚¹ä¸”æ—§é›†åˆå­˜åœ¨ éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆ diff åˆæ˜¯å¦‚ä½•å¯¹æ¯”è¿ä½œçš„</p><p>ABCD â€“&gt; BECA</p><table><thead><tr><th>index</th><th style="text-align:left">èŠ‚ç‚¹</th><th style="text-align:left">oldIndex</th><th style="text-align:left">lastIndex</th><th style="text-align:left">æ“ä½œ</th></tr></thead><tbody><tr><td>0</td><td style="text-align:left">B</td><td style="text-align:left">1</td><td style="text-align:left">0</td><td style="text-align:left">oldIndex(1)&gt;lastIndex(0)ï¼ŒlastIndex=oldIndexï¼ŒlastIndexå˜ä¸º1</td></tr><tr><td>1</td><td style="text-align:left">E</td><td style="text-align:left">-</td><td style="text-align:left">1</td><td style="text-align:left">oldIndexä¸å­˜åœ¨ï¼Œæ·»åŠ èŠ‚ç‚¹Eè‡³index(1)çš„ä½ç½®</td></tr><tr><td>2</td><td style="text-align:left">C</td><td style="text-align:left">2</td><td style="text-align:left">1</td><td style="text-align:left">oldIndex(2)&gt;lastIndex(1),lastIndex=oldIndexï¼ŒlastIndexå˜ä¸º2</td></tr><tr><td>3</td><td style="text-align:left">A</td><td style="text-align:left">0</td><td style="text-align:left">2</td><td style="text-align:left">oldIndex(0)&lt;lastIndex(2),èŠ‚ç‚¹Aç§»åŠ¨è‡³index(3)çš„ä½ç½®</td></tr></tbody></table><blockquote><p>PSï¼šæœ€åè¿˜éœ€è¦å¯¹æ—§é›†åˆè¿›è¡Œå¾ªç¯éå†ï¼Œæ‰¾å‡ºæ–°é›†åˆä¸­æ²¡æœ‰çš„èŠ‚ç‚¹ï¼Œæ­¤æ—¶å‘ç°å­˜åœ¨è¿™æ ·çš„èŠ‚ç‚¹Dï¼Œå› æ­¤åˆ é™¤èŠ‚ç‚¹Dï¼Œåˆ°æ­¤ diff æ“ä½œå…¨éƒ¨å®Œæˆã€‚</p></blockquote><p>åŒæ ·æ“ä½œä¸€æ ä¸­åªæ¯”è¾ƒoldIndexå’ŒlastIndexï¼Œä½†æ˜¯oldIndexå¯èƒ½æœ‰ä¸å­˜åœ¨çš„æƒ…å†µï¼š</p><ul><li>oldIndexå­˜åœ¨<ol><li>å½“oldIndex&gt;lastIndexæ—¶ï¼Œå°†oldIndexçš„å€¼èµ‹å€¼ç»™lastIndex</li><li>å½“oldIndex=lastIndexæ—¶ï¼Œä¸æ“ä½œ</li><li>å½“oldIndex&lt;lastIndexæ—¶ï¼Œå°†å½“å‰èŠ‚ç‚¹ç§»åŠ¨åˆ°indexçš„ä½ç½®</li></ol></li><li><p>oldIndexä¸å­˜åœ¨</p><ol><li>æ–°å¢å½“å‰èŠ‚ç‚¹è‡³indexçš„ä½ç½®</li></ol><p><img src="https://i.loli.net/2020/05/18/r8vweGqTnVLUaic.png" alt="image.png"></p></li></ul><hr><p>å½“ç„¶è¿™ç§diffå¹¶éå®Œç¾æ— ç¼ºçš„ï¼Œæˆ‘ä»¬æ¥çœ‹è¿™ä¹ˆä¸€ç§æƒ…å†µï¼š</p><p><img src="https://i.loli.net/2020/05/18/WI7XbhK84QuJej5.png" alt="image.png"></p><p>å®é™…æˆ‘ä»¬åªéœ€å¯¹Dæ‰§è¡Œç§»åŠ¨æ“ä½œï¼Œç„¶è€Œç”±äºDåœ¨æ—§é›†åˆä¸­çš„ä½ç½®æ˜¯æœ€å¤§çš„ï¼Œå¯¼è‡´å…¶ä»–èŠ‚ç‚¹çš„oldIndex &lt; lastIndexï¼Œé€ æˆDæ²¡æœ‰æ‰§è¡Œç§»åŠ¨æ“ä½œï¼Œè€Œæ˜¯Aã€Bã€Cå…¨éƒ¨ç§»åŠ¨åˆ°DèŠ‚ç‚¹åé¢çš„ç°è±¡ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œå®˜æ–¹å»ºè®®ï¼š</p><blockquote><p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå°½é‡å‡å°‘ç±»ä¼¼å°†æœ€åä¸€ä¸ªèŠ‚ç‚¹ç§»åŠ¨åˆ°åˆ—è¡¨é¦–éƒ¨çš„æ“ä½œã€‚å½“èŠ‚ç‚¹æ•°é‡è¿‡å¤§æˆ–æ›´æ–°æ“ä½œè¿‡äºé¢‘ç¹æ—¶ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¼šå½±å“Reactçš„æ¸²æŸ“æ€§èƒ½</p></blockquote><p>ç”±äºkeyçš„å­˜åœ¨ï¼Œreactå¯ä»¥å‡†ç¡®åœ°åˆ¤æ–­å‡ºè¯¥èŠ‚ç‚¹åœ¨æ–°é›†åˆä¸­æ˜¯å¦å­˜åœ¨ï¼Œè¿™æå¤§åœ°æé«˜äº†diffæ•ˆç‡ã€‚æˆ‘ä»¬åœ¨å¼€å‘è¿‡ä¸­è¿›è¡Œåˆ—è¡¨æ¸²æŸ“çš„æ—¶å€™ï¼Œè‹¥æ²¡æœ‰åŠ keyï¼Œreactä¼šæŠ›å‡ºè­¦å‘Šè¦æ±‚å¼€å‘è€…åŠ ä¸Škeyï¼Œå°±æ˜¯ä¸ºäº†æé«˜diffæ•ˆç‡ã€‚</p><p>ä½†æ˜¯åŠ äº†keyä¸€å®šè¦æ¯”æ²¡åŠ keyçš„æ€§èƒ½æ›´é«˜å—ï¼Ÿæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">ç°åœ¨æœ‰ä¸€é›†åˆ[1,2,3,4,5],æ¸²æŸ“æˆå¦‚ä¸‹çš„æ ·å­ï¼š</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">---------------</span><br><span class="line">ç°åœ¨æˆ‘ä»¬å°†è¿™ä¸ªé›†åˆçš„é¡ºåºæ‰“ä¹±å˜æˆ[1,3,2,5,4]ã€‚</span><br><span class="line">1.åŠ key</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">'1'</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">'1'</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span>     </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">'2'</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">'3'</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">'3'</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  ========&gt;  <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">'2'</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">'4'</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">'5'</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">'5'</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">'4'</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line">æ“ä½œï¼šèŠ‚ç‚¹2ç§»åŠ¨è‡³ä¸‹æ ‡ä¸º2çš„ä½ç½®ï¼ŒèŠ‚ç‚¹4ç§»åŠ¨è‡³ä¸‹æ ‡ä¸º4çš„ä½ç½®ã€‚</span><br><span class="line"></span><br><span class="line">2.ä¸åŠ key</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span>     </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  ========&gt;  <span class="tag">&lt;<span class="name">div</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line">æ“ä½œï¼šä¿®æ”¹ç¬¬1ä¸ªåˆ°ç¬¬5ä¸ªèŠ‚ç‚¹çš„innerText</span><br><span class="line">---------------</span><br><span class="line">å¦‚æœæˆ‘ä»¬å¯¹è¿™ä¸ªé›†åˆè¿›è¡Œå¢åˆ çš„æ“ä½œæ”¹æˆ[1,3,2,5,6]ã€‚</span><br><span class="line">1.åŠ key</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">'1'</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">'1'</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span>     </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">'2'</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">'3'</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">'3'</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  ========&gt;  <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">'2'</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">'4'</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">'5'</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">'5'</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">'6'</span>&gt;</span>6<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line">æ“ä½œï¼šèŠ‚ç‚¹2ç§»åŠ¨è‡³ä¸‹æ ‡ä¸º2çš„ä½ç½®ï¼Œæ–°å¢èŠ‚ç‚¹6è‡³ä¸‹æ ‡ä¸º4çš„ä½ç½®ï¼Œåˆ é™¤èŠ‚ç‚¹4ã€‚</span><br><span class="line"></span><br><span class="line">2.ä¸åŠ key</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span>     </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  ========&gt;  <span class="tag">&lt;<span class="name">div</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span>             <span class="tag">&lt;<span class="name">div</span>&gt;</span>6<span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">æ“ä½œï¼šä¿®æ”¹ç¬¬1ä¸ªåˆ°ç¬¬5ä¸ªèŠ‚ç‚¹çš„innerText</span><br><span class="line">---------------</span><br><span class="line">é€šè¿‡ä¸Šé¢è¿™ä¸¤ä¸ªä¾‹å­æˆ‘ä»¬å‘ç°ï¼š</span><br><span class="line">ç”±äºdomèŠ‚ç‚¹çš„ç§»åŠ¨æ“ä½œå¼€é”€æ˜¯æ¯”è¾ƒæ˜‚è´µçš„ï¼Œæ²¡æœ‰keyçš„æƒ…å†µä¸‹è¦æ¯”æœ‰keyçš„æ€§èƒ½æ›´å¥½ã€‚</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬å‘ç°ï¼Œè™½ç„¶åŠ äº†keyæé«˜äº†diffæ•ˆç‡ï¼Œä½†æ˜¯æœªå¿…ä¸€å®šæå‡äº†é¡µé¢çš„æ€§èƒ½ã€‚å› æ­¤æˆ‘ä»¬è¦æ³¨æ„è¿™ä¹ˆä¸€ç‚¹ï¼š</p><blockquote><p>å¯¹äºç®€å•åˆ—è¡¨é¡µæ¸²æŸ“æ¥è¯´ï¼Œä¸åŠ keyè¦æ¯”åŠ äº†keyçš„æ€§èƒ½æ›´å¥½</p></blockquote><p>æ ¹æ®ä¸Šé¢çš„æƒ…å†µï¼Œæœ€åæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹keyçš„ä½œç”¨ï¼š</p><ul><li>å‡†ç¡®åˆ¤æ–­å‡ºå½“å‰èŠ‚ç‚¹æ˜¯å¦åœ¨æ—§é›†åˆä¸­</li><li>æå¤§åœ°å‡å°‘éå†æ¬¡æ•°</li></ul><h2 id="æ¸²æŸ“"><a href="#æ¸²æŸ“" class="headerlink" title="æ¸²æŸ“"></a>æ¸²æŸ“</h2><h4 id="åˆå¹¶æ“ä½œ"><a href="#åˆå¹¶æ“ä½œ" class="headerlink" title="åˆå¹¶æ“ä½œ"></a>åˆå¹¶æ“ä½œ</h4><p>å½“è°ƒç”¨componentçš„<code>setstate</code>æ—¶ï¼ŒReactä¼šå°†å…¶æ ‡è®°ä¸ºdirtyã€‚åˆ°æ¯ä¸ªæ—¶é—´å¾ªç¯ç»“æŸï¼ŒReactæ£€æŸ¥æ‰€æœ‰æ ‡è®°dirtyçš„componenté‡æ–°ç»˜åˆ¶</p><p>è¿™é‡Œçš„â€œåˆå¹¶æ“ä½œâ€æ˜¯è¯´ï¼Œåœ¨ä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¸­ï¼ŒDOMåªä¼šè¢«æ›´æ–°ä¸€æ¬¡ï¼Œè¿™ä¸ªç‰¹æ€§æ˜¯æ„å»ºé«˜æ€§èƒ½åº”ç”¨çš„å…³é”®ã€‚</p><p> <img src="https://i.loli.net/2020/05/14/b4J7ntmFZLOlaAK.png" alt=""></p><h4 id="å­æ ‘æ¸²æŸ“"><a href="#å­æ ‘æ¸²æŸ“" class="headerlink" title="å­æ ‘æ¸²æŸ“"></a>å­æ ‘æ¸²æŸ“</h4><p>è°ƒç”¨setStateæ–¹æ³•æ—¶ï¼Œcomponentä¼šé‡æ–°æ„å»ºåŒ…æ‹¬å­æ ‘å­èŠ‚ç‚¹çš„virtual DOM ã€‚å¦‚æœä½ åœ¨æ ¹èŠ‚ç‚¹è°ƒç”¨<code>setState</code>,æ•´ä¸ªReactåº”ç”¨éƒ½ä¼šè¢«é‡æ–°æ¸²æŸ“ã€‚æ‰€æœ‰çš„componentï¼Œå³ä¾¿æ²¡æœ‰æ›´æ–°ï¼Œéƒ½ä¼šè°ƒç”¨ä»–ä»¬çš„renderæ–¹æ³•ï¼Œè¿™ä¸ªå¬èµ·æ¥å¾ˆå¯æ€•ï¼Œæ€§èƒ½å®é™…ä¸Šå¾ˆä½ï¼Œä½†å®é™…ä¸Šæˆ‘ä»¬ä¸ä¼šè§¦åŠçœŸå®çš„DOMï¼Œè¿è¡Œèµ·æ¥å°±æ²¡é—®é¢˜ã€‚</p><p>åœ¨å†™reactä»£ç æ—¶ï¼Œæ¯å½“æ•°æ®æœ‰æ›´æ–°ï¼Œä½ éƒ½ä¸ä¼šç®—è°ƒç”¨æ ¹èŠ‚ç‚¹çš„<code>setState</code>ã€‚ä½ ä¼šåœ¨éœ€è¦æ¥æ”¶å¯¹åº”çš„componentä¸Šè°ƒç”¨ï¼Œæˆ–è€…åœ¨ä¸Šé¢çš„å‡ ä¸ªcomponentã€‚ä½ å¾ˆå°‘è¦ä¸€ç›´åˆ°æ ¹èŠ‚ç‚¹ã€‚å°±æ˜¯è¯´é¡µé¢æ›´æ–°åªå‡ºç°åœ¨ç”¨æˆ·äº¤äº’çš„éƒ¨åˆ†ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1geqli50hv8j30b005uweh.jpg" alt="img"></p><h4 id="é€‰æ‹©å­æ ‘æ¸²æŸ“"><a href="#é€‰æ‹©å­æ ‘æ¸²æŸ“" class="headerlink" title="é€‰æ‹©å­æ ‘æ¸²æŸ“"></a>é€‰æ‹©å­æ ‘æ¸²æŸ“</h4><p>å»æ‰ä¸€äº›å­æ ‘çš„é‡æ–°æ¸²æŸ“.</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">boolean</span> shouldComponentUpdate(object nextProps, object nextState)</span><br></pre></td></tr></table></figure><p>æ ¹æ®componentçš„å‰ä¸€ä¸ªå’Œä¸‹ä¸€ä¸ª<code>props/state</code>ï¼Œ ä½ å¯ä»¥å‘Šè¯‰Reactè¿™ä¸ªcomponentæ²¡æœ‰æ›´æ–°ï¼Œä¹Ÿä¸éœ€è¦é‡ç»˜</p><blockquote><p>æ³¨æ„, è¿™ä¸ªå‡½æ•°æ¯æ¬¡éƒ½ä¼šè¢«è°ƒç”¨, æ‰€ä»¥ä½ è¦ç¡®ä¿è¿è¡Œèµ·æ¥èŠ±çš„æ—¶é—´æ›´å°‘,<br>æ¯” React çš„åšæ³•æ—¶é—´å°‘, è¿˜æœ‰æ¯”è®¡ç®— component éœ€è¦çš„æ—¶é—´å°‘,<br>å³ä¾¿é‡æ–°ç»˜åˆ¶å¹¶ä¸æ˜¯å¿…è¦çš„.</p><p>Ps: ä¸è¿‡æœ‰å¯èƒ½ä½ çš„æ–¹æ³•é‡Œå†™çš„æ¯”ReactèŠ±è´¹çš„æ—¶é—´æ›´å¤š</p></blockquote><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1geqliamkyej30az05kglm.jpg" alt="img"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li><p>Reactçš„é«˜æ•ˆå¾—ç›ŠäºVIrtual DOM + React diffçš„ä½“ç³»ã€‚diffç®—æ³•å¹¶éReactç‹¬åˆ›ï¼Œreactåªæ˜¯åœ¨ä¼ ç»Ÿçš„diffç®—æ³•ä¸­åšäº†ä¼˜åŒ–ã€‚ä½†å› ä¸ºä¼˜åŒ–ï¼Œå°†diffç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸€ä¸‹ä»O(n^3) é™åˆ°äº† O(n)ã€‚</p></li><li><p>å¼€å‘ç»„ä»¶æ—¶ï¼Œä¿æŒç¨³å®šçš„domç»“æ„ä¼šæœ‰åŠ©äºæ€§èƒ½çš„æå‡ã€‚</p></li><li><p>å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå°½é‡å‡å°‘ç±»ä¼¼å°†æœ€åä¸€ä¸ªèŠ‚ç‚¹ç§»åŠ¨åˆ°åˆ—è¡¨é¦–éƒ¨çš„æ“ä½œã€‚</p></li><li><p>keyçš„å­˜åœ¨æ˜¯ä¸ºäº†æå‡diffæ•ˆç‡ï¼Œä½†æœªå¿…ä¸€å®šå°±å¯ä»¥æå‡æ€§èƒ½ï¼Œè®°ä½ç®€å•åˆ—è¡¨æ¸²æŸ“æƒ…å†µä¸‹ï¼Œä¸åŠ keyè¦æ¯”åŠ keyçš„æ€§èƒ½æ›´å¥½ã€‚ï¼ˆä¸è¿‡å¯èƒ½å› ä¸ºReact consoleçš„æé†’ï¼Œå¤§å®¶éƒ½ä¼šåŠ ä¸Šï¼Œä¸ªäººè§‰å¾—è¿™ç‚¹æ€§èƒ½é—®é¢˜ä¸å¤§ï¼‰ã€‚</p></li><li><p>æˆ‘ä»¬å¯ä»¥æ ¹æ®diffçš„ç‰¹ç‚¹ï¼Œåœ¨å…·ä½“åœºæ™¯ä¸­å–é•¿è¡¥çŸ­ï¼Œè§„é¿ä¸€äº›ç®—æ³•ä¸Šé¢çš„çŸ­æ¿ä¹Ÿæ˜¯æœ‰åˆ©äºæå‡åº”ç”¨æ•´ä½“çš„æ€§èƒ½ã€‚</p></li></ul><p>ä¹‹åå¯ä»¥ç®€å•å®ç°ä¸‹diff</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://blog.csdn.net/sexy_squirrel/java/article/details/79801940" target="_blank" rel="noopener">æµ…è°ˆReactä¸­çš„diff</a></p><p><a href="https://www.zhihu.com/question/66851503/answer/246766239" target="_blank" rel="noopener">reactçš„diff ä»O(n^3)åˆ° O(n) ï¼Œè¯·é—® O(n^3) å’ŒO(n) æ˜¯æ€ä¹ˆç®—å‡ºæ¥ï¼Ÿ</a></p><p><a href="https://zhuanlan.zhihu.com/p/20346379?refer=purerender" target="_blank" rel="noopener">React æºç å‰–æç³»åˆ— ï¼ ä¸å¯æ€è®®çš„ react diff</a></p><p><a href="https://juejin.im/post/5cb5b4926fb9a068b52fb823" target="_blank" rel="noopener">React diffåŸç†æ¢ç©¶ä»¥åŠåº”ç”¨å®è·µ</a></p><p><a href="https://juejin.im/post/5cb5b4926fb9a068b52fb823" target="_blank" rel="noopener">React Fiber åŸç†ä»‹ç»</a></p>]]></content>
    
    <summary type="html">
    
      React çš„ä¸¤å¤§ç‰¹è‰²ï¼šReact diff å’Œ Virtual Domã€‚React ä¸­æœ€å€¼å¾—ç§°é“çš„éƒ¨åˆ†è«è¿‡äº Virtual DOM ä¸ diff çš„å®Œç¾ç»“åˆï¼Œç‰¹åˆ«æ˜¯å…¶é«˜æ•ˆçš„ diff ç®—æ³•ï¼Œè®©ç”¨æˆ·å¯ä»¥æ— éœ€é¡¾å¿Œæ€§èƒ½é—®é¢˜è€Œâ€ä»»æ€§è‡ªç”±â€çš„åˆ·æ–°é¡µé¢ï¼Œè®©å¼€å‘è€…ä¹Ÿå¯ä»¥æ— éœ€å…³å¿ƒ Virtual DOM èƒŒåçš„è¿ä½œåŸç†ï¼Œå› ä¸º React diff ä¼šå¸®åŠ©æˆ‘ä»¬è®¡ç®—å‡º Virtual DOM ä¸­çœŸæ­£å˜åŒ–çš„éƒ¨åˆ†ï¼Œå¹¶åªé’ˆå¯¹è¯¥éƒ¨åˆ†è¿›è¡Œå®é™… DOM æ“ä½œï¼Œè€Œéé‡æ–°æ¸²æŸ“æ•´ä¸ªé¡µé¢ï¼Œä»è€Œä¿è¯äº†æ¯æ¬¡æ“ä½œæ›´æ–°åé¡µé¢çš„é«˜æ•ˆæ¸²æŸ“ï¼Œå› æ­¤ Virtual DOM ä¸ diff æ˜¯ä¿è¯ React æ€§èƒ½å£ç¢‘çš„å¹•åæ¨æ‰‹ã€‚
    
    </summary>
    
      <category term="é»˜è®¤åˆ†ç±»" scheme="https://kitions.github.io/categories/%E9%BB%98%E8%AE%A4%E5%88%86%E7%B1%BB/"/>
    
    
      <category term="React" scheme="https://kitions.github.io/tags/React/"/>
    
      <category term="diff" scheme="https://kitions.github.io/tags/diff/"/>
    
  </entry>
  
  <entry>
    <title>ç½‘æ˜“äº‘æ­Œå•è½¬ç§»åˆ°Apple Musicã€Spotifyç­‰æµéŸ³ä¹å¹³å°</title>
    <link href="https://kitions.github.io/2020/04/30/%E7%BD%91%E6%98%93%E4%BA%91%E8%BD%AC%E5%87%BA%E6%AD%8C%E5%8D%95/"/>
    <id>https://kitions.github.io/2020/04/30/ç½‘æ˜“äº‘è½¬å‡ºæ­Œå•/</id>
    <published>2020-04-30T02:13:33.000Z</published>
    <updated>2020-06-05T10:23:26.535Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç½‘æ˜“äº‘æ­Œå•è½¬ç§»åˆ°Apple-Musicã€Spotifyç­‰æµéŸ³ä¹å¹³å°"><a href="#ç½‘æ˜“äº‘æ­Œå•è½¬ç§»åˆ°Apple-Musicã€Spotifyç­‰æµéŸ³ä¹å¹³å°" class="headerlink" title="ç½‘æ˜“äº‘æ­Œå•è½¬ç§»åˆ°Apple Musicã€Spotifyç­‰æµéŸ³ä¹å¹³å°"></a>ç½‘æ˜“äº‘æ­Œå•è½¬ç§»åˆ°Apple Musicã€Spotifyç­‰æµéŸ³ä¹å¹³å°</h1><p>çº¯å¬æ­Œï¼Œè€Œä¸”ä¸»åŠ›æ˜¯åœ¨iOSç«¯å’ŒMACç«¯çš„ï¼ŒApple Musicå¯èƒ½æ˜¯æœ€niceçš„ã€‚</p><p>ç³»ç»Ÿçº§çš„åº”ç”¨ä½“éªŒï¼Œç•Œé¢ç®€æ´ã€‚ä½†å¤ªè¿‡äºç®€æ´ï¼Œå¯¼è‡´å¾ˆå¤šäººå—¤ä¹‹ä»¥é¼»ï¼Œæ¬§ç¾æ›²åº“å¯¹æ¯”å›½å†…éŸ³ä¹åº”ç”¨ç®—æ˜¯æœ€é½çš„ï¼Œåè¯­è¿˜è¡Œå§ï¼Œä½†ç½‘æ˜“éŸ³ä¹äººï¼Œå°ä¼—æ°‘è°£æ­Œæ‰‹çš„æ›²åº“åº”è¯¥å¾ˆä¸å…¨ï¼Œæ–°æ­Œä¸Šæ¶é€Ÿåº¦æŒºå¿«çš„ã€‚éŸ³è´¨æ¯”qqéŸ³ä¹ï¼Œç½‘æ˜“äº‘å¥½å¾ˆå¤šã€‚ä½ èŠ±é’±ç›¸å½“äºä¹°æ–­ï¼Œæ–°ä¸“è¾‘éƒ½ä¸æ”¶è´¹ï¼Œåƒç½‘æ˜“ï¼Œè…¾è®¯ï¼Œå°½ç®¡ä½ å……äº†ä¼šå‘˜ï¼Œæ­Œæ‰‹å‡ºæ–°ä¸“è¾‘æ—¶ï¼Œç…§æ ·æ•°å­—ä¸“è¾‘æ˜¯å•ç‹¬æ”¶è´¹ã€‚</p><p>ä»·æ ¼ï¼š æ•™è‚²ä¼˜æƒ ç››æƒ 5å…ƒ/æœˆï¼Œä¸ªäººç”¨æˆ·10å…ƒ/æœˆï¼Œå®¶åº­ç»„15å…ƒ/æœˆã€‚è¿™ä¹ˆä¾¿å®œçš„ä»·æ ¼æ‹¥æœ‰è¿™ä¹ˆåºå¤§çš„æ›²åº“çœŸçš„å¾ˆå®æƒ äº†ã€‚é‰´äºå¤§å®¶éƒ½qiongï¼Œä½ å¯ä»¥å»æŸå®æœä¸ªApple musicæ•™è‚²ä¼˜æƒ é‚®ç®±ï¼Œ5å—é’±ï¼Œä½ ä»¥å5å…ƒ/æœˆã€‚ ä¸è¿‡10å—ä¹Ÿä¸è´µï¼Œä½ åŠ ä¸Šå®¶äººå¼€ä¸ªå®¶åº­ç»„ï¼Œä¹Ÿå¾ˆä¾¿å®œï¼Œå®¶åº­ç»„æœ€å¤š6ä¸ªidï¼Œç›¸å½“äºæ¯äººæ¯æœˆä¸¤å—äº”</p><p>ç¼ºç‚¹å°±æ˜¯æ²¡æœ‰æ­Œæ›²è¯„è®ºå’Œç¤¾äº¤åŠŸèƒ½ï¼Œè¿‡äºç®€æ´ã€‚</p><h3 id="1-ç™»å½•ä½ çš„ç½‘æ˜“äº‘è´¦å·"><a href="#1-ç™»å½•ä½ çš„ç½‘æ˜“äº‘è´¦å·" class="headerlink" title="1. ç™»å½•ä½ çš„ç½‘æ˜“äº‘è´¦å·"></a>1. ç™»å½•ä½ çš„<a href="https://music.163.com/" target="_blank" rel="noopener">ç½‘æ˜“äº‘</a>è´¦å·</h3><p>   <img src="https://s1.ax1x.com/2020/04/30/JHXTVf.png" alt="JHXTVf.png"></p><h3 id="2-è¿›å…¥ä¸ªäººä¸­å¿ƒï¼Œé€‰æ‹©ä½ æƒ³è¦è½¬ç§»çš„æ­Œå•"><a href="#2-è¿›å…¥ä¸ªäººä¸­å¿ƒï¼Œé€‰æ‹©ä½ æƒ³è¦è½¬ç§»çš„æ­Œå•" class="headerlink" title="2. è¿›å…¥ä¸ªäººä¸­å¿ƒï¼Œé€‰æ‹©ä½ æƒ³è¦è½¬ç§»çš„æ­Œå•"></a>2. è¿›å…¥ä¸ªäººä¸­å¿ƒï¼Œé€‰æ‹©ä½ æƒ³è¦è½¬ç§»çš„æ­Œå•</h3><p>   <a href="https://imgchr.com/i/JHjpZV" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/04/30/JHjpZV.png" alt="JHjpZV.png"></a></p><h3 id="3-å³é”®æ£€æŸ¥è¿›å…¥å¼€å‘è€…å·¥å…·ï¼Œåœ¨consoleé‡Œå¤åˆ¶è¿™æ®µä»£ç å›è½¦"><a href="#3-å³é”®æ£€æŸ¥è¿›å…¥å¼€å‘è€…å·¥å…·ï¼Œåœ¨consoleé‡Œå¤åˆ¶è¿™æ®µä»£ç å›è½¦" class="headerlink" title="3. å³é”®æ£€æŸ¥è¿›å…¥å¼€å‘è€…å·¥å…·ï¼Œåœ¨consoleé‡Œå¤åˆ¶è¿™æ®µä»£ç å›è½¦"></a>3. å³é”®æ£€æŸ¥è¿›å…¥å¼€å‘è€…å·¥å…·ï¼Œåœ¨consoleé‡Œå¤åˆ¶è¿™æ®µä»£ç å›è½¦</h3><blockquote><p>å…¶å®å°±æ˜¯å¾ˆç®€å•çš„é€‰ä¸­è¡¨æ ¼ä¸­çš„æ­Œåå­—æ®µ å’Œä½œè€…å­—æ®µ æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œ<code>ä½œè€…-æ­Œå</code>çš„å½¢å¼ï¼Œå¤„ç†æˆè¿™ä¸ª<a href="https://www.tunemymusic.comç½‘ç«™éœ€è¦çš„æ•°æ®" target="_blank" rel="noopener">https://www.tunemymusic.comç½‘ç«™éœ€è¦çš„æ•°æ®</a></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">"SCRIPT"</span>);</span><br><span class="line">    script.src = <span class="string">'https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js'</span>;</span><br><span class="line">    script.type = <span class="string">'text/javascript'</span>;</span><br><span class="line">    <span class="built_in">document</span>.getElementsByTagName(<span class="string">"head"</span>)[<span class="number">0</span>].appendChild(script);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> checkReady = <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">window</span>.jQuery) &#123;</span><br><span class="line">            callback(jQuery);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">window</span>.setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                checkReady(callback);</span><br><span class="line">            &#125;, <span class="number">100</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    checkReady(<span class="function"><span class="keyword">function</span> (<span class="params">$</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> text = <span class="string">""</span>;</span><br><span class="line">        $(<span class="built_in">window</span>.contentFrame.document).find(<span class="string">'#m-playlist .m-table tbody tr'</span>).each(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            text += ($(<span class="keyword">this</span>).children(<span class="string">'td:eq(3)'</span>).children(<span class="string">'div'</span>).attr(<span class="string">'title'</span>) + <span class="string">" - "</span> + $(<span class="keyword">this</span>).find(<span class="string">"b"</span>).attr(<span class="string">"title"</span>) + <span class="string">"&lt;br/&gt;"</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        $(<span class="built_in">window</span>.contentFrame.document).find(<span class="string">'body'</span>).append(<span class="string">"&lt;p&gt;"</span> + text + <span class="string">"&lt;/p&gt;"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure><p>è¾“å‡ºåœ¨äº†é¡µé¢å°±æ˜¯è¿™æ ·</p><p><a href="https://imgchr.com/i/JHvNc9" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/04/30/JHvNc9.png" alt="JHvNc9.png"></a></p><h3 id="4-æ‰“å¼€å’±ä»¬-æœ€å…³é”®çš„-TuneMyMusic-https-www-tunemymusic-com-ï¼Œä¹Ÿä¸ç”¨ç™»å½•ï¼Œä¹Ÿä¸ç”¨æ³¨å†Œ"><a href="#4-æ‰“å¼€å’±ä»¬-æœ€å…³é”®çš„-TuneMyMusic-https-www-tunemymusic-com-ï¼Œä¹Ÿä¸ç”¨ç™»å½•ï¼Œä¹Ÿä¸ç”¨æ³¨å†Œ" class="headerlink" title="4. æ‰“å¼€å’±ä»¬ æœ€å…³é”®çš„[TuneMyMusic][https://www.tunemymusic.com/]ï¼Œä¹Ÿä¸ç”¨ç™»å½•ï¼Œä¹Ÿä¸ç”¨æ³¨å†Œ"></a>4. æ‰“å¼€å’±ä»¬ æœ€å…³é”®çš„[TuneMyMusic][<a href="https://www.tunemymusic.com/]ï¼Œä¹Ÿä¸ç”¨ç™»å½•ï¼Œä¹Ÿä¸ç”¨æ³¨å†Œ" target="_blank" rel="noopener">https://www.tunemymusic.com/]ï¼Œä¹Ÿä¸ç”¨ç™»å½•ï¼Œä¹Ÿä¸ç”¨æ³¨å†Œ</a></h3><blockquote><p>åœ¨ä¸åŒçš„éŸ³ä¹æœåŠ¡å¹³å°ä¹‹é—´ä¼ é€æ’­æ”¾åˆ—è¡¨<br>å°†æ‚¨åœ¨ä»»æ„éŸ³ä¹æœåŠ¡å¹³å°å†…çš„éŸ³ä¹åº“ä¼ é€åˆ°æ‚¨æƒ³è¦çš„ä»»ä½•å…¶ä»–å¹³å°ï¼æ”¯æŒSpotify, TIDAL, Apple Music, YouTubeç­‰ç­‰</p></blockquote><p>   <a href="https://imgchr.com/i/JHvrtO" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/04/30/JHvrtO.md.png" alt="JHvrtO.md.png"></a></p><h4 id="4-1-å¯¼å…¥æ–¹å¼"><a href="#4-1-å¯¼å…¥æ–¹å¼" class="headerlink" title="4.1 å¯¼å…¥æ–¹å¼"></a>4.1 å¯¼å…¥æ–¹å¼</h4><p>é€‰æ‹©ä»æ–‡æœ¬ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä»å…¶ä»–å¹³å°å¯¼å…¥<img src="https://s1.ax1x.com/2020/04/30/JHxeUK.png" alt="JHxeUK.png"></p><h4 id="4-2-å¤åˆ¶"><a href="#4-2-å¤åˆ¶" class="headerlink" title="4.2 å¤åˆ¶"></a>4.2 å¤åˆ¶</h4><p>åˆšåˆšç½‘æ˜“äº‘é‚£å„¿å¤åˆ¶çš„æ­Œæ‰‹-æ­Œåä¸€å¤§é•¿ä¸²å¤åˆ¶è¿›å»</p><p><img src="https://s1.ax1x.com/2020/04/30/JHx4M9.png" alt="JHx4M9.png"></p><h4 id="4-3-é€‰æ‹©å¯¼å…¥çš„å¹³å°"><a href="#4-3-é€‰æ‹©å¯¼å…¥çš„å¹³å°" class="headerlink" title="4.3  é€‰æ‹©å¯¼å…¥çš„å¹³å°"></a>4.3  é€‰æ‹©å¯¼å…¥çš„å¹³å°</h4><p>å’±ä»¬è¿™å„¿é€‰æ‹©Apple musicï¼Œç„¶åä¼šè·³å‡ºä¸€ä¸ªç™»å½•çš„æ¡†ï¼Œä½ ç™»å½•å</p><p><img src="https://s1.ax1x.com/2020/04/30/JHzKoV.png" alt="JHzKoV.png"></p><h4 id="4-4-ç­‰å¾…å¯¼å…¥"><a href="#4-4-ç­‰å¾…å¯¼å…¥" class="headerlink" title="4.4  ç­‰å¾…å¯¼å…¥"></a>4.4  ç­‰å¾…å¯¼å…¥</h4><p>å“ªé¦–æˆåŠŸï¼Œå“ªé¦–å¤±è´¥éƒ½ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼ŒApple Musicå°éŸ³ä¹äººçš„æ›²åº“è¾ƒå°‘ï¼Œæ¬§ç¾æ­Œæ‰‹çš„æ­Œè¾ƒå…¨ï¼Œæ‰€ä»¥å¯èƒ½ä½ çš„æ­Œå•æœ‰ä¸€åŠä¼šä¸æˆåŠŸã€‚</p><p><img src="https://s1.ax1x.com/2020/04/30/JHz2wt.png" alt="JHz2wt.png"></p><h3 id="5-æˆåŠŸåˆšåˆšå¯¼å…¥çš„ã€‚"><a href="#5-æˆåŠŸåˆšåˆšå¯¼å…¥çš„ã€‚" class="headerlink" title="5. æˆåŠŸåˆšåˆšå¯¼å…¥çš„ã€‚"></a>5. æˆåŠŸåˆšåˆšå¯¼å…¥çš„ã€‚</h3><p><img src="https://s1.ax1x.com/2020/04/30/JbSuXd.png" alt="JbSuXd.png"></p>]]></content>
    
    <summary type="html">
    
      çº¯å¬æ­Œï¼Œè€Œä¸”ä¸»åŠ›æ˜¯åœ¨iOSç«¯å’ŒMACç«¯çš„ï¼ŒApple Musicå¯èƒ½æ˜¯æœ€niceçš„ã€‚åˆ©ç”¨TuneMyMusicç½‘ç«™è½¬ç§»æ­Œå•
    
    </summary>
    
      <category term="é»˜è®¤åˆ†ç±»" scheme="https://kitions.github.io/categories/%E9%BB%98%E8%AE%A4%E5%88%86%E7%B1%BB/"/>
    
    
  </entry>
  
  <entry>
    <title>Angularä¸­çš„è‡ªå®šä¹‰è¡¨å•æ§ä»¶ControlValueAccessor</title>
    <link href="https://kitions.github.io/2020/04/02/Angular%E4%B8%AD%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A1%A8%E5%8D%95%E6%8E%A7%E4%BB%B6ControlValueAccessor/"/>
    <id>https://kitions.github.io/2020/04/02/Angularä¸­çš„è‡ªå®šä¹‰è¡¨å•æ§ä»¶ControlValueAccessor/</id>
    <published>2020-04-02T09:52:16.000Z</published>
    <updated>2020-04-07T02:02:39.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Angularä¸­çš„è‡ªå®šä¹‰è¡¨å•æ§ä»¶ControlValueAccessor"><a href="#Angularä¸­çš„è‡ªå®šä¹‰è¡¨å•æ§ä»¶ControlValueAccessor" class="headerlink" title="Angularä¸­çš„è‡ªå®šä¹‰è¡¨å•æ§ä»¶ControlValueAccessor"></a>Angularä¸­çš„è‡ªå®šä¹‰è¡¨å•æ§ä»¶ControlValueAccessor</h1><p>è¿™ä¸ªæ˜¯ä¸ªè¾ƒä¸ºç®€å•çš„ç†è§£</p><p> ControlValueAccessor acts as a bridge between the Angular forms API and a native element in the DOM.</p><p>ä½œç”¨ï¼š</p><ul><li>æŠŠ form æ¨¡å‹ä¸­å€¼æ˜ å°„åˆ°è§†å›¾ä¸­</li><li>å½“è§†å›¾å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé€šçŸ¥ form directives æˆ– form controls</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> ControlValueAccessor &#123;</span><br><span class="line">  writeValue(obj: <span class="built_in">any</span>): <span class="built_in">void</span></span><br><span class="line">  registerOnChange(fn: <span class="built_in">any</span>): <span class="built_in">void</span></span><br><span class="line">  registerOnTouched(fn: <span class="built_in">any</span>): <span class="built_in">void</span></span><br><span class="line">  setDisabledState(isDisabled: <span class="built_in">boolean</span>)?: <span class="built_in">void</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>writeValue(obj: any)ï¼šè¯¥æ–¹æ³•ç”¨äºå°†æ¨¡å‹ä¸­çš„æ–°å€¼å†™å…¥è§†å›¾æˆ– DOM å±æ€§ä¸­ï¼Œå³model-&gt;view</li><li>registerOnChange(fn: any)ï¼šè®¾ç½®å½“æ§ä»¶æ¥æ”¶åˆ° change äº‹ä»¶åï¼Œè°ƒç”¨çš„å‡½æ•°ï¼Œå¯ä»¥ç”¨æ¥é€šçŸ¥å¤–éƒ¨ï¼Œç»„ä»¶å·²ç»å‘ç”Ÿå˜åŒ–ï¼Œå³view-&gt;model</li><li>registerOnTouched(fn: any)ï¼šè®¾ç½®å½“æ§ä»¶æ¥æ”¶åˆ° touched äº‹ä»¶åï¼Œè°ƒç”¨çš„å‡½æ•°</li><li>setDisabledState?(isDisabled: boolean)ï¼šå½“æ§ä»¶çŠ¶æ€å˜æˆ DISABLED æˆ–ä» DISABLED çŠ¶æ€å˜åŒ–æˆ ENABLE çŠ¶æ€æ—¶ï¼Œä¼šè°ƒç”¨è¯¥å‡½æ•°ã€‚è¯¥å‡½æ•°ä¼šæ ¹æ®å‚æ•°å€¼ï¼Œå¯ç”¨æˆ–ç¦ç”¨æŒ‡å®šçš„ DOM å…ƒç´ ã€‚</li></ul><p>ä»»ä½•ä¸€ä¸ªç»„ä»¶æˆ–æŒ‡ä»¤éƒ½å¯ä»¥é€šè¿‡å®ç° <code>ControlValueAccessor</code> æ¥å£å¹¶æ³¨å†Œä¸º <code>NG_VALUE_ACCESSOR</code>ï¼Œä»è€Œè½¬å˜æˆ <code>ControlValueAccessor</code> ç±»å‹çš„å¯¹è±¡</p><p><code>registerOnChange</code> æ–¹æ³•æ¥æ³¨å†Œç”±æ¯æ¬¡åŸç”Ÿè¡¨å•æ§ä»¶å€¼æ›´æ–°æ—¶è§¦å‘çš„å›è°ƒå‡½æ•°</p><p>Example:</p><p>å­ç»„ä»¶</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">    selector: <span class="string">'app-demo'</span>,</span><br><span class="line">    templateUrl: <span class="string">'./demo.component.html'</span>,</span><br><span class="line">    styleUrls: [<span class="string">'./demo.component.css'</span>],</span><br><span class="line">    providers: [</span><br><span class="line">        &#123;</span><br><span class="line">            provide: NG_VALUE_ACCESSOR,</span><br><span class="line">            useExisting: DemoComponent,</span><br><span class="line">            multi: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        DemoService</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> DemoComponent <span class="keyword">implements</span> ControlValueAccessor, OnInit &#123;</span><br><span class="line">    <span class="keyword">private</span> _result: &#123; [index: <span class="built_in">string</span>]: [] &#125; = &#123;&#125;;</span><br><span class="line">    <span class="keyword">private</span> _labelHandler: <span class="function">(<span class="params">val: <span class="built_in">any</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">        <span class="keyword">private</span> service: DemoService,</span></span><br><span class="line"><span class="params">    </span>) &#123; &#125;</span><br><span class="line">  </span><br><span class="line">  aTestFunc()&#123;</span><br><span class="line">      <span class="keyword">this</span>._labelHandler(<span class="string">"123123"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  writeValue(value: <span class="built_in">string</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (value) &#123;</span><br><span class="line">            <span class="comment">// todo åœ¨è¿™é‡Œå¯¹çˆ¶ç»„ä»¶ä¼ è¿›æ¥çš„ngmodelå€¼åšå¤„ç†</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    registerOnChange(fn: <span class="built_in">any</span>) &#123;</span><br><span class="line">      <span class="comment">//æ¯æ¬¡æ§ä»¶viewå±‚çš„å€¼å‘ç”Ÿæ”¹å˜ï¼Œéƒ½è¦è°ƒç”¨è¯¥æ–¹æ³•é€šçŸ¥å¤–éƒ¨</span></span><br><span class="line">        <span class="keyword">this</span>._labelHandler = fn;</span><br><span class="line">    &#125;</span><br><span class="line">    registerOnTouched(fn: <span class="built_in">any</span>) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çˆ¶ç»„ä»¶</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// html</span><br><span class="line">    <span class="tag">&lt;<span class="name">app-demo</span> [(<span class="attr">ngModel</span>)]=<span class="string">"demo"</span> &gt;</span><span class="tag">&lt;/<span class="name">app-demo</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// component.ts</span></span><br><span class="line"></span><br><span class="line">ngOnInit() &#123;</span><br><span class="line">  <span class="comment">// ç»™demoä¸€ä¸ªå€¼åŒå‘ç»‘å®š</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      ControlValueAccessor acts as a bridge between the Angular forms API and a native element in the DOM.
    
    </summary>
    
      <category term="é»˜è®¤åˆ†ç±»" scheme="https://kitions.github.io/categories/%E9%BB%98%E8%AE%A4%E5%88%86%E7%B1%BB/"/>
    
    
      <category term="Angnular" scheme="https://kitions.github.io/tags/Angnular/"/>
    
  </entry>
  
  <entry>
    <title>CKediorä¸¤å¼ æ–¹æ³•ä¸Šä¼ å›¾ç‰‡åŠç®€å•çš„pluginsç¼–å†™</title>
    <link href="https://kitions.github.io/2020/03/19/CKedior%E4%B8%A4%E5%BC%A0%E6%96%B9%E6%B3%95%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E5%8F%8A%E7%AE%80%E5%8D%95%E7%9A%84plugins%E7%BC%96%E5%86%99/"/>
    <id>https://kitions.github.io/2020/03/19/CKediorä¸¤å¼ æ–¹æ³•ä¸Šä¼ å›¾ç‰‡åŠç®€å•çš„pluginsç¼–å†™/</id>
    <published>2020-03-19T09:29:44.000Z</published>
    <updated>2020-04-17T10:44:48.000Z</updated>
    
    <content type="html"><![CDATA[<p>CKedioræ¯”è¾ƒç¨³å¥ï¼Œæ–‡æ¡£å¾ˆå…¨ï¼Œæ”¯æŒæ’ä»¶ï¼Œé…ç½®ä»€ä¹ˆçš„ä¹Ÿå¾ˆå‹å¥½ï¼Œå…ˆç»™ä¸ªæ–‡æ¡£é“¾æ¥æ„Ÿå—ä¸€ä¸‹ï¼šckeditoråœ¨çº¿æ–‡æ¡£<a href="https://docs.ckeditor.com/#!/guide/dev_installationã€‚" target="_blank" rel="noopener">https://docs.ckeditor.com/#!/guide/dev_installationã€‚</a></p><p>ckeditorå¯Œæ–‡æœ¬ç¼–è¾‘å™¨ä¸Šä¼ å›¾ç‰‡ç›®å‰æƒ³åˆ°çš„ä¸¤ä¸ªæ–¹æ³•ï¼š</p><ol><li>è‡ªå·±å†™ä¸€ä¸ªä¸Šä¼ æ’ä»¶ï¼ˆæ‰©å±•æ€§æ›´å¼ºï¼‰</li><li>æ‰¾åˆ°é’©å­å‡½æ•°ç›‘å¬äº‹ä»¶ï¼ˆä¸Šä¼ æ›´é€šç”¨ï¼‰</li></ol><h1 id="ä¸€-è‡ªå·±å†™ä¸€ä¸ªä¸Šä¼ æ’ä»¶"><a href="#ä¸€-è‡ªå·±å†™ä¸€ä¸ªä¸Šä¼ æ’ä»¶" class="headerlink" title="ä¸€. è‡ªå·±å†™ä¸€ä¸ªä¸Šä¼ æ’ä»¶"></a>ä¸€. è‡ªå·±å†™ä¸€ä¸ªä¸Šä¼ æ’ä»¶</h1><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æ¯•ç«Ÿæ¯ä¸ªäººçš„éœ€æ±‚éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿™æ—¶å€™ä¸€ä¸ªç¼–è¾‘å™¨çš„â€œå¯æ‰©å±•æ€§â€å°±å¿…ä¸å¯å°‘äº†ã€‚æœ‰äº†è¿™ä¸ªæ’ä»¶åŠŸèƒ½ï¼Œä½ å¯ä»¥é’ˆå¯¹å¯Œæ–‡æœ¬ç¼–è¾‘å™¨åšå„ç§å„æ ·çš„äº‹æƒ…ï¼Œæ¯”å¦‚å¤åˆ¶å¤–ç«™å›¾ç‰‡ï¼Œè‡ªåŠ¨ä¸Šä¼ åˆ°ä½ æŒ‡å®šçš„åŸŸåï¼Œå¹¶æ’å…¥å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ä¸­ç­‰ç­‰ã€‚</p><h3 id="æ€ä¹ˆå†™ä¸€ä¸ªckeditorçš„plugins"><a href="#æ€ä¹ˆå†™ä¸€ä¸ªckeditorçš„plugins" class="headerlink" title="æ€ä¹ˆå†™ä¸€ä¸ªckeditorçš„plugins"></a>æ€ä¹ˆå†™ä¸€ä¸ªckeditorçš„plugins</h3><h5 id="1-æ–‡ä»¶å¤¹"><a href="#1-æ–‡ä»¶å¤¹" class="headerlink" title="1. æ–‡ä»¶å¤¹"></a>1. æ–‡ä»¶å¤¹</h5><p>åœ¨ckeidtorçš„ç›®å½•ä¸‹æœ‰ä¸ªpluginsæ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬è¦åšçš„å°±åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œï¼Œåœ¨pluginsä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåç§°ä¸ºä½ æ‰€å‘½åçš„æ’ä»¶åï¼Œæ–°å»ºä¸€ä¸ªjsã€‚imagesæ–‡ä»¶å¤¹ç”¨æ¥å­˜æ”¾ç”¨åˆ°çš„å°å›¾æ ‡.</p><p><img src="https://ae01.alicdn.com/kf/H2f66016af09c42188659a0e89028b111I.png" alt=""></p><h5 id="2-plugin-js"><a href="#2-plugin-js" class="headerlink" title="2. plugin.js"></a>2. plugin.js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CKEDITOR.plugins.add( <span class="string">'UploadImage'</span>, &#123;</span><br><span class="line">    icons: <span class="string">'image'</span>,</span><br><span class="line">    init: <span class="function"><span class="keyword">function</span>(<span class="params"> editor </span>) </span>&#123;</span><br><span class="line">        <span class="comment">// Plugin logic goes here...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h6 id="2-1-åˆ›å»ºç¼–è¾‘å™¨å‘½ä»¤"><a href="#2-1-åˆ›å»ºç¼–è¾‘å™¨å‘½ä»¤" class="headerlink" title="2.1 åˆ›å»ºç¼–è¾‘å™¨å‘½ä»¤"></a>2.1 åˆ›å»ºç¼–è¾‘å™¨å‘½ä»¤</h6><p>æˆ‘ä»¬å¸Œæœ›æ’ä»¶å…·æœ‰ä¸€ä¸ªå¯¹è¯æ¡†çª—å£ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªç¼–è¾‘å™¨å‘½ä»¤æ¥æ‰“å¼€ä¸€ä¸ªæ–°çš„å¯¹è¯æ¡†çª—å£ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨çš„<a href="https://ckeditor.com/docs/ckeditor4/latest/api/CKEDITOR_editor.html#method-addCommand" target="_blank" rel="noopener">editor.addCommand</a> å‡½æ•°æ³¨å†Œabbrå‘½ä»¤ã€‚ä¸šåŠ¡é€»è¾‘ ä¸»è¦å†™åœ¨è¿™å—</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">editor.addCommand( <span class="string">'abbr'</span>, <span class="keyword">new</span> CKEDITOR.dialogCommand( <span class="string">'abbrDialog'</span> ) );</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">editor.addCommand(<span class="string">'openFileComm'</span>, &#123;&#125;</span><br></pre></td></tr></table></figure><h6 id="2-2-åˆ›å»ºå·¥å…·æ æŒ‰é’®"><a href="#2-2-åˆ›å»ºå·¥å…·æ æŒ‰é’®" class="headerlink" title="2.2 åˆ›å»ºå·¥å…·æ æŒ‰é’®"></a>2.2 åˆ›å»ºå·¥å…·æ æŒ‰é’®</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">editor.ui.addButton( <span class="string">'Abbr'</span>, &#123;</span><br><span class="line">    label: <span class="string">'Insert Abbreviation'</span>,</span><br><span class="line">    command: <span class="string">'UploadImage'</span>,</span><br><span class="line">    toolbar: <span class="string">'insert'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h6 id="2-3-CKEditoråˆå§‹åŒ–"><a href="#2-3-CKEditoråˆå§‹åŒ–" class="headerlink" title="2.3 CKEditoråˆå§‹åŒ–"></a>2.3 CKEditoråˆå§‹åŒ–</h6><p>å‘Šè¯‰CKEditoråŠ è½½æˆ‘ä»¬çš„æ’ä»¶äº†ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¿…é¡»å°†å…¶åç§°æ·»åŠ åˆ°<br>CKEDITOR.config.extraPluginsé…ç½®é€‰é¡¹ä¸­ï¼š<br><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config.extraPlugins = <span class="string">'UploadImage'</span>;</span><br></pre></td></tr></table></figure></p><h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><p>ps: ç›®å‰å†™çš„æ’ä»¶æ˜¯ç”¨jqueryé’ˆå¯¹è‡ªå·±é¡¹ç›®ä½¿ç”¨çš„ã€‚æ²¡æœ‰å†™æˆä¸€ä¸ªé€šç”¨å‹çš„æ’ä»¶</p><p><img src="https://ae01.alicdn.com/kf/Hadce4c9a7cd34578a322d91efc90af9c8.png" alt=""></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * link æ·»åŠ è‡ªå®šä¹‰å›¾ç‰‡ä¸Šä¼ ç»„ä»¶  </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*     html</span></span><br><span class="line"><span class="comment">    &lt;div&gt;</span></span><br><span class="line"><span class="comment">        &lt;form id="editorImageForm" enctype="multipart/form-data" method="post"</span></span><br><span class="line"><span class="comment">            style="display: none"&gt;</span></span><br><span class="line"><span class="comment">            &lt;div&gt;</span></span><br><span class="line"><span class="comment">                &lt;input type="file" id="editFileInput" name="file"</span></span><br><span class="line"><span class="comment">                    accept=".gif,.png,.jpg,.jpeg" /&gt;&lt;br&gt;</span></span><br><span class="line"><span class="comment">            &lt;/div&gt;</span></span><br><span class="line"><span class="comment">        &lt;/form&gt;</span></span><br><span class="line"><span class="comment">    &lt;/div&gt;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">CKEDITOR.plugins.add(<span class="string">'UploadImage'</span>,&#123;<span class="comment">// è°ƒç”¨addæ–¹æ³•æ·»åŠ æ’ä»¶</span></span><br><span class="line">    init : <span class="function"><span class="keyword">function</span> (<span class="params">editor</span>) </span>&#123; <span class="comment">// åˆå§‹åŒ–é¡µé¢æ—¶è°ƒç”¨æ–¹æ³•ï¼Œæ¥æ”¶ä¸€ä¸ªå¯Œæ–‡æœ¬å¯¹è±¡å®ä¾‹</span></span><br><span class="line">        <span class="keyword">var</span> pluginName = <span class="string">'UploadImage'</span>; <span class="comment">// æ’ä»¶å</span></span><br><span class="line">        <span class="keyword">var</span> _file = <span class="built_in">document</span>.getElementById(<span class="string">'editFileInput'</span>); <span class="comment">//è·å–é¡µé¢ä¸­çš„fileæ–‡ä»¶é€‰æ‹©å™¨å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">var</span> uploadUrl = <span class="built_in">document</span>.querySelector(<span class="string">'.site_url_upload'</span>).innerText || <span class="string">"https://user.smm.cn/upload_img"</span>; <span class="comment">// ä¸Šä¼ çš„urlï¼Œä»é¡µé¢ä¸­è·å–çš„</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * æ·»åŠ æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        editor.addCommand(<span class="string">'openFileComm'</span>, &#123;<span class="comment">//æ·»åŠ å‘½ä»¤</span></span><br><span class="line">            exec : <span class="function"><span class="keyword">function</span> (<span class="params">editor</span>) </span>&#123;<span class="comment">//å‘½ä»¤è°ƒç”¨æ—¶æ‰§è¡Œæ­¤å‡½æ•°</span></span><br><span class="line">                _file.click(); <span class="comment">//è§¦å‘æ–‡ä»¶é€‰æ‹©å™¨çš„ç‚¹å‡»äº‹ä»¶</span></span><br><span class="line">                _file.onchange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="comment">//ä¸ºæ–‡ä»¶é€‰æ‹©å™¨ç‹¬äº«ç»‘å®šonchangeæ–¹æ³•</span></span><br><span class="line">                    upload();<span class="comment">//æ‰§è¡Œå‡½æ•°</span></span><br><span class="line">                    <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                        <span class="keyword">let</span> files = _file.files[<span class="number">0</span>];</span><br><span class="line">                        <span class="keyword">var</span> fd = <span class="keyword">new</span> FormData();</span><br><span class="line">                        fd.append(<span class="string">"richTxt_img"</span>, files); </span><br><span class="line">                        fd.append(<span class="string">"name"</span>, <span class="string">""</span>); </span><br><span class="line">                        fd.append(<span class="string">"cat"</span>, <span class="string">""</span>); </span><br><span class="line">                        $.ajax(&#123; <span class="comment">//ä½¿ç”¨ajaxè¯·æ±‚ä¸Šä¼ å›¾ç‰‡</span></span><br><span class="line">                            url : uploadUrl,</span><br><span class="line">                            <span class="keyword">type</span> : <span class="string">'POST'</span>,</span><br><span class="line">                            data : fd,</span><br><span class="line">                            <span class="keyword">async</span> : <span class="literal">false</span>,</span><br><span class="line">                            cache : <span class="literal">false</span>,</span><br><span class="line">                            processData:<span class="literal">false</span>,</span><br><span class="line">                            contentType:<span class="literal">false</span>,</span><br><span class="line">                            dataType:<span class="string">'json'</span>,</span><br><span class="line">                            success : <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">                                <span class="keyword">if</span>(data.code === <span class="number">0</span>)&#123;</span><br><span class="line">                                    <span class="keyword">var</span> element = CKEDITOR.dom.element.createFromHtml( <span class="string">'&lt;img style="width: auto;" src="'</span> + data.fileurl +<span class="string">'" border="0" /&gt;'</span> ); <span class="comment">//ä¸Šä¼ æˆåŠŸåæ·»åŠ ä¸Šä¼ å®Œæˆçš„å›¾ç‰‡å…ƒç´ åˆ°å¯Œæ–‡æœ¬å†…å®¹ä¸­</span></span><br><span class="line">                                    editor.insertElement( element );<span class="comment">//æ’å…¥å…ƒç´ </span></span><br><span class="line">                                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                                    alert(<span class="string">"å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼"</span>)</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;,</span><br><span class="line">                            error : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                                alert(<span class="string">"ajaxå›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼"</span>);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="keyword">async</span> : <span class="literal">true</span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        editor.ui.addButton &amp;&amp; editor.ui.addButton(pluginName, &#123; <span class="comment">//æ·»åŠ ä¸€ä¸ªä¸Šä¼ å›¾ç‰‡çš„æŒ‰é’®</span></span><br><span class="line">            label: <span class="string">'å›¾ç‰‡ä¸Šä¼ '</span>,<span class="comment">//æŒ‰é’®æç¤ºå</span></span><br><span class="line">            command: <span class="string">'openFileComm'</span>,<span class="comment">//å½“æŒ‰é’®è¢«ç‚¹å‡»æ—¶æ‰§è¡Œä¸Šé¢å®šä¹‰å¥½çš„å‘½ä»¤</span></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * æ·»åŠ è‡ªå®šä¹‰æŒ‰é’®å›¾ç‰‡</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            icon: <span class="keyword">this</span>.path + <span class="string">'./upload.png'</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="äºŒ-åˆ©ç”¨Ckeditorå†…ç½®çš„é’©å­æ¥ä¸Šä¼ å›¾ç‰‡"><a href="#äºŒ-åˆ©ç”¨Ckeditorå†…ç½®çš„é’©å­æ¥ä¸Šä¼ å›¾ç‰‡" class="headerlink" title="äºŒ.  åˆ©ç”¨Ckeditorå†…ç½®çš„é’©å­æ¥ä¸Šä¼ å›¾ç‰‡"></a>äºŒ.  åˆ©ç”¨Ckeditorå†…ç½®çš„é’©å­æ¥ä¸Šä¼ å›¾ç‰‡</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// editor.module.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; NgModule, CUSTOM_ELEMENTS_SCHEMA &#125; <span class="keyword">from</span> <span class="string">'@angular/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ShareModule &#125; <span class="keyword">from</span> <span class="string">'../../../share/share.module'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; CKEditorModule &#125; <span class="keyword">from</span> <span class="string">'ng2-ckeditor'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; CkEditorComponent &#125; <span class="keyword">from</span> <span class="string">'./ckeditor/ckeditor.component'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@NgModule(&#123;</span><br><span class="line">    declarations: [</span><br><span class="line">        CkEditorComponent,</span><br><span class="line">    ],</span><br><span class="line">    imports: [</span><br><span class="line">        ShareModule,</span><br><span class="line">        CKEditorModule,</span><br><span class="line">    ],</span><br><span class="line">    exports: [</span><br><span class="line">        CkEditorComponent</span><br><span class="line">    ],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">NewsEditorModule</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CkEditorComponentå…³é”®æ€§ä»£ç </span></span><br><span class="line"><span class="comment">// this.actionURLä¸Šä¼ é“¾æ¥</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> CkEditorComponent <span class="keyword">implements</span> ControlValueAccessor, OnInit,OnChanges, AfterViewInit &#123;</span><br><span class="line">  ngOnInit() &#123;</span><br><span class="line">        <span class="keyword">this</span>.ckeConfig =  &#123;</span><br><span class="line">            allowedContent: <span class="literal">false</span>,</span><br><span class="line">            extraPlugins: <span class="string">'divarea'</span>,</span><br><span class="line">            forcePasteAsPlainText: <span class="literal">false</span>,</span><br><span class="line">            height: <span class="number">500</span>,</span><br><span class="line">            toolbar: <span class="string">'Basic'</span>,</span><br><span class="line">            toolbarGroups: [</span><br><span class="line">                <span class="comment">// &#123; name: 'clipboard', groups: [ 'clipboard', 'undo' ] &#125;,</span></span><br><span class="line">                &#123; name: <span class="string">'editing'</span>, groups: [<span class="string">'find'</span>, <span class="string">'selection'</span>] &#125;, <span class="comment">// 'spellchecker'</span></span><br><span class="line">                &#123; name: <span class="string">'links'</span> &#125;,</span><br><span class="line">                &#123; name: <span class="string">'insert'</span> &#125;,</span><br><span class="line">                &#123; name: <span class="string">'forms'</span> &#125;,</span><br><span class="line">                &#123; name: <span class="string">'tools'</span> &#125;,</span><br><span class="line">                &#123; name: <span class="string">'document'</span>, groups: [<span class="string">'mode'</span>, <span class="string">'document'</span>, <span class="string">'doctools'</span>] &#125;,</span><br><span class="line">                &#123; name: <span class="string">'others'</span> &#125;,</span><br><span class="line">                &#123; name: <span class="string">'basicstyles'</span>, groups: [<span class="string">'basicstyles'</span>, <span class="string">'cleanup'</span>] &#125;,</span><br><span class="line">                &#123; name: <span class="string">'paragraph'</span>, groups: [<span class="string">'list'</span>, <span class="string">'indent'</span>, <span class="string">'align'</span>] &#125;,</span><br><span class="line">                &#123; name: <span class="string">'styles'</span> &#125;,</span><br><span class="line">                &#123; name: <span class="string">'colors'</span> &#125;,</span><br><span class="line">                <span class="comment">// &#123; name: 'about' &#125;</span></span><br><span class="line">            ],</span><br><span class="line">            filebrowserImageUploadUrl: <span class="keyword">this</span>.actionURL,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">ngAfterViewInit() &#123;</span><br><span class="line">        <span class="keyword">const</span> self = <span class="keyword">this</span>;</span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> instanceName <span class="keyword">in</span> CKEDITOR.instances) &#123;</span><br><span class="line">                self.editor = CKEDITOR.instances[instanceName];</span><br><span class="line">                self.editor.on(<span class="string">"instanceReady"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">ev: <span class="built_in">any</span></span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">let</span> editor = ev.editor;</span><br><span class="line">                    <span class="comment">// ç›‘å¬ä¸Šä¼ äº‹ä»¶</span></span><br><span class="line">                    editor.on(<span class="string">'fileUploadRequest'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">evt</span>) </span>&#123;</span><br><span class="line">                        <span class="keyword">var</span> fileLoader = evt.data.fileLoader,</span><br><span class="line">                            formData = <span class="keyword">new</span> FormData(),</span><br><span class="line">                            xhr = fileLoader.xhr;</span><br><span class="line"></span><br><span class="line">                        xhr.open(<span class="string">'POST'</span>, fileLoader.uploadUrl, <span class="literal">true</span>);</span><br><span class="line">                        xhr.setRequestHeader(<span class="string">'TOKEN'</span>, self._cookie.get(CookiesService.KEY));</span><br><span class="line"></span><br><span class="line">                        formData.append(<span class="string">'upload'</span>, fileLoader.file, fileLoader.fileName);</span><br><span class="line">                        fileLoader.xhr.send(formData);</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// Prevented the default behavior.</span></span><br><span class="line">                        evt.stop();</span><br><span class="line">                    &#125;, <span class="literal">null</span>, <span class="literal">null</span>, <span class="number">4</span>);</span><br><span class="line">                    <span class="comment">// ç›‘å¬è¿”å›äº‹ä»¶</span></span><br><span class="line">                    editor.on(<span class="string">'fileUploadResponse'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">evt</span>) </span>&#123;</span><br><span class="line">                        <span class="comment">// Prevent the default response handler.</span></span><br><span class="line">                        evt.stop();</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// Get XHR and response.</span></span><br><span class="line">                        <span class="keyword">var</span> data = evt.data,</span><br><span class="line">                            xhr = data.fileLoader.xhr,</span><br><span class="line">                            response = xhr.responseText.split(<span class="string">'|'</span>);</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (response[<span class="number">1</span>]) &#123;</span><br><span class="line">                            <span class="comment">// An error occurred during upload.</span></span><br><span class="line">                            data.message = response[<span class="number">1</span>];</span><br><span class="line">                            evt.cancel();</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">try</span> &#123;</span><br><span class="line">                                <span class="keyword">if</span> (response[<span class="number">0</span>]) &#123;</span><br><span class="line">                                    <span class="keyword">const</span> res = <span class="built_in">JSON</span>.parse(response[<span class="number">0</span>]);</span><br><span class="line">                                    <span class="keyword">if</span> (res.code === <span class="number">0</span>) &#123;</span><br><span class="line">                                        data.url = res.data &amp;&amp; res.data.key;</span><br><span class="line">                                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                        data.message = res.msg;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                    data.message = <span class="string">"ä¸Šä¼ å¤±è´¥äº†"</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                                <span class="built_in">console</span>.log(<span class="string">"ä¸Šä¼ å›¾ç‰‡å‡ºé”™"</span>, error);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      ckedioræ€ä¹ˆå†™æ’ä»¶ï¼Œckediorä¸Šä¼ å›¾ç‰‡pluginsï¼Œng2-ckediorä¸Šä¼ å›¾ç‰‡çš„ä¸€äº›æ‘¸ç´¢ï¼Œä¸»è¦æ˜¯ngAfterViewInitä¸­çš„ä¸¤ä¸ªäº‹ä»¶ç›‘å¬
    
    </summary>
    
      <category term="é»˜è®¤åˆ†ç±»" scheme="https://kitions.github.io/categories/%E9%BB%98%E8%AE%A4%E5%88%86%E7%B1%BB/"/>
    
    
      <category term="Angnular" scheme="https://kitions.github.io/tags/Angnular/"/>
    
      <category term="CKeditor" scheme="https://kitions.github.io/tags/CKeditor/"/>
    
  </entry>
  
  <entry>
    <title>Next.js - FQ</title>
    <link href="https://kitions.github.io/2020/03/03/Next.js%20-%20FQ/"/>
    <id>https://kitions.github.io/2020/03/03/Next.js - FQ/</id>
    <published>2020-03-03T10:15:37.000Z</published>
    <updated>2020-03-03T10:12:38.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Next-js-FQ"><a href="#Next-js-FQ" class="headerlink" title="Next.js - FQ"></a>Next.js - FQ</h1><h2 id="How-to-use-cssModules"><a href="#How-to-use-cssModules" class="headerlink" title="How to use cssModules"></a>How to use cssModules</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># install next-css</span><br><span class="line"></span><br><span class="line">yarn add @zeit/next-css</span><br><span class="line"></span><br><span class="line"># use nextCss warpped the config</span><br><span class="line"><span class="comment">// next.config.js</span></span><br><span class="line"><span class="keyword">const</span> withLess = <span class="built_in">require</span>(<span class="string">'@zeit/next-less'</span>);</span><br><span class="line"><span class="keyword">const</span> withCSS = <span class="built_in">require</span>(<span class="string">'@zeit/next-css'</span>);</span><br><span class="line">...</span><br><span class="line"><span class="built_in">module</span>.exports = withCSS(</span><br><span class="line">  withLess(&#123;</span><br><span class="line">    cssModules: <span class="literal">true</span>,</span><br><span class="line">    ... <span class="comment">// other config</span></span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># use css modules</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> css <span class="keyword">from</span> <span class="string">"../style.css"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Component = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=&#123;css.example&#125;&gt;</span><br><span class="line">      ...</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Component;</span></span><br></pre></td></tr></table></figure><h2 id="How-to-listen-for-routing-changes"><a href="#How-to-listen-for-routing-changes" class="headerlink" title="How to listen for routing changes?"></a>How to listen for routing changes?</h2><p>The router of next provide some APIs that are used to listen for routing changes for us. <code>For example: beforeHistoryChange, routeChangeComplete...</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// _app.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">'next/router'</span>;</span><br><span class="line">...</span><br><span class="line"><span class="comment">// Listen the route path change</span></span><br><span class="line">Router.events.on(<span class="string">'routeChangeStart'</span>, (path) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'route start change, the next route is:'</span>, path);</span><br><span class="line">  <span class="comment">// do something what you want to do.</span></span><br><span class="line">  ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="The-solution-of-ant-design-in-the-development-environment-style-load-is-incomplete"><a href="#The-solution-of-ant-design-in-the-development-environment-style-load-is-incomplete" class="headerlink" title="The solution of ant-design in the development environment style load is incomplete."></a>The solution of <code>ant-design</code> in the development environment style load is incomplete.</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// next.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isDev = process.env.NODE_ENV !== <span class="string">'production'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// fix antd bug in dev development</span></span><br><span class="line"><span class="keyword">const</span> devAntd = <span class="string">'@import "~antd/dist/antd.less";\n'</span>;</span><br><span class="line"><span class="keyword">const</span> stylesData = fs.readFileSync(</span><br><span class="line">  path.resolve(__dirname, <span class="string">'./assets/_styles.less'</span>),</span><br><span class="line">  <span class="string">'utf-8'</span></span><br><span class="line">);</span><br><span class="line">fs.writeFileSync(</span><br><span class="line">  path.resolve(__dirname, <span class="string">'./assets/self-styles.less'</span>),</span><br><span class="line">  isDev ? <span class="string">`<span class="subst">$&#123;devAntd&#125;</span><span class="subst">$&#123;stylesData&#125;</span>`</span> : stylesData,</span><br><span class="line">  <span class="string">'utf-8'</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="The-solution-of-min-css-extract-plugin-warning-in-the-console"><a href="#The-solution-of-min-css-extract-plugin-warning-in-the-console" class="headerlink" title="The solution of min-css-extract-plugin warning in the console"></a>The solution of <code>min-css-extract-plugin</code> warning in the console</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chunk commons [mini-css-extract-plugin]</span><br><span class="line">Conflicting order between:</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>// next.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// define the webpack plugn</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FilterPlugin</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(options) &#123;</span><br><span class="line">    <span class="keyword">this</span>.options = options;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  apply(compiler) &#123;</span><br><span class="line">    compiler.hooks.afterEmit.tap(</span><br><span class="line">      <span class="string">'FilterPlugin'</span>,</span><br><span class="line">      (compilation) =&gt; &#123;</span><br><span class="line">        compilation.warnings = (compilation.warnings).filter(</span><br><span class="line">          warning =&gt; !<span class="keyword">this</span>.options.filter.test(warning.message)</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">webpack: <span class="function">(<span class="params">config, &#123;...args&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  config.plugins.push(</span><br><span class="line">    ...[</span><br><span class="line">      <span class="comment">// Instantiate the plugin and add it as a Webpack plugin</span></span><br><span class="line">      <span class="keyword">new</span> FilterPlugin(</span><br><span class="line">        &#123; <span class="attr">filter</span>: <span class="regexp">/chunk styles \[mini-css-extract-plugin]\nConflicting order between:/</span> &#125;</span><br><span class="line">      )</span><br><span class="line">    ]</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="How-to-polyfill-IE10-IE9-in-this-scaffold"><a href="#How-to-polyfill-IE10-IE9-in-this-scaffold" class="headerlink" title="How to polyfill IE10/IE9 in this scaffold?"></a>How to polyfill IE10/IE9 in this scaffold?</h2><h4 id="Add-polyfills-js-in-your-project"><a href="#Add-polyfills-js-in-your-project" class="headerlink" title="Add polyfills.js in your project."></a>Add polyfills.js in your project.</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /core/polyfills.js</span></span><br><span class="line"><span class="comment">/* eslint no-extend-native: 0 */</span></span><br><span class="line"><span class="comment">// core-js comes with Next.js. So, you can import it like below</span></span><br><span class="line"><span class="keyword">import</span> includes <span class="keyword">from</span> <span class="string">'core-js/library/fn/string/virtual/includes'</span>;</span><br><span class="line"><span class="keyword">import</span> repeat <span class="keyword">from</span> <span class="string">'core-js/library/fn/string/virtual/repeat'</span>;</span><br><span class="line"><span class="keyword">import</span> assign <span class="keyword">from</span> <span class="string">'core-js/library/fn/object/assign'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'core-js/es6/map'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'core-js/es6/set'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add your polyfills</span></span><br><span class="line"><span class="comment">// This files runs at the very beginning (even before React and Next.js core)</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Load your polyfills'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">String</span>.prototype.includes = includes;</span><br><span class="line"><span class="built_in">String</span>.prototype.repeat = repeat;</span><br><span class="line"><span class="built_in">Object</span>.assign = assign;</span><br></pre></td></tr></table></figure><h4 id="How-to-alias-folder-path"><a href="#How-to-alias-folder-path" class="headerlink" title="How to alias folder path?"></a>How to alias folder path?</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// next.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// config alias</span></span><br><span class="line">config.resolve.alias[<span class="string">'@containers'</span>] =</span><br><span class="line">  path.resolve(__dirname, <span class="string">'./src/containers'</span>);</span><br></pre></td></tr></table></figure><h4 id="Config-the-next-config-js"><a href="#Config-the-next-config-js" class="headerlink" title="Config the next.config.js"></a>Config the next.config.js</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// next.config.js</span></span><br><span class="line">...</span><br><span class="line">webpack: <span class="function"><span class="keyword">function</span> (<span class="params">cfg</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> originalEntry = cfg.entry</span><br><span class="line">    cfg.entry = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> entries = <span class="keyword">await</span> originalEntry()</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        entries[<span class="string">'main.js'</span>] &amp;&amp;</span><br><span class="line">        !entries[<span class="string">'main.js'</span>].includes(<span class="string">'./core/polyfills.js'</span>)</span><br><span class="line">      ) &#123;</span><br><span class="line">        entries[<span class="string">'main.js'</span>].unshift(<span class="string">'./core/polyfills.js'</span>)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> entries</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cfg</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h4 id="Downgrade-your-Next-version-to-â€˜7-0-2â€™"><a href="#Downgrade-your-Next-version-to-â€˜7-0-2â€™" class="headerlink" title="Downgrade your Next version to â€˜7.0.2â€™"></a>Downgrade your Next version to â€˜7.0.2â€™</h4><h2 id="The-ant-design-style-flash-when-page-refresh"><a href="#The-ant-design-style-flash-when-page-refresh" class="headerlink" title="The ant-design style flash when page refresh!"></a>The ant-design style flash when page refresh!</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// _app.js -&gt; getInitialProps</span></span><br><span class="line">  <span class="comment">/* åˆ·æ–°é¡µé¢ antdé—ªåŠ¨ */</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">"undefined"</span>) &#123;</span><br><span class="line">    <span class="built_in">window</span>.onload = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">document</span>.getElementById(<span class="string">"flashStyle"</span>).remove();</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// _app.js -&gt; &lt;Head&gt;&lt;/Head&gt;</span></span><br><span class="line">&lt;style</span><br><span class="line">  id=<span class="string">'flashStyle'</span></span><br><span class="line">  dangerouslySetInnerHTML=&#123;&#123;</span><br><span class="line">    __html: <span class="string">`</span></span><br><span class="line"><span class="string">      *, *::before, *::after &#123;</span></span><br><span class="line"><span class="string">        transition: none!important;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">  &#125;&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure><h2 id="How-to-speed-up-packing-in-production"><a href="#How-to-speed-up-packing-in-production" class="headerlink" title="How to speed up packing in production?"></a>How to speed up packing in production?</h2><h4 id="1-tenser-webpack-plugin-gt-cache"><a href="#1-tenser-webpack-plugin-gt-cache" class="headerlink" title="1. tenser-webpack-plugin -&gt; cache"></a>1. tenser-webpack-plugin -&gt; cache</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> TerserPlugin(&#123;</span><br><span class="line">  cache: <span class="literal">true</span>, <span class="comment">// add this line</span></span><br><span class="line">  terserOptions: &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure><h4 id="2-Add-thread-loader"><a href="#2-Add-thread-loader" class="headerlink" title="2. Add thread-loader"></a>2. Add thread-loader</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">config.module.rules.push(&#123;</span><br><span class="line">  test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">  include: [</span><br><span class="line">    path.resolve(<span class="string">'src'</span>)</span><br><span class="line">    ...</span><br><span class="line">  ],</span><br><span class="line">  options: &#123;</span><br><span class="line">    workerParallelJobs: <span class="number">50</span>,</span><br><span class="line">    <span class="comment">// additional node.js arguments</span></span><br><span class="line">    workerNodeArgs: [<span class="string">'--max-old-space-size=1024'</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  loader: <span class="string">'thread-loader'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="How-to-optimize-bundle-size"><a href="#How-to-optimize-bundle-size" class="headerlink" title="How to optimize bundle size?"></a>How to optimize bundle size?</h2><h4 id="Optimize-moment-local"><a href="#Optimize-moment-local" class="headerlink" title="Optimize moment local."></a>Optimize moment local.</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// next.config.js</span></span><br><span class="line"><span class="keyword">const</span> myWebpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line">...</span><br><span class="line"><span class="keyword">new</span> myWebpack.ContextReplacementPlugin(<span class="regexp">/moment[\/\\]locale$/</span>, /zh-cn|en/),</span><br></pre></td></tr></table></figure><h4 id="Optimize-antd-icon-dist"><a href="#Optimize-antd-icon-dist" class="headerlink" title="Optimize antd icon dist."></a>Optimize antd icon dist.</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// next.config.js</span></span><br><span class="line">...</span><br><span class="line">config.resolve.alias[<span class="string">'@ant-design/icons/lib/dist$'</span>] = path.resolve(__dirname, <span class="string">'./assets/icons.js'</span>);</span><br><span class="line"><span class="comment">// /assets/icons.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½ è‡ªå·±æ‰‹åŠ¨å¼•å…¥çš„Iconï¼Œé»˜è®¤æ˜¯outline</span></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  <span class="keyword">default</span> <span class="keyword">as</span> LoginOutline</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'@ant-design/icons/lib/outline/LoginOutline'</span>;</span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  <span class="keyword">default</span> <span class="keyword">as</span> LogoutOutline</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'@ant-design/icons/lib/outline/LogoutOutline'</span>;</span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  <span class="keyword">default</span> <span class="keyword">as</span> UserOutline</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'@ant-design/icons/lib/outline/UserOutline'</span>;</span><br><span class="line">...</span><br><span class="line"><span class="comment">// ä¸‹é¢çš„ ä¸æ˜¯è‡ªå·±å¼•å…¥çš„ï¼Œè€Œæ˜¯å†…ç½®ç»„ä»¶å¼•å…¥çš„ï¼Œæ¯”å¦‚Input/Select/Datepickerç­‰</span></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  <span class="keyword">default</span> <span class="keyword">as</span> SearchOutline</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'@ant-design/icons/lib/outline/SearchOutline'</span>;</span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  <span class="keyword">default</span> <span class="keyword">as</span> DownOutline</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'@ant-design/icons/lib/outline/DownOutline'</span>;</span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  <span class="keyword">default</span> <span class="keyword">as</span> UpOutline</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'@ant-design/icons/lib/outline/UpOutline'</span>;</span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  <span class="keyword">default</span> <span class="keyword">as</span> CalendarOutline</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'@ant-design/icons/lib/outline/CalendarOutline'</span>;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">const</span> withSass = <span class="built_in">require</span>(<span class="string">'@zeit/next-sass'</span>)</span><br><span class="line"><span class="keyword">const</span> withCss = <span class="built_in">require</span>(<span class="string">'@zeit/next-css'</span>);</span><br><span class="line"><span class="keyword">const</span> withBundleAnalyzer = <span class="built_in">require</span>(<span class="string">"@zeit/next-bundle-analyzer"</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PROD_FILE = <span class="string">"./config/prod.json"</span>;</span><br><span class="line"><span class="keyword">const</span> DEV_FILE = <span class="string">"./config/dev.json"</span>;</span><br><span class="line"><span class="keyword">const</span> LOCAL_FILE = <span class="string">"./config/local.json"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> readConfig = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> prod = fs.existsSync(PROD_FILE);</span><br><span class="line"><span class="keyword">if</span> (prod) &#123;</span><br><span class="line"><span class="keyword">return</span> fs.readFileSync(PROD_FILE)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (process.env.NODE_ENV === <span class="string">'production'</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> fs.readFileSync(DEV_FILE)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fs.readFileSync(LOCAL_FILE)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// return prod ?</span></span><br><span class="line"><span class="comment">// fs.readFileSync(PROD_FILE) :</span></span><br><span class="line"><span class="comment">// !fs.existsSync(LOCAL_FILE) ?</span></span><br><span class="line"><span class="comment">// fs.readFileSync(DEV_FILE) :</span></span><br><span class="line"><span class="comment">// fs.readFileSync(LOCAL_FILE)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// fix: prevents error when .css files are required by node</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">require</span> !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line"><span class="built_in">require</span>.extensions[<span class="string">'.css'</span>] = <span class="function"><span class="params">file</span> =&gt;</span> &#123;&#125;</span><br><span class="line"><span class="built_in">require</span>.extensions[<span class="string">'.scss'</span>] = <span class="function"><span class="params">file</span> =&gt;</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">JSON</span>.parse(readConfig().toString());</span><br><span class="line"><span class="comment">// console.log("config is  :", config);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> webpackConfig = <span class="function">(<span class="params">config, &#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">const</span> originalEntry = config.entry;</span><br><span class="line">    config.entry = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line"><span class="keyword">const</span> entries = <span class="keyword">await</span> originalEntry();</span><br><span class="line"><span class="keyword">if</span> (entries[<span class="string">'main.js'</span>]) &#123;</span><br><span class="line">entries[<span class="string">'main.js'</span>].unshift(<span class="string">'./polyfills.js'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> entries;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">config.module.rules.push(&#123;</span><br><span class="line">test: [<span class="regexp">/\.bmp$/</span>, /\.gif$/, /\.jpe?g$/, /\.png$/],</span><br><span class="line">use: [&#123;</span><br><span class="line">loader: <span class="string">'url-loader'</span>,</span><br><span class="line">options: &#123;</span><br><span class="line">limit: <span class="number">10000</span>,</span><br><span class="line">name: <span class="string">'static/media/[name].[hash:8].[ext]'</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;]</span><br><span class="line">&#125;),</span><br><span class="line">config.plugins.push(</span><br><span class="line"><span class="keyword">new</span> webpack.ContextReplacementPlugin(<span class="regexp">/moment[/\\]locale$/</span>, /zh-cn|en/),</span><br><span class="line">);</span><br><span class="line"><span class="comment">// comstom antd icon</span></span><br><span class="line">config.resolve.alias[<span class="string">"@ant-design/icons/lib/dist$"</span>] = path.resolve(__dirname, <span class="string">'./common/icon.ts'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> config;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = withSass(withCss(withBundleAnalyzer(&#123;</span><br><span class="line">analyzeServer: [<span class="string">"server"</span>, <span class="string">"both"</span>].includes(</span><br><span class="line">process.env.BUNDLE_ANALYZE</span><br><span class="line">),</span><br><span class="line">analyzeBrowser: [<span class="string">"browser"</span>, <span class="string">"both"</span>].includes(</span><br><span class="line">process.env.BUNDLE_ANALYZE</span><br><span class="line">),</span><br><span class="line">bundleAnalyzerConfig: &#123;</span><br><span class="line">server: &#123;</span><br><span class="line">analyzerMode: <span class="string">"static"</span>,</span><br><span class="line">reportFilename: <span class="string">"../bundles/server.html"</span></span><br><span class="line">&#125;,</span><br><span class="line">browser: &#123;</span><br><span class="line">analyzerMode: <span class="string">"static"</span>,</span><br><span class="line">reportFilename: <span class="string">"../bundles/client.html"</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">serverRuntimeConfig: config.server,</span><br><span class="line">publicRuntimeConfig: config.client,</span><br><span class="line">distDir: <span class="string">"_next"</span>,</span><br><span class="line">webpack: webpackConfig,</span><br><span class="line">assetPrefix: process.env.NODE_CDN == <span class="string">"true"</span> &amp;&amp; config ?</span><br><span class="line">config.deploy.host + config.deploy.version : <span class="string">""</span></span><br><span class="line">&#125;)));</span><br></pre></td></tr></table></figure><p>Thanks: <a href="https://github.com/luffyZh" target="_blank" rel="noopener">luffyZh</a> <a href="https://github.com/luffyZh/next-antd-scaffold/commit/420cdf9f4d00ba8d823fcb61ebaa35556337e7cb" target="_blank" rel="noopener">update FAQ</a></p>]]></content>
    
    <summary type="html">
    
      Next.js - ä¸€äº›é—®é¢˜ï¼Œå¸¸è§çš„é—®é¢˜ï¼Œé…ç½®
    
    </summary>
    
      <category term="é»˜è®¤åˆ†ç±»" scheme="https://kitions.github.io/categories/%E9%BB%98%E8%AE%A4%E5%88%86%E7%B1%BB/"/>
    
    
      <category term="next.js" scheme="https://kitions.github.io/tags/next-js/"/>
    
  </entry>
  
  <entry>
    <title>golang ä¸€ç»´æ•°ç»„å˜äºŒç»´æ•°ç»„ï¼Œæ ¹æ®å­—æ®µæ’åºéšæœº</title>
    <link href="https://kitions.github.io/2019/12/30/golang%E4%B8%80%E7%BB%B4%E6%95%B0%E7%BB%84%E5%8F%98%E4%BA%8C%E7%BB%B4%E6%95%B0%E7%BB%84%EF%BC%8C%E6%A0%B9%E6%8D%AE%E5%AD%97%E6%AE%B5%E6%8E%92%E5%BA%8F%E9%9A%8F%E6%9C%BA/"/>
    <id>https://kitions.github.io/2019/12/30/golangä¸€ç»´æ•°ç»„å˜äºŒç»´æ•°ç»„ï¼Œæ ¹æ®å­—æ®µæ’åºéšæœº/</id>
    <published>2019-12-30T03:15:37.000Z</published>
    <updated>2019-12-30T03:16:33.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="golang-ä¸€ç»´æ•°ç»„å˜äºŒç»´æ•°ç»„ï¼Œæ ¹æ®å­—æ®µæ’åºéšæœº"><a href="#golang-ä¸€ç»´æ•°ç»„å˜äºŒç»´æ•°ç»„ï¼Œæ ¹æ®å­—æ®µæ’åºéšæœº" class="headerlink" title="golang ä¸€ç»´æ•°ç»„å˜äºŒç»´æ•°ç»„ï¼Œæ ¹æ®å­—æ®µæ’åºéšæœº"></a>golang ä¸€ç»´æ•°ç»„å˜äºŒç»´æ•°ç»„ï¼Œæ ¹æ®å­—æ®µæ’åºéšæœº</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"encoding/json"</span></span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"math/rand"</span></span><br><span class="line"><span class="string">"sort"</span></span><br><span class="line"><span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> DemoItemModel <span class="keyword">struct</span> &#123;</span><br><span class="line">ID        <span class="keyword">int</span>    <span class="string">`json:"id"`</span></span><br><span class="line">Name      <span class="keyword">string</span> <span class="string">`json:"name"`</span></span><br><span class="line">SortValue <span class="keyword">int</span>    <span class="string">`json:"sort_value"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> DemoModel []DemoItemModel</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SortKeys []<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Groups <span class="keyword">struct</span> &#123;</span><br><span class="line">sortNum SortKeys</span><br><span class="line">data    <span class="keyword">map</span>[<span class="keyword">int</span>]DemoModel</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s SortKeys)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span>           &#123; <span class="keyword">return</span> <span class="built_in">len</span>(s) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s SortKeys)</span> <span class="title">Swap</span><span class="params">(i, j <span class="keyword">int</span>)</span></span>      &#123; s[i], s[j] = s[j], s[i] &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s SortKeys)</span> <span class="title">Less</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123; <span class="keyword">return</span> s[i] &lt; s[j] &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewGroups</span><span class="params">()</span> *<span class="title">Groups</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> &amp;Groups&#123;</span><br><span class="line">sortNum: <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>),</span><br><span class="line">data:    <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]DemoModel, <span class="number">0</span>),</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *Groups)</span> <span class="title">sortKey</span><span class="params">()</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">sort.Sort(a.sortNum)</span><br><span class="line"><span class="keyword">return</span> a.sortNum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *Groups)</span> <span class="title">append</span><span class="params">(key <span class="keyword">int</span>, item DemoItemModel)</span></span> &#123;</span><br><span class="line">a.data[key] = <span class="built_in">append</span>(a.data[key], item)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewGroup</span><span class="params">()</span> <span class="title">DemoModel</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">make</span>([]DemoItemModel, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *Groups)</span> <span class="title">Add</span><span class="params">(num <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">a.sortNum = <span class="built_in">append</span>(a.sortNum, num)</span><br><span class="line">a.data[num] = NewGroup()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *Groups)</span> <span class="title">Exits</span><span class="params">(num <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> a.data[num] == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetRandomItems</span><span class="params">(a DemoModel)</span> []<span class="title">DemoItemModel</span></span> &#123;</span><br><span class="line">groups := NewGroups()</span><br><span class="line"><span class="keyword">for</span> _, item := <span class="keyword">range</span> a &#123;</span><br><span class="line">sort := item.SortValue</span><br><span class="line"><span class="keyword">if</span> !groups.Exits(sort) &#123;</span><br><span class="line">groups.Add(sort)</span><br><span class="line">&#125;</span><br><span class="line">groups.<span class="built_in">append</span>(sort, item)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> groups.Sort()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *DemoModel)</span> <span class="title">Random</span><span class="params">()</span> <span class="title">DemoModel</span></span> &#123;</span><br><span class="line">length := <span class="built_in">len</span>(*a)</span><br><span class="line">temp := <span class="built_in">make</span>([]DemoItemModel, <span class="number">0</span>)</span><br><span class="line">r := rand.New(rand.NewSource(time.Now().UnixNano()))</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">random := r.Intn(length)</span><br><span class="line">temp = <span class="built_in">append</span>(temp, (*a)[random])</span><br><span class="line">*a = <span class="built_in">append</span>((*a)[:random], (*a)[random+<span class="number">1</span>:]...)</span><br><span class="line">length = <span class="built_in">len</span>(*a)</span><br><span class="line"><span class="keyword">if</span> length &lt; <span class="number">1</span> &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">*a = temp</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> temp</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *Groups)</span> <span class="title">Sort</span><span class="params">()</span> []<span class="title">DemoItemModel</span></span> &#123;</span><br><span class="line">temp := <span class="built_in">make</span>([]DemoItemModel, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">for</span> _, item := <span class="keyword">range</span> a.sortKey() &#123;</span><br><span class="line">data := a.data[item]</span><br><span class="line">temp = <span class="built_in">append</span>(temp, data.Random()...)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> temp</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">objString := <span class="string">`[&#123;"id":1,"name":"1-1","sort_value":1&#125;,&#123;"id":2,"name":"1-2","sort_value":1&#125;,&#123;"id":3,"name":"2-1","sort_value":2&#125;,&#123;"id":4,"name":"2-2","sort_value":2&#125;,&#123;"id":5,"name":"2-3","sort_value":2&#125;,&#123;"id":6,"name":"5-1","sort_value":5&#125;]`</span></span><br><span class="line"><span class="keyword">var</span> someOne []DemoItemModel</span><br><span class="line"><span class="keyword">if</span> err := json.Unmarshal([]<span class="keyword">byte</span>(objString), &amp;someOne); err == <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"================json str è½¬struct=="</span>)</span><br><span class="line">fmt.Println(someOne)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">fmt.Println(err)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(<span class="number">22</span>, GetRandomItems(someOne))</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      golang ä¸€ç»´æ•°ç»„å˜äºŒç»´æ•°ç»„ï¼Œjsonæ ¹æ®sortå­—æ®µéšæœºæ’åº
    
    </summary>
    
      <category term="é»˜è®¤åˆ†ç±»" scheme="https://kitions.github.io/categories/%E9%BB%98%E8%AE%A4%E5%88%86%E7%B1%BB/"/>
    
    
      <category term="go" scheme="https://kitions.github.io/tags/go/"/>
    
  </entry>
  
  <entry>
    <title>gitignoreè§„åˆ™ä¸ç”Ÿæ•ˆ</title>
    <link href="https://kitions.github.io/2019/10/11/gitignore/"/>
    <id>https://kitions.github.io/2019/10/11/gitignore/</id>
    <published>2019-10-11T09:04:52.000Z</published>
    <updated>2019-10-11T09:09:55.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="gitignore"><a href="#gitignore" class="headerlink" title=".gitignore"></a>.gitignore</h1><p>è§„åˆ™ ä½œç”¨<br>/mtk è¿‡æ»¤æ•´ä¸ªæ–‡ä»¶å¤¹<br>*.zip è¿‡æ»¤æ‰€æœ‰.zipæ–‡ä»¶<br>/mtk/do.c è¿‡æ»¤æŸä¸ªå…·ä½“æ–‡ä»¶<br>!/mtk/one.txt è¿½è¸ªï¼ˆä¸è¿‡æ»¤ï¼‰æŸä¸ªå…·ä½“æ–‡ä»¶<br>æ³¨æ„ï¼šå¦‚æœä½ åˆ›å»º.gitignoreæ–‡ä»¶ä¹‹å‰å°±pushäº†æŸä¸€æ–‡ä»¶ï¼Œé‚£ä¹ˆå³ä½¿ä½ åœ¨.gitignoreæ–‡ä»¶ä¸­å†™å…¥è¿‡æ»¤è¯¥æ–‡ä»¶çš„è§„åˆ™ï¼Œè¯¥è§„åˆ™ä¹Ÿä¸ä¼šèµ·ä½œç”¨ï¼Œgitä»ç„¶ä¼šå¯¹è¯¥æ–‡ä»¶è¿›è¡Œç‰ˆæœ¬ç®¡ç†ã€‚</p><p>é…ç½®è¯­æ³•<br>ä»¥æ–œæ â€œ/â€å¼€å¤´è¡¨ç¤ºç›®å½•ï¼›<br>ä»¥æ˜Ÿå·â€œ*â€é€šé…å¤šä¸ªå­—ç¬¦ï¼›<br>ä»¥é—®å·â€œ?â€é€šé…å•ä¸ªå­—ç¬¦<br>ä»¥æ–¹æ‹¬å·â€œ[]â€åŒ…å«å•ä¸ªå­—ç¬¦çš„åŒ¹é…åˆ—è¡¨ï¼›<br>ä»¥å¹å·â€œ!â€è¡¨ç¤ºä¸å¿½ç•¥(è·Ÿè¸ª)åŒ¹é…åˆ°çš„æ–‡ä»¶æˆ–ç›®å½•ã€‚<br>æ³¨æ„ï¼š git å¯¹äº .gitignoreé…ç½®æ–‡ä»¶æ˜¯æŒ‰è¡Œä»ä¸Šåˆ°ä¸‹è¿›è¡Œè§„åˆ™åŒ¹é…çš„</p><h2 id="gitignoreè§„åˆ™ä¸ç”Ÿæ•ˆ"><a href="#gitignoreè§„åˆ™ä¸ç”Ÿæ•ˆ" class="headerlink" title=".gitignoreè§„åˆ™ä¸ç”Ÿæ•ˆ"></a>.gitignoreè§„åˆ™ä¸ç”Ÿæ•ˆ</h2><p>.gitignoreåªèƒ½å¿½ç•¥é‚£äº›åŸæ¥æ²¡æœ‰è¢«trackçš„æ–‡ä»¶ï¼Œå¦‚æœæŸäº›æ–‡ä»¶å·²ç»è¢«çº³å…¥äº†ç‰ˆæœ¬ç®¡ç†ä¸­ï¼Œåˆ™ä¿®æ”¹.gitignoreæ˜¯æ— æ•ˆçš„ã€‚</p><p>è§£å†³æ–¹æ³•å°±æ˜¯å…ˆæŠŠæœ¬åœ°ç¼“å­˜åˆ é™¤ï¼ˆæ”¹å˜æˆæœªtrackçŠ¶æ€ï¼‰ï¼Œç„¶åå†æäº¤:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git rm -r --cached .</span><br><span class="line">git <span class="keyword">add</span> .</span><br><span class="line">git commit -m <span class="string">'update .gitignore'</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      .gitignoreè§„åˆ™ä¸ç”Ÿæ•ˆ
    
    </summary>
    
      <category term="é»˜è®¤åˆ†ç±»" scheme="https://kitions.github.io/categories/%E9%BB%98%E8%AE%A4%E5%88%86%E7%B1%BB/"/>
    
    
  </entry>
  
  <entry>
    <title>åˆè¯†React-hooks</title>
    <link href="https://kitions.github.io/2019/06/20/React%20hooks/"/>
    <id>https://kitions.github.io/2019/06/20/React hooks/</id>
    <published>2019-06-20T03:53:52.000Z</published>
    <updated>2019-06-20T10:24:52.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="React-hooks"><a href="#React-hooks" class="headerlink" title="React hooks"></a>React hooks</h1><p><em>Hook</em> æ˜¯ React 16.8 çš„æ–°å¢ç‰¹æ€§ã€‚å®ƒå¯ä»¥è®©ä½ åœ¨ä¸ç¼–å†™ class çš„æƒ…å†µä¸‹ä½¿ç”¨ state ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§ï¼ˆç”Ÿå‘½å‘¨æœŸç­‰ç‰¹æ€§ï¼‰ã€‚</p><h2 id="0-èƒŒæ™¯"><a href="#0-èƒŒæ™¯" class="headerlink" title="0. èƒŒæ™¯"></a>0. èƒŒæ™¯</h2><p> é•¿æœŸä»¥æ¥å¾ˆå¤šäººä¼šæŠŠ <code>Stateless Component</code> å’Œ <code>Functional Component</code> æ··ä¸ºä¸€è°ˆï¼›</p><p> Hooks çš„å‡ºç°æœ¬è´¨æ˜¯æŠŠè¿™ç§<strong>é¢å‘ç”Ÿå‘½å‘¨æœŸç¼–ç¨‹</strong>å˜æˆäº†<strong>é¢å‘ä¸šåŠ¡é€»è¾‘ç¼–ç¨‹</strong>ï¼Œä½ ä¸ç”¨å†å»å…³å¿ƒæœ¬ä¸è¯¥å…³å¿ƒçš„ç”Ÿå‘½å‘¨æœŸï¼Œå†™æ³•ä¸Šå¸¦æ¥çš„ä¼˜åŒ–åªæ˜¯é¡ºå¸¦çš„ã€‚</p><h2 id="1-ä¼˜åŠ¿"><a href="#1-ä¼˜åŠ¿" class="headerlink" title="1. ä¼˜åŠ¿"></a>1. ä¼˜åŠ¿</h2><p>â€‹     å¸¦æ¥çš„å¥½å¤„ä¸ä»…æ˜¯ â€œæ›´ FPï¼Œæ›´æ–°ç²’åº¦æ›´ç»†ï¼Œä»£ç æ›´æ¸…æ™°â€</p><p>å®˜æ–¹ï¼š</p><ul><li><strong>å®Œå…¨å¯é€‰çš„ã€‚</strong> ä½ æ— éœ€é‡å†™ä»»ä½•å·²æœ‰ä»£ç å°±å¯ä»¥åœ¨ä¸€äº›ç»„ä»¶ä¸­å°è¯• Hookã€‚ä½†æ˜¯å¦‚æœä½ ä¸æƒ³ï¼Œä½ ä¸å¿…ç°åœ¨å°±å»å­¦ä¹ æˆ–ä½¿ç”¨ Hookã€‚</li><li><strong>100% å‘åå…¼å®¹çš„ã€‚</strong> Hook ä¸åŒ…å«ä»»ä½•ç ´åæ€§æ”¹åŠ¨ã€‚</li><li><strong>ç°åœ¨å¯ç”¨ã€‚</strong>  v16.8.0ä»¥åç‰ˆæœ¬éƒ½å¯ä»¥ä½¿ç”¨ã€‚</li><li><strong>æ¸è¿›ç­–ç•¥</strong>ã€‚ Hook å’Œç°æœ‰ä»£ç å¯ä»¥åŒæ—¶å·¥ä½œï¼Œä½ å¯ä»¥æ¸è¿›å¼åœ°ä½¿ç”¨ä»–ä»¬ã€‚</li></ul><p>éå®˜æ–¹ï¼š</p><ul><li>æ›´å®¹æ˜“å°†ç»„ä»¶çš„ UI ä¸çŠ¶æ€åˆ†ç¦», çŠ¶æ€ä¸ UI çš„ç•Œé™ä¼šè¶Šæ¥è¶Šæ¸…æ™°ã€‚</li><li>å¤šä¸ªçŠ¶æ€ä¸ä¼šäº§ç”ŸåµŒå¥—ï¼Œå†™æ³•è¿˜æ˜¯å¹³é“ºçš„</li><li>Hooks å¯ä»¥å¼•ç”¨å…¶ä»– Hooksã€‚</li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Example</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      count : <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;<span class="keyword">this</span>.state.count&#125; times&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;() =&gt; this.setState(&#123;count:this.state.count + 1&#125;)&#125;&gt;</span></span><br><span class="line"><span class="regexp">        Click me</span></span><br><span class="line"><span class="regexp">      &lt;/</span>button&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Example</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å£°æ˜ä¸€ä¸ªå« â€œcountâ€ çš„ state å˜é‡ã€‚</span></span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span></span><br><span class="line"><span class="regexp">        Click me</span></span><br><span class="line"><span class="regexp">      &lt;/</span>button&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>Example</code>å˜æˆäº†ä¸€ä¸ªå‡½æ•°ï¼Œä½†è¿™ä¸ªå‡½æ•°å´æœ‰è‡ªå·±çš„çŠ¶æ€ï¼ˆcountï¼‰ï¼ŒåŒæ—¶å®ƒè¿˜å¯ä»¥æ›´æ–°è‡ªå·±çš„çŠ¶æ€ï¼ˆsetCountï¼‰ã€‚è¿™ä¸ªå‡½æ•°ä¹‹æ‰€ä»¥è¿™ä¹ˆäº†ä¸å¾—ï¼Œå°±æ˜¯å› ä¸ºå®ƒæ³¨å…¥äº†ä¸€ä¸ªhookâ€“<code>useState</code>ï¼Œå°±æ˜¯è¿™ä¸ªhookè®©æˆ‘ä»¬çš„å‡½æ•°å˜æˆäº†ä¸€ä¸ªæœ‰çŠ¶æ€çš„å‡½æ•°ã€‚</p><h2 id="2-åŠ¨æœº"><a href="#2-åŠ¨æœº" class="headerlink" title="2. åŠ¨æœº"></a>2. åŠ¨æœº</h2><h3 id="ï¼ˆ1ï¼‰æœ‰çŠ¶æ€çš„ç»„ä»¶ä¹‹é—´å¤ç”¨çŠ¶æ€é€»è¾‘å¾ˆéš¾"><a href="#ï¼ˆ1ï¼‰æœ‰çŠ¶æ€çš„ç»„ä»¶ä¹‹é—´å¤ç”¨çŠ¶æ€é€»è¾‘å¾ˆéš¾" class="headerlink" title="ï¼ˆ1ï¼‰æœ‰çŠ¶æ€çš„ç»„ä»¶ä¹‹é—´å¤ç”¨çŠ¶æ€é€»è¾‘å¾ˆéš¾"></a>ï¼ˆ1ï¼‰æœ‰çŠ¶æ€çš„ç»„ä»¶ä¹‹é—´å¤ç”¨çŠ¶æ€é€»è¾‘å¾ˆéš¾</h3><p>é—®é¢˜ï¼šReact éœ€è¦ä¸ºå…±äº«çŠ¶æ€é€»è¾‘æä¾›æ›´å¥½çš„åŸç”Ÿé€”å¾„ã€‚</p><p>è§£å†³ï¼šHook ä½¿ä½ åœ¨æ— éœ€ä¿®æ”¹ç»„ä»¶ç»“æ„çš„æƒ…å†µä¸‹å¤ç”¨çŠ¶æ€é€»è¾‘</p><p>æˆ‘ä»¬éƒ½çŸ¥é“reactçš„<strong>æ ¸å¿ƒæ€æƒ³</strong>å°±æ˜¯ï¼Œå°†ä¸€ä¸ªé¡µé¢æ‹†æˆä¸€å †ç‹¬ç«‹çš„ï¼Œå¯å¤ç”¨çš„ç»„ä»¶ï¼Œå¹¶ä¸”ç”¨è‡ªä¸Šè€Œä¸‹çš„å•å‘æ•°æ®æµçš„å½¢å¼å°†è¿™äº›ç»„ä»¶ä¸²è”èµ·æ¥ã€‚ä½†å‡å¦‚ä½ åœ¨å¤§å‹çš„å·¥ä½œé¡¹ç›®ä¸­ç”¨reactï¼Œä½ ä¼šå‘ç°ä½ çš„é¡¹ç›®ä¸­å®é™…ä¸Šå¾ˆå¤šreactç»„ä»¶å†—é•¿ä¸”éš¾ä»¥å¤ç”¨ã€‚å°¤å…¶æ˜¯é‚£äº›å†™æˆclassçš„ç»„ä»¶ï¼Œå®ƒä»¬æœ¬èº«åŒ…å«äº†çŠ¶æ€ï¼ˆstateï¼‰ï¼Œæ‰€ä»¥å¤ç”¨è¿™ç±»ç»„ä»¶å°±å˜å¾—å¾ˆéº»çƒ¦ã€‚</p><p>ä¹‹å‰ï¼Œå®˜æ–¹æ¨èæ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼š<a href="https://reactjs.org/docs/render-props.html" target="_blank" rel="noopener">æ¸²æŸ“å±æ€§ï¼ˆRender Propsï¼‰</a>å’Œ<a href="https://segmentfault.com/img/bVbjfuz" target="_blank" rel="noopener">é«˜é˜¶ç»„ä»¶ï¼ˆHigher-Order Componentsï¼‰</a>ã€‚æˆ‘ä»¬å¯ä»¥ç¨å¾®è·‘ä¸‹é¢˜ç®€å•çœ‹ä¸€ä¸‹è¿™ä¸¤ç§æ¨¡å¼ã€‚</p><h4 id="æ¸²æŸ“å±æ€§ï¼ˆRender-Propsï¼‰"><a href="#æ¸²æŸ“å±æ€§ï¼ˆRender-Propsï¼‰" class="headerlink" title="- æ¸²æŸ“å±æ€§ï¼ˆRender Propsï¼‰"></a>- æ¸²æŸ“å±æ€§ï¼ˆRender Propsï¼‰</h4><p>æ¸²æŸ“å±æ€§æŒ‡çš„æ˜¯ä½¿ç”¨ä¸€ä¸ªå€¼ä¸ºå‡½æ•°çš„propæ¥ä¼ é€’éœ€è¦åŠ¨æ€æ¸²æŸ“çš„nodesæˆ–ç»„ä»¶ã€‚å¦‚ä¸‹é¢çš„ä»£ç å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„<code>DataProvider</code>ç»„ä»¶åŒ…å«äº†æ‰€æœ‰è·ŸçŠ¶æ€ç›¸å…³çš„ä»£ç ï¼Œè€Œ<code>Cat</code>ç»„ä»¶åˆ™å¯ä»¥æ˜¯ä¸€ä¸ªå•çº¯çš„å±•ç¤ºå‹ç»„ä»¶ï¼Œè¿™æ ·ä¸€æ¥<code>DataProvider</code>å°±å¯ä»¥å•ç‹¬å¤ç”¨äº†ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Cat <span class="keyword">from</span> <span class="string">'components/cat'</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DataProvider</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123; <span class="attr">target</span>: <span class="string">'Zac'</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &#123;<span class="keyword">this</span>.props.render(<span class="keyword">this</span>.state)&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;DataProvider render=&#123;data =&gt; (</span></span><br><span class="line"><span class="regexp">  &lt;Cat target=&#123;data.target&#125; /</span>&gt;</span><br><span class="line">)&#125;/&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸Šä¸‹ç­‰åŒ</span></span><br><span class="line">&lt;DataProvider&gt;</span><br><span class="line">  &#123;data =&gt; (</span><br><span class="line">    &lt;Cat target=&#123;data.target&#125; /&gt;</span><br><span class="line">  )&#125;</span><br><span class="line">&lt;<span class="regexp">/DataProvider&gt;</span></span><br></pre></td></tr></table></figure><h4 id="é«˜é˜¶ç»„ä»¶"><a href="#é«˜é˜¶ç»„ä»¶" class="headerlink" title="- é«˜é˜¶ç»„ä»¶"></a>- é«˜é˜¶ç»„ä»¶</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> withUser = <span class="function"><span class="params">WrappedComponent</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> user = sessionStorage.getItem(<span class="string">"user"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">props</span> =&gt;</span> &lt;WrappedComponent user=&#123;user&#125; &#123;...props&#125; /&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> UserPage = <span class="function"><span class="params">props</span> =&gt;</span> (</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"user-container"</span>&gt;</span><br><span class="line">    &lt;p&gt;My name is &#123;props.user&#125;!<span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default withUser(UserPage);</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šè¿™ä¸¤ç§æ¨¡å¼çœ‹ä¸Šå»éƒ½æŒºä¸é”™çš„ï¼Œå¾ˆå¤šåº“ä¹Ÿè¿ç”¨äº†è¿™ç§æ¨¡å¼ï¼Œä½†æˆ‘ä»¬ä»”ç»†çœ‹è¿™ä¸¤ç§æ¨¡å¼ï¼Œä¼šå‘ç°å®ƒä»¬ä¼šå¢åŠ æˆ‘ä»¬ä»£ç çš„å±‚çº§å…³ç³»ï¼Œè¿™æ—¶å€™å†å›è¿‡å¤´çœ‹hooksä¾‹å­ï¼Œæ˜¯ä¸æ˜¯ç®€æ´å¤šäº†ï¼Œæ²¡æœ‰å¤šä½™çš„å±‚çº§åµŒå¥—</p><p><img src="https://img.alicdn.com/tfs/TB1oipbryrpK1RjSZFhXXXSdXXa-2048-860.jpg" alt="img"></p><h3 id="ï¼ˆ2ï¼‰å¤æ‚ç»„ä»¶å˜å¾—éš¾ä»¥ç†è§£"><a href="#ï¼ˆ2ï¼‰å¤æ‚ç»„ä»¶å˜å¾—éš¾ä»¥ç†è§£" class="headerlink" title="ï¼ˆ2ï¼‰å¤æ‚ç»„ä»¶å˜å¾—éš¾ä»¥ç†è§£"></a>ï¼ˆ2ï¼‰å¤æ‚ç»„ä»¶å˜å¾—éš¾ä»¥ç†è§£</h3><p>é—®é¢˜ï¼šç»„ä»¶èµ·åˆå¾ˆç®€å•ï¼Œä½†æ˜¯é€æ¸ä¼šè¢«çŠ¶æ€é€»è¾‘å’Œå‰¯ä½œç”¨å……æ–¥ã€‚ç›¸äº’å…³è”ä¸”éœ€è¦å¯¹ç…§ä¿®æ”¹çš„ä»£ç è¢«è¿›è¡Œäº†æ‹†åˆ†ï¼Œè€Œå®Œå…¨ä¸ç›¸å…³çš„ä»£ç å´åœ¨åŒä¸€ä¸ªæ–¹æ³•ä¸­ç»„åˆåœ¨ä¸€èµ·</p><p>è§£å†³ï¼šHook å°†ç»„ä»¶ä¸­ç›¸äº’å…³è”çš„éƒ¨åˆ†æ‹†åˆ†æˆæ›´å°çš„å‡½æ•°ï¼ˆæ¯”å¦‚è®¾ç½®è®¢é˜…æˆ–è¯·æ±‚æ•°æ®ï¼‰</p><h3 id="ï¼ˆ3ï¼‰éš¾ä»¥ç†è§£çš„-class"><a href="#ï¼ˆ3ï¼‰éš¾ä»¥ç†è§£çš„-class" class="headerlink" title="ï¼ˆ3ï¼‰éš¾ä»¥ç†è§£çš„ class"></a>ï¼ˆ3ï¼‰éš¾ä»¥ç†è§£çš„ class</h3><p>é—®é¢˜ï¼šjsçš„<code>this</code> çš„å·¥ä½œæ–¹å¼ï¼›ç»‘å®šäº‹ä»¶å¤„ç†å™¨ï¼›å¯¹äºå‡½æ•°ç»„ä»¶ä¸ class ç»„ä»¶çš„å·®å¼‚ä¹Ÿå­˜åœ¨åˆ†æ­§</p><p>è§£å†³ï¼šHook ä½¿ä½ åœ¨é class çš„æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨æ›´å¤šçš„ React ç‰¹æ€§ï¼ŒHook åˆ™æ‹¥æŠ±äº†å‡½æ•°</p><p>æˆ‘ä»¬ç»å¸¸åœ¨å†™ä¸€ä¸ªç»„ä»¶çš„æ—¶å€™ï¼ŒæŠŠç»„ä»¶å†™æˆæ— çŠ¶æ€ç»„ä»¶çš„å½¢å¼ï¼Œè¿™æ ·æ›´æ–¹ä¾¿å¤ç”¨ï¼Œç‹¬ç«‹å•æ‰€ï¼Œç„¶è€Œå¾ˆå¤šæ—¶å€™ï¼Œç”¨SFC å†™äº†ä¸€ä¸ªç®€æ´å®Œç¾çš„æ— çŠ¶æ€ç»„ä»¶ï¼Œåæ¥å› ä¸ºéœ€æ±‚å˜åŠ¨ï¼Œå¿…é¡»å¾—æœ‰çŠ¶æ€ï¼Œåˆå¾—å¾ˆéº»çƒ¦çš„æ”¹æˆclassç»„ä»¶ã€‚å°±å¾ˆçƒ¦ï¼Œæœ‰äº†hookï¼Œå°±å¯ä»¥é¿å…è¿™æ ·çš„é—®é¢˜</p><h3 id="ï¼ˆ4ï¼‰ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°é‡Œçš„é€»è¾‘å¤ªä¹±ï¼"><a href="#ï¼ˆ4ï¼‰ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°é‡Œçš„é€»è¾‘å¤ªä¹±ï¼" class="headerlink" title="ï¼ˆ4ï¼‰ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°é‡Œçš„é€»è¾‘å¤ªä¹±ï¼"></a>ï¼ˆ4ï¼‰ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°é‡Œçš„é€»è¾‘å¤ªä¹±ï¼</h3><p>æˆ‘ä»¬é€šå¸¸å¸Œæœ›ä¸€ä¸ªå‡½æ•°åªåšä¸€ä»¶äº‹æƒ…ï¼Œä½†æˆ‘ä»¬çš„ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°é‡Œé€šå¸¸åŒæ—¶åšäº†å¾ˆå¤šäº‹æƒ…ã€‚æ¯”å¦‚æˆ‘ä»¬éœ€è¦åœ¨<code>componentDidMount</code>ä¸­å‘èµ·ajaxè¯·æ±‚è·å–æ•°æ®ï¼Œç»‘å®šä¸€äº›äº‹ä»¶ç›‘å¬ç­‰ç­‰ã€‚åŒæ—¶ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬è¿˜éœ€è¦åœ¨<code>componentDidUpdate</code>åšä¸€éåŒæ ·çš„äº‹æƒ…ã€‚å½“é¡¹ç›®å˜å¤æ‚åï¼Œè¿™ä¸€å—çš„ä»£ç ä¹Ÿå˜å¾—ä¸é‚£ä¹ˆç›´è§‚ã€‚</p><h2 id="3-useState"><a href="#3-useState" class="headerlink" title="3. useState"></a>3. useState</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Example</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><p><code>useState</code>æ˜¯reactè‡ªå¸¦çš„ä¸€ä¸ªhookå‡½æ•°ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯ç”¨æ¥å£°æ˜çŠ¶æ€å˜é‡ã€‚<code>useState</code>è¿™ä¸ªå‡½æ•°æ¥æ”¶çš„å‚æ•°æ˜¯æˆ‘ä»¬çš„çŠ¶æ€åˆå§‹å€¼ï¼ˆinitial stateï¼‰ï¼Œå®ƒè¿”å›äº†ä¸€ä¸ªæ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„çš„ç¬¬<code>[0]</code>é¡¹æ˜¯å½“å‰å½“å‰çš„çŠ¶æ€å€¼ï¼Œç¬¬<code>[1]</code>é¡¹æ˜¯å¯ä»¥æ”¹å˜çŠ¶æ€å€¼çš„æ–¹æ³•å‡½æ•°ã€‚</p><h3 id="è¯»å–çŠ¶æ€å€¼"><a href="#è¯»å–çŠ¶æ€å€¼" class="headerlink" title="è¯»å–çŠ¶æ€å€¼"></a>è¯»å–çŠ¶æ€å€¼</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;You clicked &#123;count&#125; times&lt;<span class="regexp">/p&gt;</span></span><br></pre></td></tr></table></figure><h3 id="æ›´æ–°çŠ¶æ€"><a href="#æ›´æ–°çŠ¶æ€" class="headerlink" title="æ›´æ–°çŠ¶æ€"></a>æ›´æ–°çŠ¶æ€</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;button onClick=&#123;() =&gt; setCount(count + <span class="number">1</span>)&#125;&gt;</span><br><span class="line">  Click me</span><br><span class="line">&lt;<span class="regexp">/button&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å¤šä¸ªçŠ¶æ€å€¼"><a href="#å¤šä¸ªçŠ¶æ€å€¼" class="headerlink" title="å¤šä¸ªçŠ¶æ€å€¼"></a>å¤šä¸ªçŠ¶æ€å€¼</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ExampleWithManyStates</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [age, setAge] = useState(<span class="number">42</span>);</span><br><span class="line">  <span class="keyword">const</span> [fruit, setFruit] = useState(<span class="string">'banana'</span>);</span><br><span class="line">  <span class="keyword">const</span> [todos, setTodos] = useState([&#123; <span class="attr">text</span>: <span class="string">'Learn Hooks'</span> &#125;]);</span><br></pre></td></tr></table></figure><p>ä»ExampleWithManyStateså‡½æ•°æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒuseStateæ— è®ºè°ƒç”¨å¤šå°‘æ¬¡ï¼Œç›¸äº’ä¹‹é—´æ˜¯ç‹¬ç«‹çš„</p><p>ï¼ˆ<a href="https://zh-hans.reactjs.org/docs/hooks-intro.html#gradual-adoption-strategy" target="_blank" rel="noopener">ä¸æ¨è</a>æŠŠä½ å·²æœ‰çš„ç»„ä»¶å…¨éƒ¨é‡å†™ï¼Œä½†æ˜¯ä½ å¯ä»¥åœ¨æ–°ç»„ä»¶é‡Œå¼€å§‹ä½¿ç”¨ Hookã€‚ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function Example() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  // ç›¸å½“äº componentDidMount å’Œ componentDidUpdate:</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    // ä½¿ç”¨æµè§ˆå™¨çš„ API æ›´æ–°é¡µé¢æ ‡é¢˜</span><br><span class="line">    document.title = `You clicked $&#123;count&#125; times`;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-useEffect"><a href="#4-useEffect" class="headerlink" title="4. useEffect"></a>4. useEffect</h2><p>å¯ä»¥æŠŠ <code>useEffect</code> Hook çœ‹åš <code>componentDidMount</code>ï¼Œ<code>componentDidUpdate</code> å’Œ <code>componentWillUnmount</code> è¿™ä¸‰ä¸ªå‡½æ•°çš„ç»„åˆã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒåœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¹‹å<em>å’Œ</em> æ¯æ¬¡æ›´æ–°ä¹‹åéƒ½ä¼šæ‰§è¡Œã€‚</p><h3 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">class Example extends React.Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      count: 0</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    document.title = `You clicked $&#123;this.state.count&#125; times`;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidUpdate() &#123;</span><br><span class="line">    document.title = `You clicked $&#123;this.state.count&#125; times`;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;p&gt;You clicked &#123;this.state.count&#125; times&lt;/p&gt;</span><br><span class="line">        &lt;button onClick=&#123;() =&gt; this.setState(&#123; count: this.state.count + 1 &#125;)&#125;&gt;</span><br><span class="line">          Click me</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="hook"><a href="#hook" class="headerlink" title="hook"></a>hook</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import &#123; useState, useEffect &#125; from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">function Example() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  // ç±»ä¼¼äºcomponentDidMount å’Œ componentDidUpdate:</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    // æ›´æ–°æ–‡æ¡£çš„æ ‡é¢˜</span><br><span class="line">    document.title = `You clicked $&#123;count&#125; times`;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>effect æœ‰å¯é€‰çš„æ¸…é™¤æœºåˆ¶ã€‚æ¯ä¸ª effect éƒ½å¯ä»¥è¿”å›ä¸€ä¸ªæ¸…é™¤å‡½æ•°ã€‚å¦‚æ­¤å¯ä»¥å°†æ·»åŠ å’Œç§»é™¤è®¢é˜…çš„é€»è¾‘æ”¾åœ¨ä¸€èµ·ã€‚å®ƒä»¬éƒ½å±äº effect çš„ä¸€éƒ¨åˆ†ã€‚</p><h3 id="React-ä½•æ—¶æ¸…é™¤-effectï¼Ÿ"><a href="#React-ä½•æ—¶æ¸…é™¤-effectï¼Ÿ" class="headerlink" title="React ä½•æ—¶æ¸…é™¤ effectï¼Ÿ"></a>React ä½•æ—¶æ¸…é™¤ effectï¼Ÿ</h3><p> React ä¼šåœ¨ç»„ä»¶å¸è½½çš„æ—¶å€™æ‰§è¡Œæ¸…é™¤æ“ä½œã€‚effect åœ¨æ¯æ¬¡æ¸²æŸ“çš„æ—¶å€™éƒ½ä¼šæ‰§è¡Œã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ React <em>ä¼š</em>åœ¨æ‰§è¡Œå½“å‰ effect ä¹‹å‰å¯¹ä¸Šä¸€ä¸ª effect è¿›è¡Œæ¸…é™¤ã€‚ç¨å<a href="https://zh-hans.reactjs.org/docs/hooks-effect.html#explanation-why-effects-run-on-each-update" target="_blank" rel="noopener">ä¸ºä»€ä¹ˆè¿™å°†åŠ©äºé¿å… bug</a>ä»¥åŠ<a href="https://zh-hans.reactjs.org/docs/hooks-effect.html#tip-optimizing-performance-by-skipping-effects" target="_blank" rel="noopener">å¦‚ä½•åœ¨é‡åˆ°æ€§èƒ½é—®é¢˜æ—¶è·³è¿‡æ­¤è¡Œä¸º</a>ã€‚</p><blockquote><p>Tips</p><p>ä¸ <code>componentDidMount</code> æˆ– <code>componentDidUpdate</code> ä¸åŒï¼Œä½¿ç”¨ <code>useEffect</code> è°ƒåº¦çš„ effect ä¸ä¼šé˜»å¡æµè§ˆå™¨æ›´æ–°å±å¹•ï¼Œè¿™è®©ä½ çš„åº”ç”¨çœ‹èµ·æ¥å“åº”æ›´å¿«ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œeffect ä¸éœ€è¦åŒæ­¥åœ°æ‰§è¡Œã€‚åœ¨ä¸ªåˆ«æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚æµ‹é‡å¸ƒå±€ï¼‰ï¼Œæœ‰å•ç‹¬çš„ <a href="https://zh-hans.reactjs.org/docs/hooks-reference.html#uselayouteffect" target="_blank" rel="noopener"><code>useLayoutEffect</code></a> Hook ä¾›ä½ ä½¿ç”¨ï¼Œå…¶ API ä¸ <code>useEffect</code> ç›¸åŒã€‚</p></blockquote><h3 id="é€šè¿‡è·³è¿‡-Effect-è¿›è¡Œæ€§èƒ½ä¼˜åŒ–"><a href="#é€šè¿‡è·³è¿‡-Effect-è¿›è¡Œæ€§èƒ½ä¼˜åŒ–" class="headerlink" title="é€šè¿‡è·³è¿‡ Effect è¿›è¡Œæ€§èƒ½ä¼˜åŒ–"></a>é€šè¿‡è·³è¿‡ Effect è¿›è¡Œæ€§èƒ½ä¼˜åŒ–</h3><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ¯æ¬¡æ¸²æŸ“åéƒ½æ‰§è¡Œæ¸…ç†æˆ–è€…æ‰§è¡Œ effect å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚åœ¨ class ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ <code>componentDidUpdate</code> ä¸­æ·»åŠ å¯¹ <code>prevProps</code> æˆ– <code>prevState</code> çš„æ¯”è¾ƒé€»è¾‘è§£å†³ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">componentDidUpdate(prevProps, prevState) &#123;</span><br><span class="line">  <span class="keyword">if</span> (prevState.count !== <span class="keyword">this</span>.state.count) &#123;</span><br><span class="line">    <span class="built_in">document</span>.title = <span class="string">`You clicked <span class="subst">$&#123;<span class="keyword">this</span>.state.count&#125;</span> times`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹        è¿™æ˜¯å¾ˆå¸¸è§çš„éœ€æ±‚ï¼Œæ‰€ä»¥å®ƒè¢«å†…ç½®åˆ°äº† <code>useEffect</code> çš„ Hook API ä¸­ã€‚å¦‚æœæŸäº›ç‰¹å®šå€¼åœ¨ä¸¤æ¬¡é‡æ¸²æŸ“ä¹‹é—´æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä½ å¯ä»¥é€šçŸ¥ React <strong>è·³è¿‡ </strong>å¯¹ effect çš„è°ƒç”¨ï¼Œåªè¦ä¼ é€’æ•°ç»„ä½œä¸º <code>useEffect</code> çš„ç¬¬äºŒä¸ªå¯é€‰å‚æ•°å³å¯ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">document</span>.title = <span class="string">`You clicked <span class="subst">$&#123;count&#125;</span> times`</span>;</span><br><span class="line">&#125;, [count]); <span class="comment">// ä»…åœ¨ count æ›´æ”¹æ—¶æ›´æ–°</span></span><br></pre></td></tr></table></figure><p>â€‹        è¿™ä¸ªå‚æ•°æ˜¯ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿå¦‚æœ <code>count</code>çš„å€¼æ˜¯ <code>5</code>ï¼Œè€Œä¸”æˆ‘ä»¬çš„ç»„ä»¶é‡æ¸²æŸ“çš„æ—¶å€™ <code>count</code> è¿˜æ˜¯ç­‰äº <code>5</code>ï¼ŒReact å°†å¯¹å‰ä¸€æ¬¡æ¸²æŸ“çš„ <code>[5]</code>å’Œåä¸€æ¬¡æ¸²æŸ“çš„ <code>[5]</code> è¿›è¡Œæ¯”è¾ƒã€‚å› ä¸ºæ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯ç›¸ç­‰çš„(<code>5 === 5</code>)ï¼ŒReact ä¼šè·³è¿‡è¿™ä¸ª effectï¼Œè¿™å°±å®ç°äº†æ€§èƒ½çš„ä¼˜åŒ–ã€‚</p><blockquote><p>å¦‚æœæƒ³æ‰§è¡Œåªè¿è¡Œä¸€æ¬¡çš„ effectï¼ˆä»…åœ¨ç»„ä»¶æŒ‚è½½å’Œå¸è½½æ—¶æ‰§è¡Œï¼‰ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªç©ºæ•°ç»„ï¼ˆ<code>[]</code>ï¼‰ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚è¿™å°±å‘Šè¯‰ React ä½ çš„ effect ä¸ä¾èµ–äº props æˆ– state ä¸­çš„ä»»ä½•å€¼ï¼Œæ‰€ä»¥å®ƒæ°¸è¿œéƒ½ä¸éœ€è¦é‡å¤æ‰§è¡Œ</p></blockquote><h2 id="5-è¿˜æœ‰å“ªäº›è‡ªå¸¦çš„Effect-Hooks"><a href="#5-è¿˜æœ‰å“ªäº›è‡ªå¸¦çš„Effect-Hooks" class="headerlink" title="5. è¿˜æœ‰å“ªäº›è‡ªå¸¦çš„Effect Hooks?"></a>5. è¿˜æœ‰å“ªäº›è‡ªå¸¦çš„Effect Hooks?</h2><p>é™¤äº†ä¸Šé¢ä»‹ç»çš„useStateå’ŒuseEffectï¼Œreactè¿˜ç»™æˆ‘ä»¬æä¾›æ¥å¾ˆå¤šæœ‰ç”¨çš„hooksï¼š</p><p>useContext<br>useReducer<br>useCallback<br>useMemo<br>useRef<br>useImperativeMethods<br>useMutationEffect<br>useLayoutEffect</p><p>æˆ‘ä¸å†ä¸€ä¸€ä»‹ç»ï¼Œå¤§å®¶è‡ªè¡Œå»æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ã€‚</p><h2 id="6-è‡ªå®šä¹‰hook"><a href="#6-è‡ªå®šä¹‰hook" class="headerlink" title="6. è‡ªå®šä¹‰hook"></a>6. è‡ªå®šä¹‰hook</h2><p>å½“æˆ‘ä»¬æƒ³åœ¨ä¸¤ä¸ªå‡½æ•°ä¹‹é—´å…±äº«é€»è¾‘æ—¶ï¼Œæˆ‘ä»¬ä¼šæŠŠå®ƒæå–åˆ°ç¬¬ä¸‰ä¸ªå‡½æ•°ä¸­ã€‚è€Œç»„ä»¶å’Œ Hook éƒ½æ˜¯å‡½æ•°ï¼Œæ‰€ä»¥ä¹ŸåŒæ ·é€‚ç”¨è¿™ç§æ–¹å¼ã€‚</p><p><strong>è‡ªå®šä¹‰ Hook æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå…¶åç§°ä»¥ â€œuseâ€ å¼€å¤´ï¼Œå‡½æ•°å†…éƒ¨å¯ä»¥è°ƒç”¨å…¶ä»–çš„ Hookã€‚</strong> </p><blockquote><p>Hook å‡½æ•°å¿…é¡»ä»¥ â€œuseâ€ å‘½åå¼€å¤´ï¼Œè¿™ç§å£°æ˜ç›®å‰æ˜¯é€šè¿‡å¾ˆå¼±çš„ <code>use</code> å‰ç¼€æ ‡è¯†çš„ï¼ˆä½†æ˜¯è®¾è®¡ä¸Šä¼šç®€æ´å¾ˆå¤šï¼‰ï¼Œä¸ºäº†ä¸å¼„é”™æ¯ä¸ªç›’å­å’ŒçŠ¶æ€çš„å¯¹åº”å…³ç³»ï¼Œä¹¦å†™çš„æ—¶å€™ Hooks éœ€è¦ <code>use</code> å¼€å¤´ä¸”æ”¾åœ¨é¡¶å±‚ä½œç”¨åŸŸï¼Œå³ä¸å¯ä»¥åŒ…è£¹ <code>if/switch/when/try</code> ç­‰ã€‚å¼•å…¥äº†å®˜æ–¹çš„ <a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Feslint-plugin-react-hooks" target="_blank" rel="noopener">eslint-plugin-react-hooks</a>  å°±ä¸ç”¨æ‹…å¿ƒä¼šå¼„é”™äº†ã€‚</p></blockquote><p>ä¸ºä»€ä¹ˆä¸èƒ½ç”¨ condition åŒ…è£¹ useHook è¯­å¥ï¼Œè¯¦æƒ…å¯ä»¥è§ <a href="https://link.juejin.im/?target=https%3A%2F%2Freactjs.org%2Fdocs%2Fhooks-rules.html%23explanation" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ï¼Œè¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹ã€‚</p><p>React Hooks å¹¶ä¸æ˜¯é€šè¿‡ Proxy æˆ–è€… getters å®ç°çš„ï¼ˆå…·ä½“å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç«  <a href="https://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236e" target="_blank" rel="noopener">React hooks: not magic, just arrays</a>ï¼‰ï¼Œè€Œæ˜¯é€šè¿‡æ•°ç»„å®ç°çš„ï¼Œæ¯æ¬¡ <code>useState</code> éƒ½ä¼šæ”¹å˜ä¸‹æ ‡ï¼Œå¦‚æœ <code>useState</code> è¢«åŒ…è£¹åœ¨ condition ä¸­ï¼Œé‚£æ¯æ¬¡æ‰§è¡Œçš„ä¸‹æ ‡å°±å¯èƒ½å¯¹ä¸ä¸Šï¼Œå¯¼è‡´ <code>useState</code> å¯¼å‡ºçš„ <code>setter</code> æ›´æ–°é”™æ•°æ®ã€‚</p><h2 id="7-æ€»ç»“"><a href="#7-æ€»ç»“" class="headerlink" title="7. æ€»ç»“"></a>7. æ€»ç»“</h2><ul><li>Hooksæœ¬è´¨æ˜¯æŠŠ<strong>é¢å‘ç”Ÿå‘½å‘¨æœŸç¨‹å¼è®¾è®¡</strong>å˜æˆäº†<strong>é¢å‘ä¸šåŠ¡é€»è¾‘ç¨‹å¼è®¾è®¡</strong>ï¼›</li><li>Hooks æ˜¯React çš„æœªæ¥ï¼Œä½†è¿˜æ˜¯æ— æ³•å®Œå…¨æ›¿ä»£åŸå§‹çš„Classã€‚</li></ul><h2 id="Example-1"><a href="#Example-1" class="headerlink" title="Example 1:"></a>Example 1:</h2><p>æˆ‘ä»¬å…ˆå‡æƒ³ä¸€ä¸ªå¸¸è§çš„éœ€æ±‚ï¼Œä¸€ä¸ª Modal é‡Œéœ€è¦å±•ç¤ºä¸€äº›ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯éœ€è¦é€šè¿‡ API è·å–ä¸”è·Ÿ Modal å¼ºä¸šåŠ¡ç›¸å…³, Modal æ‰“å¼€çš„æ—¶å€™æ‰è¿›è¡Œæ•°æ®è·å–ï¼š</p><p><a href="https://codepen.io/int64ago/pen/qQoJOX?editors=0010" target="_blank" rel="noopener">ä»£ç </a></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RandomUserModal</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      user: &#123;&#125;,</span><br><span class="line">      loading: <span class="literal">false</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.fetchData = <span class="keyword">this</span>.fetchData.bind(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.props.visible) &#123;</span><br><span class="line">      <span class="keyword">this</span>.fetchData();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidUpdate(prevProps) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!prevProps.visible &amp;&amp; <span class="keyword">this</span>.props.visible) &#123;</span><br><span class="line">      <span class="keyword">this</span>.fetchData();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  fetchData() &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">loading</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">    fetch(<span class="string">'https://randomuser.me/api/'</span>)</span><br><span class="line">      .then(<span class="function"><span class="params">res</span> =&gt;</span> res.json())</span><br><span class="line">      .then(<span class="function"><span class="params">json</span> =&gt;</span> <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        user: json.results[<span class="number">0</span>],</span><br><span class="line">        loading: <span class="literal">false</span>,</span><br><span class="line">      &#125;));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">this</span>.state.user;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;ReactModal</span><br><span class="line">        isOpen=&#123;<span class="keyword">this</span>.props.visible&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="keyword">this</span>.props.handleCloseModal&#125;&gt;Close Modal&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &#123;this.state.loading ?</span></span><br><span class="line"><span class="regexp">          &lt;div&gt;loading...&lt;/</span>div&gt;</span><br><span class="line">          :</span><br><span class="line">          &lt;ul&gt;</span><br><span class="line">            &lt;li&gt;Name: &#123;<span class="string">`<span class="subst">$&#123;(user.name || &#123;&#125;</span>).first&#125; <span class="subst">$&#123;(user.name || &#123;&#125;</span>).last&#125;`</span>&#125;&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">            &lt;li&gt;Gender: &#123;user.gender&#125;&lt;/</span>li&gt;</span><br><span class="line">            &lt;li&gt;Phone: &#123;user.phone&#125;&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/u</span>l&gt;</span><br><span class="line">        &#125;</span><br><span class="line">      &lt;<span class="regexp">/ReactModal&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>ä¸ºäº†å®ç°åœ¨ Modal æ‰“å¼€çš„æ—¶å€™æ‰è¿›è¡Œæ•°æ®è·å–ï¼Œæˆ‘ä»¬éœ€è¦åŒæ—¶åœ¨ <code>componentDidMount</code> å’Œ <code>componentDidUpdate</code> ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸé‡Œå®ç°æ•°æ®è·å–çš„é€»è¾‘ï¼Œè€Œä¸” <code>constructor</code> é‡Œçš„ä¸€äº›åˆå§‹åŒ–æ“ä½œä¹Ÿå°‘ä¸äº†ã€‚</p><p>å…¶å®æˆ‘ä»¬çš„è¦æ±‚å¾ˆç®€å•ï¼šåœ¨åˆé€‚çš„æ—¶å€™é€šè¿‡ API è·å–æ–°çš„ä¿¡æ¯ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æŠ½è±¡å‡ºæ¥çš„ä¸€ä¸ª<strong>ä¸šåŠ¡é€»è¾‘</strong>ï¼Œä¸ºäº†è¿™ä¸ªä¸šåŠ¡é€»è¾‘èƒ½åœ¨ React é‡Œæ­£ç¡®å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶<strong>æŒ‰ç…§ React ç»„ä»¶ç”Ÿå‘½å‘¨æœŸè¿›è¡Œæ‹†è§£</strong>ã€‚è¿™ç§æ‹†è§£é™¤äº†<strong>ä»£ç å†—ä½™</strong>ï¼Œè¿˜<strong>å¾ˆéš¾å¤ç”¨</strong>ã€‚</p><p><a href="https://codepen.io/int64ago/pen/eQMLNX?editors=0010" target="_blank" rel="noopener">hooksçš„æ”¹é€ å</a>ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">RandomUserModal</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [user, setUser] = React.useState(&#123;&#125;);</span><br><span class="line">  <span class="keyword">const</span> [loading, setLoading] = React.useState(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  React.useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!props.visible) <span class="keyword">return</span>;</span><br><span class="line">    setLoading(<span class="literal">true</span>);</span><br><span class="line">    fetch(<span class="string">'https://randomuser.me/api/'</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> res.json()).then(<span class="function"><span class="params">json</span> =&gt;</span> &#123;</span><br><span class="line">      setUser(json.results[<span class="number">0</span>]);</span><br><span class="line">      setLoading(<span class="literal">false</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, [props.visible]);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="comment">// View éƒ¨åˆ†å‡ ä¹ä¸ä¸Šé¢ç›¸åŒ</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾åœ°å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æŠŠ Class å½¢å¼å˜æˆäº† Function å½¢å¼ï¼Œä½¿ç”¨äº†ä¸¤ä¸ª State Hook è¿›è¡Œæ•°æ®ç®¡ç†ï¼ˆç±»æ¯” <code>constructor</code>ï¼‰ï¼Œä¹‹å‰ <code>componentDidMount</code> å’Œ <code>componentDidUpdate</code> ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸé‡Œå¹²çš„äº‹æˆ‘ä»¬ç›´æ¥åœ¨ä¸€ä¸ª Effect Hook é‡Œåšäº†ã€‚åšäº†è¿™äº›ï¼Œæœ€å¤§çš„ä¼˜åŠ¿æ˜¯<strong>ä»£ç ç²¾ç®€</strong>ï¼Œä¸šåŠ¡é€»è¾‘å˜çš„ç´§å‡‘ï¼Œä»£ç è¡Œæ•°ä¹Ÿä» 50+ è¡Œå‡å°‘åˆ° 30+ è¡Œã€‚</p><p>Hooks çš„å¼ºå¤§ä¹‹å¤„è¿˜ä¸ä»…ä»…æ˜¯è¿™ä¸ªï¼Œæœ€é‡è¦çš„æ˜¯è¿™äº›ä¸šåŠ¡é€»è¾‘å¯ä»¥éšæ„åœ°çš„çš„æŠ½ç¦»å‡ºå»ï¼Œè·Ÿæ™®é€šçš„å‡½æ•°æ²¡ä»€ä¹ˆåŒºåˆ«ï¼ˆä»…ä»…æ˜¯çœ‹èµ·æ¥æ²¡åŒºåˆ«ï¼‰ï¼Œäºæ˜¯å°±å˜æˆäº†å¯ä»¥<strong>å¤ç”¨</strong>çš„è‡ªå®šä¹‰ Hookã€‚å…·ä½“å¯ä»¥çœ‹ä¸‹é¢çš„è¿›ä¸€æ­¥æ”¹é€ ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è‡ªå®šä¹‰ Hook</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useFetchUser</span>(<span class="params">visible</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [user, setUser] = React.useState(&#123;&#125;);</span><br><span class="line">  <span class="keyword">const</span> [loading, setLoading] = React.useState(<span class="literal">false</span>);</span><br><span class="line">  </span><br><span class="line">  React.useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!visible) <span class="keyword">return</span>;</span><br><span class="line">    setLoading(<span class="literal">true</span>);</span><br><span class="line">    fetch(<span class="string">'https://randomuser.me/api/'</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> res.json()).then(<span class="function"><span class="params">json</span> =&gt;</span> &#123;</span><br><span class="line">      setUser(json.results[<span class="number">0</span>]);</span><br><span class="line">      setLoading(<span class="literal">false</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, [visible]);</span><br><span class="line">  <span class="keyword">return</span> &#123; user, loading &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">RandomUserModal</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; user, loading &#125; = useFetchUser(props.visible);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="comment">// ä¸ä¸Šé¢ç›¸åŒ</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <code>useFetchUser</code> ä¸ºè‡ªå®šä¹‰ Hookï¼Œå®ƒçš„åœ°ä½è·Ÿè‡ªå¸¦çš„ <code>useState</code> ç­‰æ¯”ä¹Ÿæ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œä½ å¯ä»¥åœ¨å…¶å®ƒç»„ä»¶é‡Œä½¿ç”¨ï¼Œç”šè‡³åœ¨è¿™ä¸ªç»„ä»¶é‡Œä½¿ç”¨ä¸¤æ¬¡ï¼Œå®ƒä»¬ä¼šå¤©ç„¶åœ°éš”ç¦»å¼€ã€‚</p><h2 id="Example-2"><a href="#Example-2" class="headerlink" title="Example 2:"></a>Example 2:</h2><p><a href="https://codesandbox.io/s/jvvkoo8pq3" target="_blank" rel="noopener">å®ä¾‹äºŒ</a></p><p>å‚è€ƒï¼š</p><p> <a href="https://segmentfault.com/a/1190000017182184" target="_blank" rel="noopener">React Hooks æ·±å…¥ä¸æµ…å‡º</a></p><p> <a href="https://segmentfault.com/a/1190000016950339" target="_blank" rel="noopener">30åˆ†é’Ÿç²¾é€šReactä»Šå¹´æœ€åŠ²çˆ†çš„æ–°ç‰¹æ€§â€”â€”React Hooks</a></p><p> <a href="https://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236e" target="_blank" rel="noopener">React hooks: not magic, just arrays </a></p><p> <a href="https://medium.com/@dan_abramov/making-sense-of-react-hooks-fdbde8803889" target="_blank" rel="noopener">Making Sense of React Hooks </a></p><p> <a href="https://overreacted.io/a-complete-guide-to-useeffect/" target="_blank" rel="noopener">A Complete Guide to useEffect  </a>  æ¨è Dan çš„è¿™ç¯‡æ–‡ç« </p><p> <a href="https://medium.com/the-guild/under-the-hood-of-reacts-hooks-system-eb59638c9dba" target="_blank" rel="noopener">Under the hood of Reactâ€™s hooks system</a>  åŸç†  <a href="https://juejin.im/post/5c99a75af265da60ef635898" target="_blank" rel="noopener">ä¸­æ–‡ç‰ˆ</a></p>]]></content>
    
    <summary type="html">
    
      Hook æ˜¯ React 16.8 çš„æ–°å¢ç‰¹æ€§ã€‚å®ƒå¯ä»¥è®©ä½ åœ¨ä¸ç¼–å†™ class çš„æƒ…å†µä¸‹ä½¿ç”¨ state ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§ï¼ˆç”Ÿå‘½å‘¨æœŸç­‰ç‰¹æ€§ï¼‰ã€‚å¸¦æ¥çš„å¥½å¤„ä¸ä»…æ˜¯ â€œæ›´ FPï¼Œæ›´æ–°ç²’åº¦æ›´ç»†ï¼Œä»£ç æ›´æ¸…æ™°â€
    
    </summary>
    
      <category term="é»˜è®¤åˆ†ç±»" scheme="https://kitions.github.io/categories/%E9%BB%98%E8%AE%A4%E5%88%86%E7%B1%BB/"/>
    
    
      <category term="React" scheme="https://kitions.github.io/tags/React/"/>
    
  </entry>
  
</feed>
